<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<link href="coqdoc.css" rel="stylesheet" type="text/css" />
<link href="coqdocjs.css" rel="stylesheet" type="text/css"/>
<link href="toc.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="config.js"></script>
<script type="text/javascript" src="coqdocjs.js"></script>
</head>

<body onload="document.getElementById('content').focus()">
  <div id="header">
    <span class="left">
      <span class="modulename"> <script> document.write(document.title) </script> </span>
    </span>

    <span class="button" id="toggle-proofs"></span>

    <span class="right">
      <a href="toc.html">Table of contents</a>
      <a href="https://github.com/AU-COBRA/ConCert" target="_balnk">Project Page</a>
    </span>
</div>
  <div id="content" tabindex="-1" onblur="document.getElementById('content').focus()">
    <div id="js-toc-header" class="toc-header">Contents:</div>
    <div id="js-toc" class="toc" data-toc="h1,h2,h3,h4" data-toc-container="doc">
    </div>
    <div id="main">
<h1 class="libtitle">Library ConCert.Examples.boardroomVoting.BoardroomMath</h1>

<div class="code">
<span class="id" title="keyword">From</span> <span class="id" title="var">Coq</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Morphisms</span>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">Coq</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Permutation</span>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">Coq</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Psatz</span>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">Coq</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">SetoidTactics</span>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">Coq</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Field</span>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">Coq</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">ZArith</span>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">Coq</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Znumtheory</span>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">Coq</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">List</span>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">Bignums</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">BigZ</span>.<br/>

<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">ConCert.Examples.BoardroomVoting</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Egcd</span>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">ConCert.Examples.BoardroomVoting</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Euler</span>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">ConCert.Utils</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Extras</span>.<br/>
<span class="id" title="keyword">Import</span> <span class="id" title="var">ListNotations</span>.<br/>

<br/>
<span class="id" title="keyword">Local Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">Z</span>.<br/>

<br/>
<span class="id" title="keyword">Class</span> <span class="id" title="var">BoardroomAxioms</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} :=<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">elmeq</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">A</span> -&gt; <span class="id" title="keyword">Prop</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">elmeqb</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">A</span> -&gt; <span class="id" title="var">bool</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">elmeqb_spec</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> : <span class="id" title="var">Bool.reflect</span> (<span class="id" title="var">elmeq</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>) (<span class="id" title="var">elmeqb</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">zero</span> : <span class="id" title="var">A</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">one</span> : <span class="id" title="var">A</span>;<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">add</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">A</span> -&gt; <span class="id" title="var">A</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mul</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">A</span> -&gt; <span class="id" title="var">A</span>;<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">opp</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">A</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">inv</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">A</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">pow</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">Z</span> -&gt; <span class="id" title="var">A</span>;<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">order</span> : <span class="id" title="var">Z</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">expeq</span> <span class="id" title="var">e</span> <span class="id" title="var">e'</span> := <span class="id" title="var">e</span> <span class="id" title="var">mod</span> (<span class="id" title="var">order</span> - 1) = <span class="id" title="var">e'</span> <span class="id" title="var">mod</span> (<span class="id" title="var">order</span> - 1);<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">order_ge_2</span> : <span class="id" title="var">order</span> &gt;= 2;<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">elmeq_equiv</span> :&gt; <span class="id" title="var">Equivalence</span> <span class="id" title="var">elmeq</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">add_proper</span> :&gt; <span class="id" title="var">Proper</span> (<span class="id" title="var">elmeq</span> ==&gt; <span class="id" title="var">elmeq</span> ==&gt; <span class="id" title="var">elmeq</span>) <span class="id" title="var">add</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mul_proper</span> :&gt; <span class="id" title="var">Proper</span> (<span class="id" title="var">elmeq</span> ==&gt; <span class="id" title="var">elmeq</span> ==&gt; <span class="id" title="var">elmeq</span>) <span class="id" title="var">mul</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">opp_proper</span> :&gt; <span class="id" title="var">Proper</span> (<span class="id" title="var">elmeq</span> ==&gt; <span class="id" title="var">elmeq</span>) <span class="id" title="var">opp</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">inv_proper</span> :&gt; <span class="id" title="var">Proper</span> (<span class="id" title="var">elmeq</span> ==&gt; <span class="id" title="var">elmeq</span>) <span class="id" title="var">inv</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">pow_base_proper</span> :&gt; <span class="id" title="var">Proper</span> (<span class="id" title="var">elmeq</span> ==&gt; <span class="id" title="var">eq</span> ==&gt; <span class="id" title="var">elmeq</span>) <span class="id" title="var">pow</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">pow_exp_proper</span> <span class="id" title="var">a</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~(<span class="id" title="var">elmeq</span> <span class="id" title="var">a</span> <span class="id" title="var">zero</span>) -&gt; <span class="id" title="var">Proper</span> (<span class="id" title="var">expeq</span> ==&gt; <span class="id" title="var">elmeq</span>) (<span class="id" title="var">pow</span> <span class="id" title="var">a</span>);<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">one_neq_zero</span> : ~(<span class="id" title="var">elmeq</span> <span class="id" title="var">one</span> <span class="id" title="var">zero</span>);<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">add_comm</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span> : <span class="id" title="var">elmeq</span> (<span class="id" title="var">add</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span>) (<span class="id" title="var">add</span> <span class="id" title="var">b</span> <span class="id" title="var">a</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">add_assoc</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span> <span class="id" title="var">c</span> : <span class="id" title="var">elmeq</span> (<span class="id" title="var">add</span> <span class="id" title="var">a</span> (<span class="id" title="var">add</span> <span class="id" title="var">b</span> <span class="id" title="var">c</span>)) (<span class="id" title="var">add</span> (<span class="id" title="var">add</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span>) <span class="id" title="var">c</span>);<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mul_comm</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span> : <span class="id" title="var">elmeq</span> (<span class="id" title="var">mul</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span>) (<span class="id" title="var">mul</span> <span class="id" title="var">b</span> <span class="id" title="var">a</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mul_assoc</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span> <span class="id" title="var">c</span> : <span class="id" title="var">elmeq</span> (<span class="id" title="var">mul</span> <span class="id" title="var">a</span> (<span class="id" title="var">mul</span> <span class="id" title="var">b</span> <span class="id" title="var">c</span>)) (<span class="id" title="var">mul</span> (<span class="id" title="var">mul</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span>) <span class="id" title="var">c</span>);<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">add_0_l</span> <span class="id" title="var">a</span> : <span class="id" title="var">elmeq</span> (<span class="id" title="var">add</span> <span class="id" title="var">zero</span> <span class="id" title="var">a</span>) <span class="id" title="var">a</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mul_0_l</span> <span class="id" title="var">a</span> : <span class="id" title="var">elmeq</span> (<span class="id" title="var">mul</span> <span class="id" title="var">zero</span> <span class="id" title="var">a</span>) <span class="id" title="var">zero</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mul_1_l</span> <span class="id" title="var">a</span> : <span class="id" title="var">elmeq</span> (<span class="id" title="var">mul</span> <span class="id" title="var">one</span> <span class="id" title="var">a</span>) <span class="id" title="var">a</span>;<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">opp_inv_l</span> <span class="id" title="var">a</span> : <span class="id" title="var">elmeq</span> (<span class="id" title="var">add</span> (<span class="id" title="var">opp</span> <span class="id" title="var">a</span>) <span class="id" title="var">a</span>) <span class="id" title="var">zero</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">inv_inv_l</span> <span class="id" title="var">a</span> : ~(<span class="id" title="var">elmeq</span> <span class="id" title="var">a</span> <span class="id" title="var">zero</span>) -&gt; <span class="id" title="var">elmeq</span> (<span class="id" title="var">mul</span> (<span class="id" title="var">inv</span> <span class="id" title="var">a</span>) <span class="id" title="var">a</span>) <span class="id" title="var">one</span>;<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mul_add</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span> <span class="id" title="var">c</span> : <span class="id" title="var">elmeq</span> (<span class="id" title="var">mul</span> (<span class="id" title="var">add</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span>) <span class="id" title="var">c</span>) (<span class="id" title="var">add</span> (<span class="id" title="var">mul</span> <span class="id" title="var">a</span> <span class="id" title="var">c</span>) (<span class="id" title="var">mul</span> <span class="id" title="var">b</span> <span class="id" title="var">c</span>));<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">pow_0_r</span> <span class="id" title="var">a</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~(<span class="id" title="var">elmeq</span> <span class="id" title="var">a</span> <span class="id" title="var">zero</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">elmeq</span> (<span class="id" title="var">pow</span> <span class="id" title="var">a</span> 0) <span class="id" title="var">one</span>;<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">pow_1_r</span> <span class="id" title="var">a</span> : <span class="id" title="var">elmeq</span> (<span class="id" title="var">pow</span> <span class="id" title="var">a</span> 1) <span class="id" title="var">a</span>;<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">pow_opp_1</span> <span class="id" title="var">a</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~(<span class="id" title="var">elmeq</span> <span class="id" title="var">a</span> <span class="id" title="var">zero</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">elmeq</span> (<span class="id" title="var">pow</span> <span class="id" title="var">a</span> (-1)) (<span class="id" title="var">inv</span> <span class="id" title="var">a</span>);<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">pow_plus</span> <span class="id" title="var">a</span> <span class="id" title="var">e</span> <span class="id" title="var">e'</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~(<span class="id" title="var">elmeq</span> <span class="id" title="var">a</span> <span class="id" title="var">zero</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">elmeq</span> (<span class="id" title="var">pow</span> <span class="id" title="var">a</span> (<span class="id" title="var">e</span> + <span class="id" title="var">e'</span>)) (<span class="id" title="var">mul</span> (<span class="id" title="var">pow</span> <span class="id" title="var">a</span> <span class="id" title="var">e</span>) (<span class="id" title="var">pow</span> <span class="id" title="var">a</span> <span class="id" title="var">e'</span>));<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">pow_pow</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span> <span class="id" title="var">e</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~(<span class="id" title="var">elmeq</span> <span class="id" title="var">a</span> <span class="id" title="var">zero</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">elmeq</span> (<span class="id" title="var">pow</span> (<span class="id" title="var">pow</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span>) <span class="id" title="var">e</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">pow</span> <span class="id" title="var">a</span> (<span class="id" title="var">b</span> * <span class="id" title="var">e</span>)%<span class="id" title="var">Z</span>);<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">pow_nonzero</span> <span class="id" title="var">a</span> <span class="id" title="var">e</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~(<span class="id" title="var">elmeq</span> <span class="id" title="var">a</span> <span class="id" title="var">zero</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~(<span class="id" title="var">elmeq</span> (<span class="id" title="var">pow</span> <span class="id" title="var">a</span> <span class="id" title="var">e</span>) <span class="id" title="var">zero</span>);<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">inv_nonzero</span> <span class="id" title="var">a</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~(<span class="id" title="var">elmeq</span> <span class="id" title="var">a</span> <span class="id" title="var">zero</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~(<span class="id" title="var">elmeq</span> (<span class="id" title="var">inv</span> <span class="id" title="var">a</span>) <span class="id" title="var">zero</span>);<br/>
&nbsp;&nbsp;}.<br/>

<br/>
<span class="id" title="var">Arguments</span> <span class="id" title="var">BoardroomAxioms</span> : <span class="id" title="tactic">clear</span> <span class="id" title="var">implicits</span>.<br/>

<br/>
<span class="id" title="var">Declare</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">broom</span>.<br/>
<span class="id" title="var">Declare</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">broom_scope</span>.<br/>
<span class="id" title="keyword">Delimit</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">broom_scope</span> <span class="id" title="keyword">with</span> <span class="id" title="var">broom</span>.<br/>

<br/>
<span class="id" title="keyword">Module</span> <span class="id" title="var">BoardroomMathNotations</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Infix</span> &quot;==" := <span class="id" title="var">elmeq</span> (<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 70) : <span class="id" title="var">broom</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Infix</span> &quot;=?" := <span class="id" title="var">elmeqb</span> (<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 70) : <span class="id" title="var">broom</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Notation</span> &quot;a !== b" := (~(<span class="id" title="var">elmeq</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span>)) (<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 70) : <span class="id" title="var">broom</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Notation</span> &quot;0" := <span class="id" title="var">zero</span> : <span class="id" title="var">broom</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Notation</span> &quot;1" := <span class="id" title="var">one</span> : <span class="id" title="var">broom</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Infix</span> &quot;+" := <span class="id" title="var">add</span> : <span class="id" title="var">broom</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Infix</span> &quot;*" := <span class="id" title="var">mul</span> : <span class="id" title="var">broom</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Infix</span> &quot;^" := <span class="id" title="var">pow</span> : <span class="id" title="var">broom</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Notation</span> &quot;a 'exp=' b" := (<span class="id" title="var">expeq</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span>) (<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 70) : <span class="id" title="var">broom</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Notation</span> &quot;a 'exp&lt;&gt;' b" := (~(<span class="id" title="var">expeq</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span>)) (<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 70) : <span class="id" title="var">broom</span>.<br/>
<span class="id" title="keyword">End</span> <span class="id" title="var">BoardroomMathNotations</span>.<br/>

<br/>
<span class="id" title="keyword">Export</span> <span class="id" title="var">BoardroomMathNotations</span>.<br/>
<span class="id" title="keyword">Local Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">broom</span>.<br/>

<br/>
<span class="id" title="keyword">Global Instance</span> <span class="id" title="var">oeq_equivalence</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="tactic">field</span> : <span class="id" title="var">BoardroomAxioms</span> <span class="id" title="var">A</span>) : <span class="id" title="var">Equivalence</span> <span class="id" title="var">expeq</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">expeq</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">constructor</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">constructor</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">intro</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="var">now</span> <span class="id" title="tactic">intros</span> ? ? ? -&gt; -&gt;.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">BoardroomAxioms_field_theory</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="tactic">field</span> : <span class="id" title="var">BoardroomAxioms</span> <span class="id" title="var">A</span>) :<br/>
&nbsp;&nbsp;<span class="id" title="var">field_theory</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;0 1<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">add</span> <span class="id" title="var">mul</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> =&gt; <span class="id" title="var">x</span> + (<span class="id" title="var">opp</span> <span class="id" title="var">y</span>)) <span class="id" title="var">opp</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> =&gt; <span class="id" title="var">x</span> * <span class="id" title="var">inv</span> <span class="id" title="var">y</span>) <span class="id" title="var">inv</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">elmeq</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">constructor</span>; [<span class="id" title="tactic">constructor</span>| | |].<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">add_0_l</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">add_comm</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">add_assoc</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">mul_1_l</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">mul_comm</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">mul_assoc</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">mul_add</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">x</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">add_comm</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">opp_inv_l</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">one_neq_zero</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">inv_inv_l</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Class</span> <span class="id" title="var">Generator</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="tactic">field</span> : <span class="id" title="var">BoardroomAxioms</span> <span class="id" title="var">A</span>) := <br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">generator</span> : <span class="id" title="var">A</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">generator_nonzero</span> : <span class="id" title="var">generator</span> !== 0;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">generator_generates</span> <span class="id" title="var">a</span> : <span class="id" title="var">a</span> !== 0 -&gt; <span class="id" title="tactic">exists</span>! <span class="id" title="var">e</span>, 0 &lt;= <span class="id" title="var">e</span> &lt; <span class="id" title="var">order</span> - 1 /\ <span class="id" title="var">generator</span>^<span class="id" title="var">e</span> == <span class="id" title="var">a</span>;<br/>
&nbsp;&nbsp;}.<br/>

<br/>
<span class="id" title="keyword">Class</span> <span class="id" title="var">DiscreteLog</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="tactic">field</span> : <span class="id" title="var">BoardroomAxioms</span> <span class="id" title="var">A</span>) (<span class="id" title="var">g</span> : <span class="id" title="var">Generator</span> <span class="id" title="tactic">field</span>) := <br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;This&nbsp;is&nbsp;computationally&nbsp;intractable,&nbsp;but&nbsp;we&nbsp;still&nbsp;require&nbsp;it&nbsp;for&nbsp;ease&nbsp;of&nbsp;specification&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">log</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">Z</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">log_proper</span> :&gt; <span class="id" title="var">Proper</span> (<span class="id" title="var">elmeq</span> ==&gt; <span class="id" title="var">expeq</span>) <span class="id" title="var">log</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">pow_log</span> <span class="id" title="var">a</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">a</span> !== 0 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">generator</span> ^ (<span class="id" title="var">log</span> <span class="id" title="var">a</span>) == <span class="id" title="var">a</span>;<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">log_1_l</span> : <span class="id" title="var">log</span> 1 <span class="id" title="var">exp</span>= 0%<span class="id" title="var">Z</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">log_mul</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">a</span> !== 0 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">b</span> !== 0 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">log</span> (<span class="id" title="var">a</span> * <span class="id" title="var">b</span>) <span class="id" title="var">exp</span>= <span class="id" title="var">log</span> <span class="id" title="var">a</span> + <span class="id" title="var">log</span> <span class="id" title="var">b</span>;<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">log_inv</span> <span class="id" title="var">a</span> : <span class="id" title="var">log</span> (<span class="id" title="var">inv</span> <span class="id" title="var">a</span>) <span class="id" title="var">exp</span>= -<span class="id" title="var">log</span> <span class="id" title="var">a</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">log_generator</span> : <span class="id" title="var">log</span> <span class="id" title="var">generator</span> = 1%<span class="id" title="var">Z</span>;<br/>
&nbsp;&nbsp;}.<br/>

<br/>
<span class="id" title="keyword">Section</span> <span class="id" title="var">WithBoardroomAxioms</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Context</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>}.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Context</span> {<span class="id" title="tactic">field</span> : <span class="id" title="var">BoardroomAxioms</span> <span class="id" title="var">A</span>}.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Context</span> {<span class="id" title="var">gen</span> : <span class="id" title="var">Generator</span> <span class="id" title="tactic">field</span>}.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Context</span> {<span class="id" title="var">disc_log</span> : <span class="id" title="var">DiscreteLog</span> <span class="id" title="tactic">field</span> <span class="id" title="var">gen</span>}.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">prod</span> (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> <span class="id" title="var">A</span>) : <span class="id" title="var">A</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">l</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [] =&gt; <span class="id" title="var">one</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">x</span> :: <span class="id" title="var">xs</span> =&gt; <span class="id" title="var">x</span> * <span class="id" title="var">prod</span> <span class="id" title="var">xs</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">compute_public_key</span> (<span class="id" title="var">sk</span> : <span class="id" title="var">Z</span>) : <span class="id" title="var">A</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">generator</span> ^ <span class="id" title="var">sk</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">reconstructed_key</span> (<span class="id" title="var">pks</span> : <span class="id" title="var">list</span> <span class="id" title="var">A</span>) (<span class="id" title="var">n</span> : <span class="id" title="var">nat</span>) : <span class="id" title="var">A</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">lprod</span> := <span class="id" title="var">prod</span> (<span class="id" title="var">firstn</span> <span class="id" title="var">n</span> <span class="id" title="var">pks</span>) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">rprod</span> := <span class="id" title="var">inv</span> (<span class="id" title="var">prod</span> (<span class="id" title="var">skipn</span> (<span class="id" title="var">S</span> <span class="id" title="var">n</span>) <span class="id" title="var">pks</span>)) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">lprod</span> * <span class="id" title="var">rprod</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">compute_public_vote</span> (<span class="id" title="var">rk</span> : <span class="id" title="var">A</span>) (<span class="id" title="var">sk</span> : <span class="id" title="var">Z</span>) (<span class="id" title="var">sv</span> : <span class="id" title="var">bool</span>) : <span class="id" title="var">A</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rk</span> ^ <span class="id" title="var">sk</span> * <span class="id" title="keyword">if</span> <span class="id" title="var">sv</span> <span class="id" title="keyword">then</span> <span class="id" title="var">generator</span> <span class="id" title="keyword">else</span> 1.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">bruteforce_tally_aux</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">n</span> : <span class="id" title="var">nat</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">votes_product</span> : <span class="id" title="var">A</span>) : <span class="id" title="var">option</span> <span class="id" title="var">nat</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> <span class="id" title="var">generator</span> ^ (<span class="id" title="var">Z.of_nat</span> <span class="id" title="var">n</span>) =? <span class="id" title="var">votes_product</span> <span class="id" title="keyword">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Some</span> <span class="id" title="var">n</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">n</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| 0 =&gt; <span class="id" title="var">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">S</span> <span class="id" title="var">n</span> =&gt; <span class="id" title="var">bruteforce_tally_aux</span> <span class="id" title="var">n</span> <span class="id" title="var">votes_product</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>%<span class="id" title="var">nat</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">bruteforce_tally</span> (<span class="id" title="var">votes</span> : <span class="id" title="var">list</span> <span class="id" title="var">A</span>) : <span class="id" title="var">option</span> <span class="id" title="var">nat</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">bruteforce_tally_aux</span> (<span class="id" title="var">length</span> <span class="id" title="var">votes</span>) (<span class="id" title="var">prod</span> <span class="id" title="var">votes</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Add</span> <span class="id" title="var">Field</span> <span class="id" title="var">ff</span> : (<span class="id" title="var">BoardroomAxioms_field_theory</span> <span class="id" title="tactic">field</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Local Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">broom</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Hint Resolve</span> <span class="id" title="var">one_neq_zero</span> <span class="id" title="var">pow_nonzero</span> <span class="id" title="var">generator_nonzero</span> <span class="id" title="var">inv_nonzero</span> : <span class="id" title="var">core</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Instance</span> <span class="id" title="var">plus_expeq_proper</span> : <span class="id" title="var">Proper</span> (<span class="id" title="var">expeq</span> ==&gt; <span class="id" title="var">expeq</span> ==&gt; <span class="id" title="var">expeq</span>) <span class="id" title="var">Z.add</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">x</span> <span class="id" title="var">x'</span> <span class="id" title="var">xeq</span> <span class="id" title="var">y</span> <span class="id" title="var">y'</span> <span class="id" title="var">yeq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> "exp=" <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">order</span> - 1 &lt;&gt; 0)%<span class="id" title="var">Z</span> <span class="id" title="tactic">by</span> (<span class="id" title="tactic">pose</span> <span class="id" title="var">proof</span> <span class="id" title="var">order_ge_2</span>; <span class="id" title="var">lia</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z.add_mod</span>, <span class="id" title="var">xeq</span>, <span class="id" title="var">yeq</span>, &lt;- <span class="id" title="var">Z.add_mod</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Instance</span> <span class="id" title="var">mul_expeq_proper</span> : <span class="id" title="var">Proper</span> (<span class="id" title="var">expeq</span> ==&gt; <span class="id" title="var">expeq</span> ==&gt; <span class="id" title="var">expeq</span>) <span class="id" title="var">Z.mul</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">x</span> <span class="id" title="var">x'</span> <span class="id" title="var">xeq</span> <span class="id" title="var">y</span> <span class="id" title="var">y'</span> <span class="id" title="var">yeq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> "exp=" <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">order</span> - 1 &lt;&gt; 0)%<span class="id" title="var">Z</span> <span class="id" title="tactic">by</span> (<span class="id" title="tactic">pose</span> <span class="id" title="var">proof</span> <span class="id" title="var">order_ge_2</span>; <span class="id" title="var">lia</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z.mul_mod</span>, <span class="id" title="var">xeq</span>, <span class="id" title="var">yeq</span>, &lt;- <span class="id" title="var">Z.mul_mod</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Instance</span> <span class="id" title="var">sub_expeq_proper</span> : <span class="id" title="var">Proper</span> (<span class="id" title="var">expeq</span> ==&gt; <span class="id" title="var">expeq</span> ==&gt; <span class="id" title="var">expeq</span>) <span class="id" title="var">Z.sub</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">x</span> <span class="id" title="var">x'</span> <span class="id" title="var">xeq</span> <span class="id" title="var">y</span> <span class="id" title="var">y'</span> <span class="id" title="var">yeq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> "exp=" <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">order</span> - 1 &lt;&gt; 0)%<span class="id" title="var">Z</span> <span class="id" title="tactic">by</span> (<span class="id" title="tactic">pose</span> <span class="id" title="var">proof</span> <span class="id" title="var">order_ge_2</span>; <span class="id" title="var">lia</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Zminus_mod</span>, <span class="id" title="var">xeq</span>, <span class="id" title="var">yeq</span>, &lt;- <span class="id" title="var">Zminus_mod</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Instance</span> <span class="id" title="var">opp_expeq_proper</span> : <span class="id" title="var">Proper</span> (<span class="id" title="var">expeq</span> ==&gt; <span class="id" title="var">expeq</span>) <span class="id" title="var">Z.opp</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">x</span> <span class="id" title="var">x'</span> <span class="id" title="var">xeq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- !<span class="id" title="var">Z.sub_0_l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">xeq</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">log_pow</span> <span class="id" title="var">a</span> <span class="id" title="var">e</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">a</span> !== 0 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">log</span> (<span class="id" title="var">a</span> ^ <span class="id" title="var">e</span>) <span class="id" title="var">exp</span>= <span class="id" title="var">e</span> * <span class="id" title="var">log</span> <span class="id" title="var">a</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">anz</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">e</span> <span class="id" title="keyword">using</span> <span class="id" title="var">Z.peano_ind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> <span class="id" title="var">pow_0_r</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">log_1_l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">replace</span> (<span class="id" title="var">Z.succ</span> <span class="id" title="var">e</span>) <span class="id" title="keyword">with</span> (<span class="id" title="var">e</span> + 1)%<span class="id" title="var">Z</span> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">pow_plus</span> <span class="id" title="tactic">by</span> <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">log_mul</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">IHe</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">replace</span> ((<span class="id" title="var">e</span> + 1) * <span class="id" title="var">log</span> <span class="id" title="var">a</span>)%<span class="id" title="var">Z</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">e</span> * <span class="id" title="var">log</span> <span class="id" title="var">a</span> + <span class="id" title="var">log</span> <span class="id" title="var">a</span>)%<span class="id" title="var">Z</span> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">pow_1_r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">replace</span> (<span class="id" title="var">Z.pred</span> <span class="id" title="var">e</span>) <span class="id" title="keyword">with</span> (<span class="id" title="var">e</span> + (-1))%<span class="id" title="var">Z</span> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">pow_plus</span> <span class="id" title="tactic">by</span> <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">log_mul</span> <span class="id" title="tactic">by</span> <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">IHe</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> (<span class="id" title="var">pow_opp_1</span> <span class="id" title="var">a</span>) <span class="id" title="tactic">by</span> <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">log_inv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">replace</span> ((<span class="id" title="var">e</span> + -1) * <span class="id" title="var">log</span> <span class="id" title="var">a</span>)%<span class="id" title="var">Z</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">e</span> * <span class="id" title="var">log</span> <span class="id" title="var">a</span> + - <span class="id" title="var">log</span> <span class="id" title="var">a</span>)%<span class="id" title="var">Z</span> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Instance</span> <span class="id" title="var">pow_generator_proper</span> : <span class="id" title="var">Proper</span> (<span class="id" title="var">expeq</span> ==&gt; <span class="id" title="var">elmeq</span>) (<span class="id" title="var">pow</span> <span class="id" title="var">generator</span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">pow_exp_proper</span> <span class="id" title="var">_</span> <span class="id" title="var">generator_nonzero</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">log_both</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">a</span> !== 0 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">b</span> !== 0 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">log</span> <span class="id" title="var">a</span> <span class="id" title="var">exp</span>= <span class="id" title="var">log</span> <span class="id" title="var">b</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">a</span> == <span class="id" title="var">b</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">an0</span> <span class="id" title="var">bn0</span> <span class="id" title="var">dleq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">generator</span> ^ <span class="id" title="var">log</span> <span class="id" title="var">a</span> == <span class="id" title="var">generator</span> ^ <span class="id" title="var">log</span> <span class="id" title="var">a</span>) <span class="id" title="keyword">as</span> <span class="id" title="var">H</span> <span class="id" title="tactic">by</span> <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">dleq</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span> <span class="id" title="tactic">at</span> 1.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> !<span class="id" title="var">pow_log</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span> <span class="id" title="tactic">by</span> <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">log_pow_generator</span> <span class="id" title="var">e</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">log</span> (<span class="id" title="var">generator</span> ^ <span class="id" title="var">e</span>) <span class="id" title="var">exp</span>= <span class="id" title="var">e</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">log_pow</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">log_generator</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z.mul_1_r</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">int_domain</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">a</span> !== 0 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">b</span> !== 0 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">a</span> * <span class="id" title="var">b</span> !== 0.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">an0</span> <span class="id" title="var">bn0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> (@<span class="id" title="var">field_is_integral_domain</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">A</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0 1<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">add</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mul</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span> =&gt; <span class="id" title="var">a</span> + (<span class="id" title="var">opp</span> <span class="id" title="var">b</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">opp</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span> =&gt; <span class="id" title="var">a</span> * (<span class="id" title="var">inv</span> <span class="id" title="var">b</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">inv</span>); <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">typeclasses</span> <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">constructor</span>; <span class="id" title="var">typeclasses</span> <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">F2AF</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">typeclasses</span> <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">constructor</span>; <span class="id" title="var">typeclasses</span> <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">apply</span> (<span class="id" title="var">BoardroomAxioms_field_theory</span> <span class="id" title="tactic">field</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Hint Resolve</span> <span class="id" title="var">int_domain</span> : <span class="id" title="var">core</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">prod_units</span> (<span class="id" title="var">xs</span> : <span class="id" title="var">list</span> <span class="id" title="var">A</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">All</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">x</span> =&gt; <span class="id" title="var">x</span> !== 0) <span class="id" title="var">xs</span> &lt;-&gt; <span class="id" title="var">prod</span> <span class="id" title="var">xs</span> !== 0.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">xs</span> <span class="id" title="keyword">as</span> [|<span class="id" title="var">x</span> <span class="id" title="var">xs</span> <span class="id" title="var">IH</span>]; <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">split</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">int_domain</span>; <span class="id" title="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">intros</span> <span class="id" title="var">xprod</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id" title="tactic">intros</span> <span class="id" title="var">eq</span>; <span class="id" title="tactic">rewrite</span> <span class="id" title="var">eq</span> <span class="id" title="tactic">in</span> *; <span class="id" title="tactic">rewrite</span> <span class="id" title="var">mul_0_l</span> <span class="id" title="tactic">in</span> <span class="id" title="var">xprod</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">xprod</span> <span class="id" title="keyword">ltac</span>:(<span class="id" title="tactic">reflexivity</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id" title="tactic">apply</span> <span class="id" title="var">IH</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">eq</span>; <span class="id" title="tactic">rewrite</span> <span class="id" title="var">eq</span> <span class="id" title="tactic">in</span> *; <span class="id" title="tactic">rewrite</span> <span class="id" title="var">mul_comm</span>, <span class="id" title="var">mul_0_l</span> <span class="id" title="tactic">in</span> <span class="id" title="var">xprod</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">xprod</span> <span class="id" title="keyword">ltac</span>:(<span class="id" title="tactic">reflexivity</span>)).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Hint Resolve</span> -&gt; <span class="id" title="var">prod_units</span> : <span class="id" title="var">core</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Hint Resolve</span> &lt;- <span class="id" title="var">prod_units</span> : <span class="id" title="var">core</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">compute_public_key_unit</span> <span class="id" title="var">sk</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">compute_public_key</span> <span class="id" title="var">sk</span> !== 0.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">pow_nonzero</span>, <span class="id" title="var">generator_nonzero</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Hint Resolve</span> <span class="id" title="var">compute_public_key_unit</span> : <span class="id" title="var">core</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">compute_public_keys_units</span> <span class="id" title="var">sks</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">All</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">x</span> =&gt; <span class="id" title="var">x</span> !== 0) (<span class="id" title="var">map</span> <span class="id" title="var">compute_public_key</span> <span class="id" title="var">sks</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">sks</span> <span class="id" title="keyword">as</span> [|<span class="id" title="var">sk</span> <span class="id" title="var">sks</span> <span class="id" title="var">IH</span>]; <span class="id" title="var">cbn</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Hint Resolve</span> <span class="id" title="var">compute_public_keys_units</span> : <span class="id" title="var">core</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">reconstructed_key_unit</span> <span class="id" title="var">pks</span> <span class="id" title="var">i</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">All</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">a</span> =&gt; <span class="id" title="var">a</span> !== 0) <span class="id" title="var">pks</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">reconstructed_key</span> <span class="id" title="var">pks</span> <span class="id" title="var">i</span> !== 0.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">all</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">reconstructed_key</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">int_domain</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">prod_units</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> (<span class="id" title="var">all_incl</span> (<span class="id" title="var">firstn</span> <span class="id" title="var">i</span> <span class="id" title="var">pks</span>) <span class="id" title="var">pks</span>); <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">firstn_incl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">inv_nonzero</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">prod_units</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> (<span class="id" title="var">all_incl</span> (<span class="id" title="var">skipn</span> (<span class="id" title="var">S</span> <span class="id" title="var">i</span>) <span class="id" title="var">pks</span>) <span class="id" title="var">pks</span>); <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">skipn_incl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">compute_public_vote_unit</span> <span class="id" title="var">rk</span> <span class="id" title="var">sk</span> <span class="id" title="var">sv</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rk</span> !== 0 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">compute_public_vote</span> <span class="id" title="var">rk</span> <span class="id" title="var">sk</span> <span class="id" title="var">sv</span> !== 0.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">rk_unit</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">compute_public_vote</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">sv</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Hint Resolve</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">compute_public_key_unit</span> <span class="id" title="var">compute_public_keys_units</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">reconstructed_key_unit</span> <span class="id" title="var">compute_public_vote_unit</span> : <span class="id" title="var">core</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">log_prod</span> (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> <span class="id" title="var">A</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">All</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">a</span> =&gt; <span class="id" title="var">a</span> !== 0) <span class="id" title="var">l</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">log</span> (<span class="id" title="var">prod</span> <span class="id" title="var">l</span>) <span class="id" title="var">exp</span>= <span class="id" title="var">sumZ</span> <span class="id" title="var">log</span> <span class="id" title="var">l</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">all</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">l</span> <span class="id" title="keyword">as</span> [|<span class="id" title="var">x</span> <span class="id" title="var">xs</span> <span class="id" title="var">IH</span>]; <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">log_1_l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">specialize</span> (<span class="id" title="var">IH</span> (<span class="id" title="var">proj2</span> <span class="id" title="var">all</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">all</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">log_mul</span> <span class="id" title="tactic">by</span> <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">IH</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">prod_firstn_units</span> <span class="id" title="var">n</span> <span class="id" title="var">l</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">prod</span> <span class="id" title="var">l</span> !== 0 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">prod</span> (<span class="id" title="var">firstn</span> <span class="id" title="var">n</span> <span class="id" title="var">l</span>) !== 0.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">prodl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">prod_units</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">pose</span> <span class="id" title="var">proof</span> (<span class="id" title="var">firstn_incl</span> <span class="id" title="var">n</span> <span class="id" title="var">l</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">all_incl</span> <span class="id" title="keyword">with</span> <span class="id" title="var">l</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Hint Resolve</span> <span class="id" title="var">prod_firstn_units</span> : <span class="id" title="var">core</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">prod_skipn_units</span> <span class="id" title="var">n</span> <span class="id" title="var">l</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">prod</span> <span class="id" title="var">l</span> !== 0 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">prod</span> (<span class="id" title="var">skipn</span> <span class="id" title="var">n</span> <span class="id" title="var">l</span>) !== 0.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">prodl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">prod_units</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">pose</span> <span class="id" title="var">proof</span> (<span class="id" title="var">skipn_incl</span> <span class="id" title="var">n</span> <span class="id" title="var">l</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">all_incl</span> <span class="id" title="keyword">with</span> <span class="id" title="var">l</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Hint Resolve</span> <span class="id" title="var">prod_skipn_units</span> : <span class="id" title="var">core</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Local Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">Z</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">sum_lemma</span> <span class="id" title="var">l</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">sumZ</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">i</span> =&gt; <span class="id" title="var">nth</span> <span class="id" title="var">i</span> <span class="id" title="var">l</span> 0 *<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">sumZ</span> <span class="id" title="var">id</span> (<span class="id" title="var">firstn</span> <span class="id" title="var">i</span> <span class="id" title="var">l</span>) -<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">sumZ</span> <span class="id" title="var">id</span> (<span class="id" title="var">skipn</span> (<span class="id" title="var">S</span> <span class="id" title="var">i</span>) <span class="id" title="var">l</span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">seq</span> 0 (<span class="id" title="var">length</span> <span class="id" title="var">l</span>)) = 0.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> (<span class="id" title="var">sumZ_seq_feq</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <span class="id" title="var">i</span> =&gt; <span class="id" title="var">sumZ</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">j</span> =&gt; <span class="id" title="keyword">if</span> <span class="id" title="var">Nat.ltb</span> <span class="id" title="var">j</span> <span class="id" title="var">i</span> <span class="id" title="keyword">then</span> <span class="id" title="var">nth</span> <span class="id" title="var">i</span> <span class="id" title="var">l</span> 0 * <span class="id" title="var">nth</span> <span class="id" title="var">j</span> <span class="id" title="var">l</span> 0 <span class="id" title="keyword">else</span> 0)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">seq</span> 0 (<span class="id" title="var">length</span> <span class="id" title="var">l</span>)) -<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">sumZ</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">j</span> =&gt; <span class="id" title="keyword">if</span> <span class="id" title="var">Nat.ltb</span> <span class="id" title="var">i</span> <span class="id" title="var">j</span> <span class="id" title="keyword">then</span> <span class="id" title="var">nth</span> <span class="id" title="var">i</span> <span class="id" title="var">l</span> 0 * <span class="id" title="var">nth</span> <span class="id" title="var">j</span> <span class="id" title="var">l</span> 0 <span class="id" title="keyword">else</span> 0)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">seq</span> 0 (<span class="id" title="var">length</span> <span class="id" title="var">l</span>))));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cycle</span> 1.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">i</span> ?.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z.mul_sub_distr_l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> 2!<span class="id" title="var">sumZ_mul</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">id</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> (<span class="id" title="var">sumZ_firstn</span> 0) <span class="id" title="tactic">by</span> (<span class="id" title="tactic">right</span>; <span class="id" title="var">lia</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> (<span class="id" title="var">sumZ_skipn</span> 0).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">f_equal2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> (<span class="id" title="var">sumZ_seq_split</span> <span class="id" title="var">i</span>) <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z.add_comm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span> -[<span class="id" title="var">Nat.ltb</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">sumZ_seq_n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> (<span class="id" title="var">sumZ_seq_feq</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> =&gt; 0)); <span class="id" title="var">cycle</span> 1.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">intros</span> <span class="id" title="var">j</span> <span class="id" title="var">jlt</span>. <span class="id" title="tactic">destruct</span> (<span class="id" title="var">Nat.ltb_spec</span> (<span class="id" title="var">j</span> + <span class="id" title="var">i</span>) <span class="id" title="var">i</span>); <span class="id" title="tactic">auto</span>; <span class="id" title="var">lia</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">sumZ_zero</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span> -[<span class="id" title="var">Nat.ltb</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">sumZ_seq_feq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">j</span> <span class="id" title="var">jlt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">Nat.ltb_spec</span> <span class="id" title="var">j</span> <span class="id" title="var">i</span>); <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> (<span class="id" title="var">sumZ_seq_split</span> (<span class="id" title="var">S</span> <span class="id" title="var">i</span>)) <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> (<span class="id" title="var">sumZ_seq_feq</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> =&gt; 0)); <span class="id" title="var">cycle</span> 1.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">intros</span> <span class="id" title="var">j</span> <span class="id" title="var">jlt</span>. <span class="id" title="tactic">destruct</span> (<span class="id" title="var">Nat.ltb_spec</span> <span class="id" title="var">i</span> <span class="id" title="var">j</span>); <span class="id" title="tactic">auto</span>; <span class="id" title="var">lia</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">sumZ_zero</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">sumZ_seq_n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">replace</span> (<span class="id" title="var">length</span> <span class="id" title="var">l</span> - <span class="id" title="var">S</span> <span class="id" title="var">i</span>)%<span class="id" title="var">nat</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">length</span> <span class="id" title="var">l</span> - <span class="id" title="var">i</span> - 1)%<span class="id" title="var">nat</span> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">sumZ_seq_feq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">j</span> <span class="id" title="var">jlt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">replace</span> (<span class="id" title="var">j</span> + <span class="id" title="var">S</span> <span class="id" title="var">i</span>)%<span class="id" title="var">nat</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">S</span> (<span class="id" title="var">i</span> + <span class="id" title="var">j</span>))%<span class="id" title="var">nat</span> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">Nat.leb_spec</span> <span class="id" title="var">i</span> (<span class="id" title="var">i</span> + <span class="id" title="var">j</span>)); <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">sumZ_sub</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">sumZ_sumZ_swap</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [|- ?<span class="id" title="var">a</span> - ?<span class="id" title="var">b</span> = 0] =&gt; <span class="id" title="var">enough</span> (<span class="id" title="var">a</span> = <span class="id" title="var">b</span>) <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">sumZ_seq_feq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">i</span> <span class="id" title="var">ilt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">sumZ_seq_feq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">j</span> <span class="id" title="var">jlt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">i</span> &lt;? <span class="id" title="var">j</span>)%<span class="id" title="var">nat</span>; <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Local Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">broom</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">mul_public_votes</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">sks</span> : <span class="id" title="var">list</span> <span class="id" title="var">Z</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">votes</span> : <span class="id" title="var">nat</span> -&gt; <span class="id" title="var">bool</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">prod</span> (<span class="id" title="var">map</span> (<span class="id" title="keyword">fun</span> (<span class="id" title="var">i</span> : <span class="id" title="var">nat</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">compute_public_vote</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">reconstructed_key</span> (<span class="id" title="var">map</span> <span class="id" title="var">compute_public_key</span> <span class="id" title="var">sks</span>) <span class="id" title="var">i</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">nth</span> <span class="id" title="var">i</span> <span class="id" title="var">sks</span> 0%<span class="id" title="var">Z</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">votes</span> <span class="id" title="var">i</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">seq</span> 0 (<span class="id" title="var">length</span> <span class="id" title="var">sks</span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;== <span class="id" title="var">generator</span> ^ <span class="id" title="var">sumZ</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">i</span> =&gt; <span class="id" title="keyword">if</span> <span class="id" title="var">votes</span> <span class="id" title="var">i</span> <span class="id" title="keyword">then</span> 1 <span class="id" title="keyword">else</span> 0)%<span class="id" title="var">Z</span> (<span class="id" title="var">seq</span> 0 (<span class="id" title="var">length</span> <span class="id" title="var">sks</span>)).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">log_both</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">induction</span> (<span class="id" title="var">seq</span> 0 (<span class="id" title="var">length</span> <span class="id" title="var">sks</span>)); <span class="id" title="var">cbn</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> <span class="id" title="var">log_pow_generator</span>, <span class="id" title="var">log_prod</span>; <span class="id" title="var">cycle</span> 1.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">induction</span> (<span class="id" title="var">seq</span> 0 (<span class="id" title="var">length</span> <span class="id" title="var">sks</span>)); <span class="id" title="var">cbn</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">sumZ_map</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">compute_public_vote</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">etransitivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">sumZ_seq_feq_rel</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">typeclasses</span> <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">i</span> <span class="id" title="var">ilt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">log_mul</span> <span class="id" title="tactic">at</span> 1 <span class="id" title="tactic">by</span> (<span class="id" title="tactic">destruct</span> (<span class="id" title="var">votes</span> <span class="id" title="var">i</span>); <span class="id" title="tactic">auto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_replace</span> (<span class="id" title="var">log</span> (<span class="id" title="keyword">if</span> <span class="id" title="var">votes</span> <span class="id" title="var">i</span> <span class="id" title="keyword">then</span> <span class="id" title="var">generator</span> <span class="id" title="keyword">else</span> 1))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">with</span> (<span class="id" title="keyword">if</span> <span class="id" title="var">votes</span> <span class="id" title="var">i</span> <span class="id" title="keyword">then</span> 1%<span class="id" title="var">Z</span> <span class="id" title="keyword">else</span> 0%<span class="id" title="var">Z</span>) <span class="id" title="tactic">at</span> 1;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cycle</span> 1.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">destruct</span> (<span class="id" title="var">votes</span> <span class="id" title="var">i</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">rewrite</span> &lt;- (<span class="id" title="var">pow_1_r</span> <span class="id" title="var">generator</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">log_pow_generator</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">apply</span> <span class="id" title="var">log_1_l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> <span class="id" title="var">log_pow</span> <span class="id" title="tactic">at</span> 1 <span class="id" title="tactic">by</span> <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">reconstructed_key</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">log_mul</span> <span class="id" title="tactic">at</span> 1 <span class="id" title="tactic">by</span> <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">log_prod</span> <span class="id" title="tactic">at</span> 1 <span class="id" title="tactic">by</span> <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">log_inv</span> <span class="id" title="tactic">at</span> 1.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">log_prod</span> <span class="id" title="tactic">at</span> 1 <span class="id" title="tactic">by</span> <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> 2!(<span class="id" title="var">sumZ_map_id</span> <span class="id" title="var">log</span>) <span class="id" title="tactic">at</span> 1.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">firstn_map</span>, <span class="id" title="var">skipn_map</span>, !<span class="id" title="var">map_map</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">compute_public_key</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="keyword">forall</span> <span class="id" title="var">l</span>, <span class="id" title="var">sumZ</span> <span class="id" title="var">id</span> (<span class="id" title="var">map</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">x</span> =&gt; <span class="id" title="var">log</span> (<span class="id" title="var">generator</span> ^ <span class="id" title="var">x</span>)) <span class="id" title="var">l</span>) <span class="id" title="var">exp</span>= <span class="id" title="var">sumZ</span> <span class="id" title="var">id</span> <span class="id" title="var">l</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">clear</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">l</span>; <span class="id" title="var">cbn</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">unfold</span> <span class="id" title="var">id</span> <span class="id" title="tactic">at</span> 1 3.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">log_pow_generator</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">IHl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> 2!<span class="id" title="var">H</span> <span class="id" title="tactic">at</span> 1.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z.add_opp_r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">sumZ_add</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">sum_lemma</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Global Instance</span> <span class="id" title="var">prod_perm_proper</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Proper</span> (@<span class="id" title="var">Permutation</span> <span class="id" title="var">A</span> ==&gt; <span class="id" title="var">elmeq</span>) <span class="id" title="var">prod</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">l</span> <span class="id" title="var">l'</span> <span class="id" title="var">permeq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">permeq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">IHpermeq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> !<span class="id" title="var">mul_assoc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> (<span class="id" title="var">mul_comm</span> <span class="id" title="var">y</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">IHpermeq1</span>, <span class="id" title="var">IHpermeq2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Global Instance</span> <span class="id" title="var">bruteforce_tally_aux_proper</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Proper</span> (<span class="id" title="var">eq</span> ==&gt; <span class="id" title="var">elmeq</span> ==&gt; <span class="id" title="var">eq</span>) <span class="id" title="var">bruteforce_tally_aux</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">n</span> ? &lt;- <span class="id" title="var">p</span> <span class="id" title="var">p'</span> <span class="id" title="var">prodeq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">n</span> <span class="id" title="keyword">as</span> [|<span class="id" title="var">n</span> <span class="id" title="var">IH</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">elmeqb_spec</span> (<span class="id" title="var">generator</span>^0) <span class="id" title="var">p</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">elmeqb_spec</span> (<span class="id" title="var">generator</span>^0) <span class="id" title="var">p'</span>); <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">rewrite</span> <span class="id" title="var">prodeq</span> <span class="id" title="tactic">in</span> <span class="id" title="var">e</span>; <span class="id" title="var">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">prodeq</span> <span class="id" title="tactic">in</span> <span class="id" title="var">e</span>; <span class="id" title="var">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">elmeqb_spec</span> (<span class="id" title="var">generator</span>^<span class="id" title="var">Z.pos</span> (<span class="id" title="var">Pos.of_succ_nat</span> <span class="id" title="var">n</span>)) <span class="id" title="var">p</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">elmeqb_spec</span> (<span class="id" title="var">generator</span>^<span class="id" title="var">Z.pos</span> (<span class="id" title="var">Pos.of_succ_nat</span> <span class="id" title="var">n</span>)) <span class="id" title="var">p'</span>); <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">rewrite</span> <span class="id" title="var">prodeq</span> <span class="id" title="tactic">in</span> <span class="id" title="var">e</span>; <span class="id" title="var">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">prodeq</span> <span class="id" title="tactic">in</span> <span class="id" title="var">e</span>; <span class="id" title="var">contradiction</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Global Instance</span> <span class="id" title="var">bruteforce_tally_proper</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Proper</span> (@<span class="id" title="var">Permutation</span> <span class="id" title="var">A</span> ==&gt; <span class="id" title="var">eq</span>) <span class="id" title="var">bruteforce_tally</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">bruteforce_tally</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">intros</span> ? ? &lt;-.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Global Instance</span> <span class="id" title="var">elmeqb_elmeq_proper</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Proper</span> (<span class="id" title="var">elmeq</span> ==&gt; <span class="id" title="var">elmeq</span> ==&gt; <span class="id" title="var">eq</span>) <span class="id" title="var">elmeqb</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">x</span> <span class="id" title="var">x'</span> <span class="id" title="var">xeq</span> <span class="id" title="var">y</span> <span class="id" title="var">y'</span> <span class="id" title="var">yeq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">elmeqb_spec</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>), (<span class="id" title="var">elmeqb_spec</span> <span class="id" title="var">x'</span> <span class="id" title="var">y'</span>); <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">contradiction</span> <span class="id" title="var">n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">xeq</span>, &lt;- <span class="id" title="var">yeq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">contradiction</span> <span class="id" title="var">n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">xeq</span>, <span class="id" title="var">yeq</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">elmeqb_refl</span> <span class="id" title="var">a</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">a</span> =? <span class="id" title="var">a</span> = <span class="id" title="var">true</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">elmeqb_spec</span> <span class="id" title="var">a</span> <span class="id" title="var">a</span>); [<span class="id" title="var">easy</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contradiction</span> <span class="id" title="var">n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">bruteforce_tally_aux_correct</span> <span class="id" title="var">result</span> <span class="id" title="var">max</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Z.of_nat</span> <span class="id" title="var">max</span> &lt; <span class="id" title="var">order</span> - 1 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">result</span> &lt;= <span class="id" title="var">max</span>)%<span class="id" title="var">nat</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">bruteforce_tally_aux</span> <span class="id" title="var">max</span> (<span class="id" title="var">generator</span> ^ <span class="id" title="var">Z.of_nat</span> <span class="id" title="var">result</span>) = <span class="id" title="var">Some</span> <span class="id" title="var">result</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">max_lt</span> <span class="id" title="var">result_le</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">max</span> <span class="id" title="keyword">as</span> [|<span class="id" title="var">max</span> <span class="id" title="var">IH</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">replace</span> <span class="id" title="var">result</span> <span class="id" title="keyword">with</span> 0%<span class="id" title="var">nat</span> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">elmeqb_refl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">destruct</span> (<span class="id" title="var">Nat.eq_dec</span> <span class="id" title="var">result</span> (<span class="id" title="var">S</span> <span class="id" title="var">max</span>)) <span class="id" title="keyword">as</span> [-&gt;|?].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">elmeqb_refl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">cbn</span> -[<span class="id" title="var">Z.of_nat</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">elmeqb_spec</span> (<span class="id" title="var">generator</span> ^ <span class="id" title="var">Z.of_nat</span> (<span class="id" title="var">S</span> <span class="id" title="var">max</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">generator</span> ^ <span class="id" title="var">Z.of_nat</span> <span class="id" title="var">result</span>)) <span class="id" title="keyword">as</span> [<span class="id" title="var">eq</span>|?]; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id" title="tactic">pose</span> <span class="id" title="var">proof</span> (<span class="id" title="var">generator_generates</span> (<span class="id" title="var">generator</span> ^ <span class="id" title="var">Z.of_nat</span> <span class="id" title="var">result</span>) <span class="id" title="keyword">ltac</span>:(<span class="id" title="tactic">auto</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">e</span> [<span class="id" title="var">sat</span> <span class="id" title="var">unique</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">unshelve</span> <span class="id" title="var">epose</span> <span class="id" title="var">proof</span> (<span class="id" title="var">unique</span> (<span class="id" title="var">Z.of_nat</span> (<span class="id" title="var">S</span> <span class="id" title="var">max</span>)) <span class="id" title="var">_</span>) <span class="id" title="keyword">as</span> <span class="id" title="var">smax</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">split</span>; <span class="id" title="tactic">auto</span>; <span class="id" title="var">lia</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">unshelve</span> <span class="id" title="var">epose</span> <span class="id" title="var">proof</span> (<span class="id" title="var">unique</span> (<span class="id" title="var">Z.of_nat</span> <span class="id" title="var">result</span>) <span class="id" title="var">_</span>) <span class="id" title="keyword">as</span> <span class="id" title="var">res</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">split</span>; [<span class="id" title="var">lia</span>|<span class="id" title="tactic">reflexivity</span>]. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- (<span class="id" title="var">Z2Nat.id</span> <span class="id" title="var">e</span>) <span class="id" title="tactic">in</span> <span class="id" title="var">smax</span>, <span class="id" title="var">res</span> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Nat2Z.inj</span> <span class="id" title="tactic">in</span> <span class="id" title="var">smax</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Nat2Z.inj</span> <span class="id" title="tactic">in</span> <span class="id" title="var">res</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id" title="tactic">apply</span> <span class="id" title="var">IH</span>; <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">sumZ_sumnat_votes</span> (<span class="id" title="var">svs</span> : <span class="id" title="var">nat</span> -&gt; <span class="id" title="var">bool</span>) <span class="id" title="var">l</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">sumZ</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">i</span> =&gt; <span class="id" title="keyword">if</span> <span class="id" title="var">svs</span> <span class="id" title="var">i</span> <span class="id" title="keyword">then</span> 1%<span class="id" title="var">Z</span> <span class="id" title="keyword">else</span> 0%<span class="id" title="var">Z</span>) <span class="id" title="var">l</span> =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Z.of_nat</span> (<span class="id" title="var">sumnat</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">i</span> =&gt; <span class="id" title="keyword">if</span> <span class="id" title="var">svs</span> <span class="id" title="var">i</span> <span class="id" title="keyword">then</span> 1%<span class="id" title="var">nat</span> <span class="id" title="keyword">else</span> 0%<span class="id" title="var">nat</span>) <span class="id" title="var">l</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">l</span> <span class="id" title="keyword">as</span> [|<span class="id" title="var">x</span> <span class="id" title="var">xs</span> <span class="id" title="var">IH</span>]; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">IH</span>, <span class="id" title="var">Nat2Z.inj_add</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">svs</span> <span class="id" title="var">x</span>); <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">bruteforce_tally_correct</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id" title="var">B</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">bs</span> : <span class="id" title="var">list</span> <span class="id" title="var">B</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">index</span> : <span class="id" title="var">B</span> -&gt; <span class="id" title="var">nat</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">sks</span> : <span class="id" title="var">B</span> -&gt; <span class="id" title="var">Z</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">pks</span> : <span class="id" title="var">list</span> <span class="id" title="var">A</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">svs</span> : <span class="id" title="var">B</span> -&gt; <span class="id" title="var">bool</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">pvs</span> : <span class="id" title="var">B</span> -&gt; <span class="id" title="var">A</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Z.of_nat</span> (<span class="id" title="var">length</span> <span class="id" title="var">bs</span>) &lt; <span class="id" title="var">order</span> - 1 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Permutation</span> (<span class="id" title="var">map</span> <span class="id" title="var">index</span> <span class="id" title="var">bs</span>) (<span class="id" title="var">seq</span> 0 (<span class="id" title="var">length</span> <span class="id" title="var">bs</span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">length</span> <span class="id" title="var">pks</span> = <span class="id" title="var">length</span> <span class="id" title="var">bs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">forall</span> <span class="id" title="var">b</span>, <span class="id" title="var">In</span> <span class="id" title="var">b</span> <span class="id" title="var">bs</span> -&gt; <span class="id" title="var">nth_error</span> <span class="id" title="var">pks</span> (<span class="id" title="var">index</span> <span class="id" title="var">b</span>) = <span class="id" title="var">Some</span> (<span class="id" title="var">compute_public_key</span> (<span class="id" title="var">sks</span> <span class="id" title="var">b</span>))) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">forall</span> <span class="id" title="var">b</span>, <span class="id" title="var">In</span> <span class="id" title="var">b</span> <span class="id" title="var">bs</span> -&gt; <span class="id" title="var">pvs</span> <span class="id" title="var">b</span> = <span class="id" title="var">compute_public_vote</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">reconstructed_key</span> <span class="id" title="var">pks</span> (<span class="id" title="var">index</span> <span class="id" title="var">b</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">sks</span> <span class="id" title="var">b</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">svs</span> <span class="id" title="var">b</span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">bruteforce_tally</span> (<span class="id" title="var">map</span> <span class="id" title="var">pvs</span> <span class="id" title="var">bs</span>) =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Some</span> (<span class="id" title="var">sumnat</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">b</span> =&gt; <span class="id" title="keyword">if</span> <span class="id" title="var">svs</span> <span class="id" title="var">b</span> <span class="id" title="keyword">then</span> 1 <span class="id" title="keyword">else</span> 0)%<span class="id" title="var">nat</span> <span class="id" title="var">bs</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">countlt</span> <span class="id" title="var">perm</span> <span class="id" title="var">len_pks</span> <span class="id" title="var">pks_sks</span> <span class="id" title="var">pvs_svs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">set</span> (<span class="id" title="var">geti</span> <span class="id" title="var">i</span> := <span class="id" title="var">find</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">b</span> =&gt; <span class="id" title="var">index</span> <span class="id" title="var">b</span> =? <span class="id" title="var">i</span>)%<span class="id" title="var">nat</span> <span class="id" title="var">bs</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">set</span> (<span class="id" title="var">sks_list</span> := <span class="id" title="var">map</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">i</span> =&gt; <span class="id" title="keyword">match</span> <span class="id" title="var">geti</span> <span class="id" title="var">i</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Some</span> <span class="id" title="var">x</span> =&gt; <span class="id" title="var">sks</span> <span class="id" title="var">x</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">None</span> =&gt; 0%<span class="id" title="var">Z</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">seq</span> 0 (<span class="id" title="var">length</span> <span class="id" title="var">bs</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">set</span> (<span class="id" title="var">svsi</span> <span class="id" title="var">i</span> := <span class="id" title="keyword">match</span> <span class="id" title="var">geti</span> <span class="id" title="var">i</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Some</span> <span class="id" title="var">x</span> =&gt; <span class="id" title="var">svs</span> <span class="id" title="var">x</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">None</span> =&gt; <span class="id" title="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">pose</span> <span class="id" title="var">proof</span> (<span class="id" title="var">mul_public_votes</span> <span class="id" title="var">sks_list</span> <span class="id" title="var">svsi</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">geti_i</span>: <span class="id" title="keyword">forall</span> <span class="id" title="var">b</span> <span class="id" title="var">i</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">In</span> <span class="id" title="var">b</span> <span class="id" title="var">bs</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">index</span> <span class="id" title="var">b</span> = <span class="id" title="var">i</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">geti</span> <span class="id" title="var">i</span> = <span class="id" title="var">Some</span> <span class="id" title="var">b</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">clear</span> -<span class="id" title="var">perm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">b</span> <span class="id" title="var">i</span> <span class="id" title="var">isin</span> <span class="id" title="var">index_eq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">pose</span> <span class="id" title="var">proof</span> (<span class="id" title="var">seq_NoDup</span> (<span class="id" title="var">length</span> <span class="id" title="var">bs</span>) 0).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">perm</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">clear</span> <span class="id" title="var">perm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span> <span class="id" title="var">geti</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">bs</span> <span class="id" title="keyword">as</span> [|<span class="id" title="var">b'</span> <span class="id" title="var">bs</span> <span class="id" title="var">IH</span>]; <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *; <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">isin</span> <span class="id" title="keyword">as</span> [&lt;-|?].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">index_eq</span>, <span class="id" title="var">Nat.eqb_refl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">Nat.eqb_spec</span> (<span class="id" title="var">index</span> <span class="id" title="var">b'</span>) (<span class="id" title="var">index</span> <span class="id" title="var">b</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">rewrite</span> <span class="id" title="var">e</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> (<span class="id" title="var">in_map</span> <span class="id" title="var">index</span>) <span class="id" title="tactic">in</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">e</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">apply</span> <span class="id" title="var">IH</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">map_on_bs</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> {<span class="id" title="var">C</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">B</span> -&gt; <span class="id" title="var">C</span>) (<span class="id" title="var">def</span> : <span class="id" title="var">C</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Permutation</span> (<span class="id" title="var">map</span> <span class="id" title="var">f</span> <span class="id" title="var">bs</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">map</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">i</span> =&gt; <span class="id" title="keyword">match</span> <span class="id" title="var">geti</span> <span class="id" title="var">i</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Some</span> <span class="id" title="var">b</span> =&gt; <span class="id" title="var">f</span> <span class="id" title="var">b</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">None</span> =&gt; <span class="id" title="var">def</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>) (<span class="id" title="var">seq</span> 0 (<span class="id" title="var">length</span> <span class="id" title="var">bs</span>)))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">C</span> <span class="id" title="var">f</span> <span class="id" title="var">def</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">perm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">map_map</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [|- <span class="id" title="var">Permutation</span> ?<span class="id" title="var">l</span> ?<span class="id" title="var">l'</span>] =&gt; <span class="id" title="var">enough</span> (<span class="id" title="var">l</span> = <span class="id" title="var">l'</span>) <span class="id" title="keyword">as</span> <span class="id" title="var">eq</span> <span class="id" title="tactic">by</span> (<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">eq</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">map_ext_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">b</span> <span class="id" title="var">inbbs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">geti_i</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">b</span> := <span class="id" title="var">b</span>) <span class="id" title="tactic">by</span> <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">Permutation</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">map</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">i</span> : <span class="id" title="var">nat</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">compute_public_vote</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">reconstructed_key</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">map</span> <span class="id" title="var">compute_public_key</span> <span class="id" title="var">sks_list</span>) <span class="id" title="var">i</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">nth</span> <span class="id" title="var">i</span> <span class="id" title="var">sks_list</span> 0%<span class="id" title="var">Z</span>) (<span class="id" title="var">svsi</span> <span class="id" title="var">i</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">seq</span> 0 (<span class="id" title="var">length</span> <span class="id" title="var">sks_list</span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">map</span> <span class="id" title="var">pvs</span> <span class="id" title="var">bs</span>))%<span class="id" title="var">nat</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> (<span class="id" title="var">map_on_bs</span> <span class="id" title="var">_</span> <span class="id" title="var">pvs</span> 0).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">sks_list</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">map_length</span>, <span class="id" title="var">seq_length</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [|- <span class="id" title="var">Permutation</span> ?<span class="id" title="var">l</span> ?<span class="id" title="var">l'</span>] =&gt; <span class="id" title="var">enough</span> (<span class="id" title="var">l</span> = <span class="id" title="var">l'</span>) <span class="id" title="keyword">as</span> <span class="id" title="var">eq</span> <span class="id" title="tactic">by</span> (<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">eq</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">map_ext_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">i</span> <span class="id" title="var">iin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">i</span> &lt; <span class="id" title="var">length</span> <span class="id" title="var">bs</span>)%<span class="id" title="var">nat</span> <span class="id" title="tactic">by</span> (<span class="id" title="tactic">apply</span> <span class="id" title="var">in_seq</span> <span class="id" title="tactic">in</span> <span class="id" title="var">iin</span>; <span class="id" title="var">lia</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">map_nth_alt</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">d2</span> := 0%<span class="id" title="var">nat</span>) <span class="id" title="tactic">by</span> (<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">seq_length</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">seq_nth</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">perm</span> <span class="id" title="tactic">in</span> <span class="id" title="var">iin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">in_map_iff</span> <span class="id" title="tactic">in</span> <span class="id" title="var">iin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">iin</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">b</span> [<span class="id" title="var">indexb</span> <span class="id" title="var">inbbs</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">svsi</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">geti_i</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">b</span> := <span class="id" title="var">b</span>) <span class="id" title="tactic">by</span> <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">pvs_svs</span> <span class="id" title="tactic">by</span> <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span> <span class="id" title="var">i</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">map_map</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">f_equal</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">f_equal</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">clear</span> -<span class="id" title="var">perm</span> <span class="id" title="var">len_pks</span> <span class="id" title="var">pks_sks</span> <span class="id" title="var">geti_i</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">list_eq_nth</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">map_length</span>, <span class="id" title="var">seq_length</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">i</span> <span class="id" title="var">a</span> <span class="id" title="var">a'</span> <span class="id" title="var">ntha</span> <span class="id" title="var">ntha'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">isin</span>: <span class="id" title="var">In</span> <span class="id" title="var">i</span> (<span class="id" title="var">seq</span> 0 (<span class="id" title="var">length</span> <span class="id" title="var">bs</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">in_seq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">len_pks</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span>; <span class="id" title="tactic">apply</span> <span class="id" title="var">nth_error_Some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">i</span> &lt; <span class="id" title="var">length</span> <span class="id" title="var">bs</span>)%<span class="id" title="var">nat</span> <span class="id" title="tactic">by</span> (<span class="id" title="tactic">apply</span> <span class="id" title="var">in_seq</span> <span class="id" title="tactic">in</span> <span class="id" title="var">isin</span>; <span class="id" title="var">lia</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">perm</span> <span class="id" title="tactic">in</span> <span class="id" title="var">isin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">in_map_iff</span> <span class="id" title="tactic">in</span> <span class="id" title="var">isin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">isin</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">b</span> [<span class="id" title="var">indexb</span> <span class="id" title="var">inbbs</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span> <span class="id" title="var">i</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">pks_sks</span> <span class="id" title="tactic">in</span> <span class="id" title="var">ntha'</span> <span class="id" title="tactic">by</span> <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">map_nth_error</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">d</span> := <span class="id" title="var">index</span> <span class="id" title="var">b</span>) <span class="id" title="tactic">in</span> <span class="id" title="var">ntha</span> <span class="id" title="tactic">by</span> (<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">nth_error_seq_in</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">geti_i</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">b</span> := <span class="id" title="var">b</span>) <span class="id" title="tactic">in</span> <span class="id" title="var">ntha</span> <span class="id" title="tactic">by</span> <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">bruteforce_tally</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">map_length</span>, <span class="id" title="var">seq_length</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">mul_public_votes</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- (<span class="id" title="var">sumnat_map</span> <span class="id" title="var">svs</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">sv</span> =&gt; <span class="id" title="keyword">if</span> <span class="id" title="var">sv</span> <span class="id" title="keyword">then</span> 1%<span class="id" title="var">nat</span> <span class="id" title="keyword">else</span> 0%<span class="id" title="var">nat</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">enough</span> (<span class="id" title="var">Permutation</span> (<span class="id" title="var">map</span> <span class="id" title="var">svs</span> <span class="id" title="var">bs</span>) (<span class="id" title="var">map</span> <span class="id" title="var">svsi</span> (<span class="id" title="var">seq</span> 0 (<span class="id" title="var">length</span> <span class="id" title="var">sks_list</span>)))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">sumnat_map</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">sumZ_sumnat_votes</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">sks_list</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">map_length</span>, <span class="id" title="var">seq_length</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">bruteforce_tally_aux_correct</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">Nat.mul_1_l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- (<span class="id" title="var">seq_length</span> (<span class="id" title="var">length</span> <span class="id" title="var">bs</span>) 0) <span class="id" title="tactic">at</span> 2.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">sumnat_max</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">i</span> <span class="id" title="var">iin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">svsi</span> <span class="id" title="var">i</span>); <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">sks_list</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">map_length</span>, !<span class="id" title="var">seq_length</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">perm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">pose</span> <span class="id" title="var">proof</span> (<span class="id" title="var">seq_NoDup</span> (<span class="id" title="var">length</span> <span class="id" title="var">bs</span>) 0).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">perm</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">clear</span> -<span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">bs</span> <span class="id" title="keyword">as</span> [|<span class="id" title="var">b</span> <span class="id" title="var">bs</span> <span class="id" title="var">IH</span>]; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span> <span class="id" title="var">geti</span> <span class="id" title="var">svsi</span>; <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Nat.eqb_refl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H1</span>; <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> (<span class="id" title="var">map_ext_in</span> <span class="id" title="var">_</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">i</span> =&gt; <span class="id" title="keyword">match</span> <span class="id" title="var">find</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">b</span> =&gt; (<span class="id" title="var">index</span> <span class="id" title="var">b</span> =? <span class="id" title="var">i</span>)%<span class="id" title="var">nat</span>) <span class="id" title="var">bs</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Some</span> <span class="id" title="var">x</span> =&gt; <span class="id" title="var">svs</span> <span class="id" title="var">x</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">None</span> =&gt; <span class="id" title="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>)); <span class="id" title="var">cycle</span> 1.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">a</span> <span class="id" title="var">ain</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">Nat.eqb_spec</span> (<span class="id" title="var">index</span> <span class="id" title="var">b</span>) <span class="id" title="var">a</span>); <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span> <span class="id" title="var">a</span>; <span class="id" title="var">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Permutation_cons</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">End</span> <span class="id" title="var">WithBoardroomAxioms</span>.<br/>

<br/>
<span class="id" title="keyword">Module</span> <span class="id" title="var">Zp</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Local Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">Z</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">mod_pow_pos_aux</span> (<span class="id" title="var">a</span> : <span class="id" title="var">Z</span>) (<span class="id" title="var">x</span> : <span class="id" title="var">positive</span>) (<span class="id" title="var">m</span> : <span class="id" title="var">Z</span>) (<span class="id" title="var">r</span> : <span class="id" title="var">Z</span>) : <span class="id" title="var">Z</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">x</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">x</span>~0%<span class="id" title="var">positive</span> =&gt; <span class="id" title="var">mod_pow_pos_aux</span> (<span class="id" title="var">a</span> * <span class="id" title="var">a</span> <span class="id" title="var">mod</span> <span class="id" title="var">m</span>) <span class="id" title="var">x</span> <span class="id" title="var">m</span> <span class="id" title="var">r</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">x</span>~1%<span class="id" title="var">positive</span> =&gt; <span class="id" title="var">mod_pow_pos_aux</span> (<span class="id" title="var">a</span> * <span class="id" title="var">a</span> <span class="id" title="var">mod</span> <span class="id" title="var">m</span>) <span class="id" title="var">x</span> <span class="id" title="var">m</span> (<span class="id" title="var">r</span> * <span class="id" title="var">a</span> <span class="id" title="var">mod</span> <span class="id" title="var">m</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <span class="id" title="var">r</span> * <span class="id" title="var">a</span> <span class="id" title="var">mod</span> <span class="id" title="var">m</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">mod_pow_pos</span> (<span class="id" title="var">a</span> : <span class="id" title="var">Z</span>) (<span class="id" title="var">x</span> : <span class="id" title="var">positive</span>) (<span class="id" title="var">m</span> : <span class="id" title="var">Z</span>) : <span class="id" title="var">Z</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mod_pow_pos_aux</span> <span class="id" title="var">a</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span> 1.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">mod_inv</span> (<span class="id" title="var">a</span> : <span class="id" title="var">Z</span>) (<span class="id" title="var">p</span> : <span class="id" title="var">Z</span>) : <span class="id" title="var">Z</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">fst</span> (<span class="id" title="var">egcd</span> <span class="id" title="var">a</span> <span class="id" title="var">p</span>) <span class="id" title="var">mod</span> <span class="id" title="var">p</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">mod_pow</span> (<span class="id" title="var">a</span> <span class="id" title="var">x</span> <span class="id" title="var">p</span> : <span class="id" title="var">Z</span>) : <span class="id" title="var">Z</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">x</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Z0</span> =&gt; <span class="id" title="var">a</span> ^ 0 <span class="id" title="var">mod</span> <span class="id" title="var">p</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Zpos</span> <span class="id" title="var">x</span> =&gt; <span class="id" title="var">mod_pow_pos</span> <span class="id" title="var">a</span> <span class="id" title="var">x</span> <span class="id" title="var">p</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Zneg</span> <span class="id" title="var">x</span> =&gt; <span class="id" title="var">mod_inv</span> (<span class="id" title="var">mod_pow_pos</span> <span class="id" title="var">a</span> <span class="id" title="var">x</span> <span class="id" title="var">p</span>) <span class="id" title="var">p</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">Z_pow_pos_mod_idemp</span> <span class="id" title="var">a</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Z.pow_pos</span> (<span class="id" title="var">a</span> <span class="id" title="var">mod</span> <span class="id" title="var">m</span>) <span class="id" title="var">x</span> <span class="id" title="var">mod</span> <span class="id" title="var">m</span> = <span class="id" title="var">Z.pow_pos</span> <span class="id" title="var">a</span> <span class="id" title="var">x</span> <span class="id" title="var">mod</span> <span class="id" title="var">m</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">m</span> =? 0) <span class="id" title="var">eqn</span>:<span class="id" title="var">mzero</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Z.eqb_eq</span> <span class="id" title="tactic">in</span> <span class="id" title="var">mzero</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">mzero</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> 2!<span class="id" title="var">Zmod_0_r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Z.eqb_neq</span> <span class="id" title="tactic">in</span> <span class="id" title="var">mzero</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">Z.pow_pos</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">H</span>: <span class="id" title="keyword">forall</span> <span class="id" title="var">start</span> <span class="id" title="var">l</span> <span class="id" title="var">x</span>, <span class="id" title="var">Pos.iter</span> (<span class="id" title="var">Z.mul</span> <span class="id" title="var">l</span>) <span class="id" title="var">start</span> <span class="id" title="var">x</span> = <span class="id" title="var">start</span> * <span class="id" title="var">Pos.iter</span> (<span class="id" title="var">Z.mul</span> <span class="id" title="var">l</span>) 1 <span class="id" title="var">x</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">clear</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">start</span> <span class="id" title="var">l</span> <span class="id" title="var">x</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">revert</span> <span class="id" title="var">start</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">x</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">start</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> 2!<span class="id" title="var">IHx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> (<span class="id" title="var">IHx</span> (<span class="id" title="var">Pos.iter</span> (<span class="id" title="var">Z.mul</span> <span class="id" title="var">l</span>) 1 <span class="id" title="var">x</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> 2!<span class="id" title="var">IHx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> (<span class="id" title="var">IHx</span> (<span class="id" title="var">Pos.iter</span> (<span class="id" title="var">Z.mul</span> <span class="id" title="var">l</span>) 1 <span class="id" title="var">x</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">x</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> (<span class="id" title="var">H</span> <span class="id" title="var">_</span> (<span class="id" title="var">a</span> <span class="id" title="var">mod</span> <span class="id" title="var">m</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> (<span class="id" title="var">H</span> <span class="id" title="var">_</span> <span class="id" title="var">a</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z.mul_assoc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">H2</span>: <span class="id" title="keyword">forall</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span> <span class="id" title="var">c</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((<span class="id" title="var">a</span> <span class="id" title="var">mod</span> <span class="id" title="var">m</span>) * <span class="id" title="var">b</span> * <span class="id" title="var">c</span>) <span class="id" title="var">mod</span> <span class="id" title="var">m</span> = ((<span class="id" title="var">a</span> <span class="id" title="var">mod</span> <span class="id" title="var">m</span>) * (<span class="id" title="var">b</span> <span class="id" title="var">mod</span> <span class="id" title="var">m</span>) * (<span class="id" title="var">c</span> <span class="id" title="var">mod</span> <span class="id" title="var">m</span>)) <span class="id" title="var">mod</span> <span class="id" title="var">m</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">clear</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">Z.mul_assoc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Zmult_mod_idemp_l</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">Z.mul_assoc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Zmult_mod_idemp_l</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> 2!<span class="id" title="var">Z.mul_assoc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> (<span class="id" title="var">Z.mul_comm</span> <span class="id" title="var">_</span> (<span class="id" title="var">c</span> <span class="id" title="var">mod</span> <span class="id" title="var">m</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Zmult_mod_idemp_l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z.mul_assoc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> (<span class="id" title="var">Z.mul_comm</span> <span class="id" title="var">_</span> (<span class="id" title="var">b</span> <span class="id" title="var">mod</span> <span class="id" title="var">m</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Zmult_mod_idemp_l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">replace</span> (<span class="id" title="var">b</span> * (<span class="id" title="var">c</span> * <span class="id" title="var">a</span>)) <span class="id" title="keyword">with</span> (<span class="id" title="var">a</span> * <span class="id" title="var">b</span> * <span class="id" title="var">c</span>) <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">IHx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H2</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">Z.mul_assoc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Zmult_mod_idemp_l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z.mul_mod</span> <span class="id" title="tactic">by</span> <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">IHx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">Z.mul_mod</span> <span class="id" title="tactic">by</span> <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> 2!<span class="id" title="var">Z.mul_1_r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <span class="id" title="var">Z.mod_mod</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">mod_pow_pos_aux_0_r</span> <span class="id" title="var">a</span> <span class="id" title="var">x</span> <span class="id" title="var">r</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mod_pow_pos_aux</span> <span class="id" title="var">a</span> <span class="id" title="var">x</span> 0 <span class="id" title="var">r</span> = 0.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">revert</span> <span class="id" title="var">a</span> <span class="id" title="var">r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">x</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">a</span> <span class="id" title="var">r</span>; <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">now</span> (<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">rewrite</span> ?<span class="id" title="var">IHx</span>, ?<span class="id" title="var">Zmod_0_r</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">now</span> (<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">rewrite</span> ?<span class="id" title="var">IHx</span>, ?<span class="id" title="var">Zmod_0_r</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> !<span class="id" title="var">Zmod_0_r</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">mod_pow_pos_0_r</span> <span class="id" title="var">a</span> <span class="id" title="var">x</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mod_pow_pos</span> <span class="id" title="var">a</span> <span class="id" title="var">x</span> 0 = 0.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">mod_pow_pos_aux_0_r</span>. <span class="id" title="keyword">Qed</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">mod_pow_0_r</span> <span class="id" title="var">a</span> <span class="id" title="var">x</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mod_pow</span> <span class="id" title="var">a</span> <span class="id" title="var">x</span> 0 = 0.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">x</span>; <span class="id" title="tactic">auto</span>; <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">mod_pow_pos_0_r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">mod_pow_pos_0_r</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">mod_pow_pos_aux_spec</span> <span class="id" title="var">a</span> <span class="id" title="var">x</span> <span class="id" title="var">p</span> <span class="id" title="var">r</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mod_pow_pos_aux</span> <span class="id" title="var">a</span> <span class="id" title="var">x</span> <span class="id" title="var">p</span> <span class="id" title="var">r</span> = <span class="id" title="var">r</span> * <span class="id" title="var">Z.pow_pos</span> <span class="id" title="var">a</span> <span class="id" title="var">x</span> <span class="id" title="var">mod</span> <span class="id" title="var">p</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">Z.eq_dec</span> <span class="id" title="var">p</span> 0) <span class="id" title="keyword">as</span> [-&gt;|<span class="id" title="var">nonzero</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">mod_pow_pos_aux_0_r</span>, <span class="id" title="var">Zmod_0_r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">revert</span> <span class="id" title="var">a</span> <span class="id" title="var">r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">x</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">a</span> <span class="id" title="var">r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">cbn</span> -[<span class="id" title="var">Z.pow_pos</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">IHx</span> ((<span class="id" title="var">a</span> * <span class="id" title="var">a</span>) <span class="id" title="var">mod</span> <span class="id" title="var">p</span>) ((<span class="id" title="var">r</span> * <span class="id" title="var">a</span>) <span class="id" title="var">mod</span> <span class="id" title="var">p</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">IHx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">Z.mul_mod_idemp_r</span> <span class="id" title="tactic">by</span> <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z_pow_pos_mod_idemp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">Z.mul_mod</span> <span class="id" title="tactic">by</span> <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">replace</span> (<span class="id" title="var">x</span>~1)%<span class="id" title="var">positive</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">x</span>*2+1)%<span class="id" title="var">positive</span> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Zpower_pos_is_exp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> 2!<span class="id" title="var">Z.pow_pos_fold</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z.pow_mul_l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">Z.pow_add_r</span> <span class="id" title="tactic">by</span> (<span class="id" title="tactic">auto</span> <span class="id" title="keyword">with</span> <span class="id" title="var">zarith</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Zred_factor1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">f_equal</span>; <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">cbn</span> -[<span class="id" title="var">Z.pow_pos</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">IHx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">Zmult_mod_idemp_r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z_pow_pos_mod_idemp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Zmult_mod_idemp_r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">replace</span> (<span class="id" title="var">x</span>~0)%<span class="id" title="var">positive</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">x</span>*2)%<span class="id" title="var">positive</span> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> 2!<span class="id" title="var">Z.pow_pos_fold</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z.pow_mul_l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">Z.pow_add_r</span> <span class="id" title="tactic">by</span> (<span class="id" title="tactic">auto</span> <span class="id" title="keyword">with</span> <span class="id" title="var">zarith</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Zred_factor1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">f_equal</span>; <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">mod_pow_pos_spec</span> <span class="id" title="var">a</span> <span class="id" title="var">x</span> <span class="id" title="var">p</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mod_pow_pos</span> <span class="id" title="var">a</span> <span class="id" title="var">x</span> <span class="id" title="var">p</span> = <span class="id" title="var">Z.pow_pos</span> <span class="id" title="var">a</span> <span class="id" title="var">x</span> <span class="id" title="var">mod</span> <span class="id" title="var">p</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">pose</span> <span class="id" title="var">proof</span> (<span class="id" title="var">mod_pow_pos_aux_spec</span> <span class="id" title="var">a</span> <span class="id" title="var">x</span> <span class="id" title="var">p</span> 1).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z.mul_1_l</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">Z_pow_mod_idemp</span> <span class="id" title="var">a</span> <span class="id" title="var">x</span> <span class="id" title="var">p</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">a</span> <span class="id" title="var">mod</span> <span class="id" title="var">p</span>)^<span class="id" title="var">x</span> <span class="id" title="var">mod</span> <span class="id" title="var">p</span> = <span class="id" title="var">a</span>^<span class="id" title="var">x</span> <span class="id" title="var">mod</span> <span class="id" title="var">p</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">x</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Z_pow_pos_mod_idemp</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">mod_pow_pos_aux_mod_idemp</span> <span class="id" title="var">a</span> <span class="id" title="var">x</span> <span class="id" title="var">p</span> <span class="id" title="var">r</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mod_pow_pos_aux</span> (<span class="id" title="var">a</span> <span class="id" title="var">mod</span> <span class="id" title="var">p</span>) <span class="id" title="var">x</span> <span class="id" title="var">p</span> <span class="id" title="var">r</span> = <span class="id" title="var">mod_pow_pos_aux</span> <span class="id" title="var">a</span> <span class="id" title="var">x</span> <span class="id" title="var">p</span> <span class="id" title="var">r</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">Z.eq_dec</span> <span class="id" title="var">p</span> 0) <span class="id" title="keyword">as</span> [-&gt;|?].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> !<span class="id" title="var">mod_pow_pos_aux_0_r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">revert</span> <span class="id" title="var">a</span> <span class="id" title="var">r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">x</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">a</span> <span class="id" title="var">r</span>; <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">Z.mul_mod</span> <span class="id" title="tactic">by</span> <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z.mul_mod_idemp_r</span> <span class="id" title="tactic">by</span> <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">Z.mul_mod</span> <span class="id" title="tactic">by</span> <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z.mul_mod_idemp_r</span> <span class="id" title="tactic">by</span> <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">mod_pow_pos_mod_idemp</span> <span class="id" title="var">a</span> <span class="id" title="var">x</span> <span class="id" title="var">p</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mod_pow_pos</span> (<span class="id" title="var">a</span> <span class="id" title="var">mod</span> <span class="id" title="var">p</span>) <span class="id" title="var">x</span> <span class="id" title="var">p</span> = <span class="id" title="var">mod_pow_pos</span> <span class="id" title="var">a</span> <span class="id" title="var">x</span> <span class="id" title="var">p</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">mod_pow_pos_aux_mod_idemp</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">mod_pow_mod_idemp</span> <span class="id" title="var">a</span> <span class="id" title="var">e</span> <span class="id" title="var">p</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mod_pow</span> (<span class="id" title="var">a</span> <span class="id" title="var">mod</span> <span class="id" title="var">p</span>) <span class="id" title="var">e</span> <span class="id" title="var">p</span> = <span class="id" title="var">mod_pow</span> <span class="id" title="var">a</span> <span class="id" title="var">e</span> <span class="id" title="var">p</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">mod_pow</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">e</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z_pow_mod_idemp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">mod_pow_pos_mod_idemp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">mod_pow_pos_mod_idemp</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">mod_pow_pos_aux_mod</span> <span class="id" title="var">a</span> <span class="id" title="var">x</span> <span class="id" title="var">p</span> <span class="id" title="var">r</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mod_pow_pos_aux</span> <span class="id" title="var">a</span> <span class="id" title="var">x</span> <span class="id" title="var">p</span> <span class="id" title="var">r</span> <span class="id" title="var">mod</span> <span class="id" title="var">p</span> = <span class="id" title="var">mod_pow_pos_aux</span> <span class="id" title="var">a</span> <span class="id" title="var">x</span> <span class="id" title="var">p</span> <span class="id" title="var">r</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">Z.eq_dec</span> <span class="id" title="var">p</span> 0) <span class="id" title="keyword">as</span> [-&gt;|?].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">mod_pow_pos_aux_0_r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> <span class="id" title="var">mod_pow_pos_aux_spec</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z.mod_mod</span> <span class="id" title="tactic">by</span> <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">mod_pow_pos_mod</span> <span class="id" title="var">a</span> <span class="id" title="var">x</span> <span class="id" title="var">p</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mod_pow_pos</span> <span class="id" title="var">a</span> <span class="id" title="var">x</span> <span class="id" title="var">p</span> <span class="id" title="var">mod</span> <span class="id" title="var">p</span> = <span class="id" title="var">mod_pow_pos</span> <span class="id" title="var">a</span> <span class="id" title="var">x</span> <span class="id" title="var">p</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">mod_pow_pos_aux_mod</span>. <span class="id" title="keyword">Qed</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">mod_inv_mod</span> <span class="id" title="var">a</span> <span class="id" title="var">p</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mod_inv</span> <span class="id" title="var">a</span> <span class="id" title="var">p</span> <span class="id" title="var">mod</span> <span class="id" title="var">p</span> = <span class="id" title="var">mod_inv</span> <span class="id" title="var">a</span> <span class="id" title="var">p</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">mod_inv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Zmod_mod</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">mod_pow_mod</span> <span class="id" title="var">a</span> <span class="id" title="var">x</span> <span class="id" title="var">p</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mod_pow</span> <span class="id" title="var">a</span> <span class="id" title="var">x</span> <span class="id" title="var">p</span> <span class="id" title="var">mod</span> <span class="id" title="var">p</span> = <span class="id" title="var">mod_pow</span> <span class="id" title="var">a</span> <span class="id" title="var">x</span> <span class="id" title="var">p</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">Z.eq_dec</span> <span class="id" title="var">p</span> 0) <span class="id" title="keyword">as</span> [-&gt;|?].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">mod_pow_0_r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">destruct</span> <span class="id" title="var">x</span>; <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z.mod_mod</span> <span class="id" title="tactic">by</span> <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">mod_pow_pos_mod</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">mod_inv_mod</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">mul_mod_inv</span> <span class="id" title="var">a</span> <span class="id" title="var">p</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">prime</span> <span class="id" title="var">p</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">a</span> <span class="id" title="var">mod</span> <span class="id" title="var">p</span> &lt;&gt; 0 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">a</span> * <span class="id" title="var">mod_inv</span> <span class="id" title="var">a</span> <span class="id" title="var">p</span> <span class="id" title="var">mod</span> <span class="id" title="var">p</span> = 1.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">isprime</span> <span class="id" title="var">ap0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">pose</span> <span class="id" title="var">proof</span> (<span class="id" title="var">prime_ge_2</span> <span class="id" title="var">_</span> <span class="id" title="var">isprime</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">mod_inv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z.mul_mod_idemp_r</span> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- (<span class="id" title="var">Z.mod_1_l</span> <span class="id" title="var">p</span>) <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">mul_fst_egcd</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">rel_prime_sym</span>, <span class="id" title="var">prime_rel_prime</span>; [<span class="id" title="var">easy</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">eq</span>; <span class="id" title="var">contradiction</span> <span class="id" title="var">ap0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Z.mod_divide</span>; [<span class="id" title="var">lia</span>|<span class="id" title="var">easy</span>].<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">mod_mul_both_l</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span> <span class="id" title="var">c</span> <span class="id" title="var">p</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">prime</span> <span class="id" title="var">p</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">c</span> <span class="id" title="var">mod</span> <span class="id" title="var">p</span> &lt;&gt; 0 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">c</span> * <span class="id" title="var">a</span> <span class="id" title="var">mod</span> <span class="id" title="var">p</span> = <span class="id" title="var">c</span> * <span class="id" title="var">b</span> <span class="id" title="var">mod</span> <span class="id" title="var">p</span> &lt;-&gt; <span class="id" title="var">a</span> <span class="id" title="var">mod</span> <span class="id" title="var">p</span> = <span class="id" title="var">b</span> <span class="id" title="var">mod</span> <span class="id" title="var">p</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">isprime</span> <span class="id" title="var">cp0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">pose</span> <span class="id" title="var">proof</span> (<span class="id" title="var">prime_ge_2</span> <span class="id" title="var">_</span> <span class="id" title="var">isprime</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">eq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- (<span class="id" title="var">Z.mul_1_l</span> <span class="id" title="var">a</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- (<span class="id" title="var">Z.mul_1_l</span> <span class="id" title="var">b</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- (<span class="id" title="var">mul_mod_inv</span> <span class="id" title="var">c</span> <span class="id" title="var">_</span> <span class="id" title="var">isprime</span> <span class="id" title="var">cp0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> !<span class="id" title="var">Z.mul_mod_idemp_l</span> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> (<span class="id" title="var">Z.mul_comm</span> <span class="id" title="var">c</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- 2!<span class="id" title="var">Z.mul_assoc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- (<span class="id" title="var">Z.mul_mod_idemp_r</span> <span class="id" title="var">_</span> (<span class="id" title="var">c</span> * <span class="id" title="var">a</span>)) <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- (<span class="id" title="var">Z.mul_mod_idemp_r</span> <span class="id" title="var">_</span> (<span class="id" title="var">c</span> * <span class="id" title="var">b</span>)) <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">eq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">eq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">Z.mul_mod_idemp_r</span>, <span class="id" title="var">eq</span>, <span class="id" title="var">Z.mul_mod_idemp_r</span> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">mul_mod_nonzero</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span> <span class="id" title="var">p</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">prime</span> <span class="id" title="var">p</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">a</span> <span class="id" title="var">mod</span> <span class="id" title="var">p</span> &lt;&gt; 0 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">b</span> <span class="id" title="var">mod</span> <span class="id" title="var">p</span> &lt;&gt; 0 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">a</span> * <span class="id" title="var">b</span> <span class="id" title="var">mod</span> <span class="id" title="var">p</span> &lt;&gt; 0.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">isprime</span> <span class="id" title="var">ap0</span> <span class="id" title="var">bp0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">abp0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">pose</span> <span class="id" title="var">proof</span> (<span class="id" title="var">prime_ge_2</span> <span class="id" title="var">_</span> <span class="id" title="var">isprime</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">pose</span> <span class="id" title="var">proof</span> (<span class="id" title="var">proj1</span> (<span class="id" title="var">Z.mod_divide</span> <span class="id" title="var">_</span> <span class="id" title="var">p</span> <span class="id" title="keyword">ltac</span>:(<span class="id" title="var">lia</span>)) <span class="id" title="var">abp0</span>) <span class="id" title="keyword">as</span> <span class="id" title="var">pdiv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">pose</span> <span class="id" title="var">proof</span> (<span class="id" title="var">prime_mult</span> <span class="id" title="var">_</span> <span class="id" title="var">isprime</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">pdiv</span>) <span class="id" title="keyword">as</span> <span class="id" title="var">onediv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">onediv</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">div</span>|<span class="id" title="var">div</span>]; <span class="id" title="tactic">apply</span> <span class="id" title="var">Z.mod_divide</span> <span class="id" title="tactic">in</span> <span class="id" title="var">div</span>; <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Hint Resolve</span> <span class="id" title="var">mul_mod_nonzero</span> : <span class="id" title="var">core</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">mod_mod_nonzero</span> <span class="id" title="var">a</span> <span class="id" title="var">p</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">a</span> <span class="id" title="var">mod</span> <span class="id" title="var">p</span> &lt;&gt; 0 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">a</span> <span class="id" title="var">mod</span> <span class="id" title="var">p</span>) <span class="id" title="var">mod</span> <span class="id" title="var">p</span> &lt;&gt; 0.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">ap0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">Z.eq_dec</span> <span class="id" title="var">p</span> 0) <span class="id" title="keyword">as</span> [-&gt;|?].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> <span class="id" title="var">ap0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Zmod_0_r</span> <span class="id" title="tactic">in</span> <span class="id" title="var">ap0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z.mod_mod</span> <span class="id" title="tactic">by</span> <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Hint Resolve</span> <span class="id" title="var">mod_mod_nonzero</span> : <span class="id" title="var">core</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">mod_pow_pos_aux_nonzero</span> <span class="id" title="var">a</span> <span class="id" title="var">x</span> <span class="id" title="var">p</span> <span class="id" title="var">r</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">prime</span> <span class="id" title="var">p</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">a</span> <span class="id" title="var">mod</span> <span class="id" title="var">p</span> &lt;&gt; 0 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">r</span> <span class="id" title="var">mod</span> <span class="id" title="var">p</span> &lt;&gt; 0 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mod_pow_pos_aux</span> <span class="id" title="var">a</span> <span class="id" title="var">x</span> <span class="id" title="var">p</span> <span class="id" title="var">r</span> &lt;&gt; 0.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">prime</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">pose</span> <span class="id" title="var">proof</span> (<span class="id" title="var">prime_ge_2</span> <span class="id" title="var">_</span> <span class="id" title="var">prime</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">revert</span> <span class="id" title="var">a</span> <span class="id" title="var">r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">x</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">a</span> <span class="id" title="var">r</span> <span class="id" title="var">ap0</span> <span class="id" title="var">rp0</span>; <span class="id" title="var">cbn</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Hint Resolve</span> <span class="id" title="var">mod_pow_pos_aux_nonzero</span> : <span class="id" title="var">core</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">mod_pow_pos_nonzero</span> <span class="id" title="var">a</span> <span class="id" title="var">x</span> <span class="id" title="var">p</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">prime</span> <span class="id" title="var">p</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">a</span> <span class="id" title="var">mod</span> <span class="id" title="var">p</span> &lt;&gt; 0 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mod_pow_pos</span> <span class="id" title="var">a</span> <span class="id" title="var">x</span> <span class="id" title="var">p</span> &lt;&gt; 0.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">isprime</span> <span class="id" title="var">ap0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">mod_pow_pos_aux_nonzero</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">pose</span> <span class="id" title="var">proof</span> (<span class="id" title="var">prime_ge_2</span> <span class="id" title="var">_</span> <span class="id" title="var">isprime</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z.mod_1_l</span> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Hint Resolve</span> <span class="id" title="var">mod_pow_pos_nonzero</span> : <span class="id" title="var">core</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">mod_inv_nonzero</span> <span class="id" title="var">a</span> <span class="id" title="var">p</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">prime</span> <span class="id" title="var">p</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">a</span> <span class="id" title="var">mod</span> <span class="id" title="var">p</span> &lt;&gt; 0 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mod_inv</span> <span class="id" title="var">a</span> <span class="id" title="var">p</span> &lt;&gt; 0.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">isprime</span> <span class="id" title="var">ap0</span> <span class="id" title="var">iszero</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">pose</span> <span class="id" title="var">proof</span> (<span class="id" title="var">prime_ge_2</span> <span class="id" title="var">_</span> <span class="id" title="var">isprime</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- (<span class="id" title="var">Z.mod_0_l</span> <span class="id" title="var">p</span>) <span class="id" title="tactic">in</span> <span class="id" title="var">iszero</span> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">mod_inv_mod</span> <span class="id" title="tactic">in</span> <span class="id" title="var">iszero</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> (<span class="id" title="var">mod_mul_both_l</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">a</span> <span class="id" title="var">p</span> <span class="id" title="var">isprime</span> <span class="id" title="var">ap0</span>) <span class="id" title="tactic">in</span> <span class="id" title="var">iszero</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">mul_mod_inv</span> <span class="id" title="tactic">in</span> <span class="id" title="var">iszero</span> <span class="id" title="tactic">by</span> <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z.mul_0_r</span>, <span class="id" title="var">Z.mod_0_l</span> <span class="id" title="tactic">in</span> <span class="id" title="var">iszero</span>; <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Hint Resolve</span> <span class="id" title="var">mod_inv_nonzero</span> : <span class="id" title="var">core</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">mod_pow_nonzero</span> <span class="id" title="var">a</span> <span class="id" title="var">x</span> <span class="id" title="var">p</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">prime</span> <span class="id" title="var">p</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">a</span> <span class="id" title="var">mod</span> <span class="id" title="var">p</span> &lt;&gt; 0 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mod_pow</span> <span class="id" title="var">a</span> <span class="id" title="var">x</span> <span class="id" title="var">p</span> &lt;&gt; 0.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">isprime</span> <span class="id" title="var">ap0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">pose</span> <span class="id" title="var">proof</span> (<span class="id" title="var">prime_ge_2</span> <span class="id" title="var">_</span> <span class="id" title="var">isprime</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">x</span>; <span class="id" title="var">cbn</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z.mod_1_l</span> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>; <span class="id" title="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">mod_inv_nonzero</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">mod_pow_pos_mod</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Hint Resolve</span> <span class="id" title="var">mod_pow_nonzero</span> : <span class="id" title="var">core</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">mod_pow_pos_mod_nonzero</span> <span class="id" title="var">a</span> <span class="id" title="var">x</span> <span class="id" title="var">p</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mod_pow_pos</span> <span class="id" title="var">a</span> <span class="id" title="var">x</span> <span class="id" title="var">p</span> &lt;&gt; 0 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mod_pow_pos</span> <span class="id" title="var">a</span> <span class="id" title="var">x</span> <span class="id" title="var">p</span> <span class="id" title="var">mod</span> <span class="id" title="var">p</span> &lt;&gt; 0.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">mod_pow_pos_mod</span>; <span class="id" title="tactic">auto</span>. <span class="id" title="keyword">Qed</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">mod_inv_mod_nonzero</span> <span class="id" title="var">a</span> <span class="id" title="var">p</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mod_inv</span> <span class="id" title="var">a</span> <span class="id" title="var">p</span> &lt;&gt; 0 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mod_inv</span> <span class="id" title="var">a</span> <span class="id" title="var">p</span> <span class="id" title="var">mod</span> <span class="id" title="var">p</span> &lt;&gt; 0.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">mod_inv_mod</span>; <span class="id" title="tactic">auto</span>. <span class="id" title="keyword">Qed</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">mod_pow_mod_nonzero</span> <span class="id" title="var">a</span> <span class="id" title="var">x</span> <span class="id" title="var">p</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mod_pow</span> <span class="id" title="var">a</span> <span class="id" title="var">x</span> <span class="id" title="var">p</span> &lt;&gt; 0 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mod_pow</span> <span class="id" title="var">a</span> <span class="id" title="var">x</span> <span class="id" title="var">p</span> <span class="id" title="var">mod</span> <span class="id" title="var">p</span> &lt;&gt; 0.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">mod_pow_mod</span>; <span class="id" title="tactic">auto</span>. <span class="id" title="keyword">Qed</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">one_nonzero</span> <span class="id" title="var">p</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">prime</span> <span class="id" title="var">p</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;1 <span class="id" title="var">mod</span> <span class="id" title="var">p</span> &lt;&gt; 0.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">isprime</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">pose</span> <span class="id" title="var">proof</span> (<span class="id" title="var">prime_ge_2</span> <span class="id" title="var">_</span> <span class="id" title="var">isprime</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z.mod_1_l</span> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Hint Resolve</span> <span class="id" title="var">mod_pow_pos_mod_nonzero</span> <span class="id" title="var">mod_inv_mod_nonzero</span> <span class="id" title="var">mod_pow_mod_nonzero</span> <span class="id" title="var">one_nonzero</span> : <span class="id" title="var">core</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">mod_inv_mod_idemp</span> <span class="id" title="var">a</span> <span class="id" title="var">p</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">prime</span> <span class="id" title="var">p</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mod_inv</span> (<span class="id" title="var">a</span> <span class="id" title="var">mod</span> <span class="id" title="var">p</span>) <span class="id" title="var">p</span> = <span class="id" title="var">mod_inv</span> <span class="id" title="var">a</span> <span class="id" title="var">p</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">isprime</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">pose</span> <span class="id" title="var">proof</span> (<span class="id" title="var">prime_ge_2</span> <span class="id" title="var">_</span> <span class="id" title="var">isprime</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">Z.eqb_spec</span> (<span class="id" title="var">a</span> <span class="id" title="var">mod</span> <span class="id" title="var">p</span>) 0) <span class="id" title="keyword">as</span> [<span class="id" title="var">ap0</span>|<span class="id" title="var">ap0</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">ap0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Zmod_divide</span> <span class="id" title="tactic">in</span> <span class="id" title="var">ap0</span>; [|<span class="id" title="var">lia</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">mod_inv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> (<span class="id" title="var">egcd_divides</span> <span class="id" title="var">a</span> <span class="id" title="var">p</span>) <span class="id" title="tactic">by</span> (<span class="id" title="tactic">auto</span>; <span class="id" title="var">lia</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">mod_inv_mod</span>, &lt;- (<span class="id" title="var">mod_inv_mod</span> <span class="id" title="var">a</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">mod_mul_both_l</span> <span class="id" title="keyword">with</span> <span class="id" title="var">a</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">Z.mul_mod_idemp_l</span> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> !<span class="id" title="var">mul_mod_inv</span> <span class="id" title="tactic">by</span> <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">mod_pow_pos_fermat</span> <span class="id" title="var">a</span> <span class="id" title="var">p</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">prime</span> <span class="id" title="var">p</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">a</span> <span class="id" title="var">mod</span> <span class="id" title="var">p</span> &lt;&gt; 0 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mod_pow_pos</span> <span class="id" title="var">a</span> (<span class="id" title="var">Z.to_pos</span> (<span class="id" title="var">p</span> - 1)) <span class="id" title="var">p</span> = 1.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">isprime</span> <span class="id" title="var">ap</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">pose</span> <span class="id" title="var">proof</span> (<span class="id" title="var">prime_ge_2</span> <span class="id" title="var">_</span> <span class="id" title="var">isprime</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">mod_pow_pos_spec</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z.pow_pos_fold</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z2Pos.id</span> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <span class="id" title="var">fermat</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">mod_pow_fermat</span> <span class="id" title="var">a</span> <span class="id" title="var">p</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">prime</span> <span class="id" title="var">p</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">a</span> <span class="id" title="var">mod</span> <span class="id" title="var">p</span> &lt;&gt; 0 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mod_pow</span> <span class="id" title="var">a</span> (<span class="id" title="var">p</span> - 1) <span class="id" title="var">p</span> = 1.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">isprime</span> <span class="id" title="var">ap</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">pose</span> <span class="id" title="var">proof</span> (<span class="id" title="var">prime_ge_2</span> <span class="id" title="var">_</span> <span class="id" title="var">isprime</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">pose</span> <span class="id" title="var">proof</span> (<span class="id" title="var">mod_pow_pos_fermat</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">isprime</span> <span class="id" title="var">ap</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">p</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">Z.pos</span> <span class="id" title="var">p</span> - 1) <span class="id" title="var">eqn</span>:?; <span class="id" title="tactic">try</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">mod_pow_pos_exp_mul</span> <span class="id" title="var">a</span> <span class="id" title="var">x</span> <span class="id" title="var">x'</span> <span class="id" title="var">p</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mod_pow_pos</span> <span class="id" title="var">a</span> (<span class="id" title="var">x</span> * <span class="id" title="var">x'</span>) <span class="id" title="var">p</span> = <span class="id" title="var">mod_pow_pos</span> (<span class="id" title="var">mod_pow_pos</span> <span class="id" title="var">a</span> <span class="id" title="var">x</span> <span class="id" title="var">p</span>) <span class="id" title="var">x'</span> <span class="id" title="var">p</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">Z.eq_dec</span> <span class="id" title="var">p</span> 0) <span class="id" title="keyword">as</span> [-&gt;|?].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> !<span class="id" title="var">mod_pow_pos_0_r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> !<span class="id" title="var">mod_pow_pos_spec</span> <span class="id" title="tactic">by</span> <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> !<span class="id" title="var">Z.pow_pos_fold</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Pos2Z.inj_mul</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z_pow_mod_idemp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">Z.pow_mul_r</span> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">mod_pow_pos_aux_1_l</span> <span class="id" title="var">x</span> <span class="id" title="var">p</span> <span class="id" title="var">r</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mod_pow_pos_aux</span> 1 <span class="id" title="var">x</span> <span class="id" title="var">p</span> <span class="id" title="var">r</span> = <span class="id" title="var">r</span> <span class="id" title="var">mod</span> <span class="id" title="var">p</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">Z.eq_dec</span> <span class="id" title="var">p</span> 0) <span class="id" title="keyword">as</span> [-&gt;|?].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">mod_pow_pos_aux_0_r</span>, <span class="id" title="var">Zmod_0_r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">revert</span> <span class="id" title="var">r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">x</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">r</span>; <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">rewrite</span> <span class="id" title="var">mod_pow_pos_aux_mod_idemp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z.mul_1_r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">IHx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Z.mod_mod</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">rewrite</span> <span class="id" title="var">mod_pow_pos_aux_mod_idemp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IHx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z.mul_1_r</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">mod_pow_pos_1_l</span> <span class="id" title="var">x</span> <span class="id" title="var">p</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mod_pow_pos</span> 1 <span class="id" title="var">x</span> <span class="id" title="var">p</span> = 1 <span class="id" title="var">mod</span> <span class="id" title="var">p</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">mod_pow_pos_aux_1_l</span>. <span class="id" title="keyword">Qed</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">mod_inv_1_l</span> <span class="id" title="var">p</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">prime</span> <span class="id" title="var">p</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mod_inv</span> 1 <span class="id" title="var">p</span> = 1 <span class="id" title="var">mod</span> <span class="id" title="var">p</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">isprime</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">pose</span> <span class="id" title="var">proof</span> (<span class="id" title="var">prime_ge_2</span> <span class="id" title="var">_</span> <span class="id" title="var">isprime</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">mod_inv_mod</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">mod_mul_both_l</span> <span class="id" title="keyword">with</span> 1; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">mul_mod_inv</span> <span class="id" title="tactic">by</span> <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z.mod_1_l</span> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">mod_pow_1_l</span> <span class="id" title="var">x</span> <span class="id" title="var">p</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">prime</span> <span class="id" title="var">p</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mod_pow</span> 1 <span class="id" title="var">x</span> <span class="id" title="var">p</span> = 1 <span class="id" title="var">mod</span> <span class="id" title="var">p</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">isprime</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">x</span>; <span class="id" title="tactic">auto</span>; <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">mod_pow_pos_1_l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> <span class="id" title="var">mod_pow_pos_1_l</span>, <span class="id" title="var">mod_inv_mod_idemp</span> <span class="id" title="tactic">by</span> <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <span class="id" title="var">mod_inv_1_l</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">mod_pow_1_r</span> <span class="id" title="var">a</span> <span class="id" title="var">p</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mod_pow</span> <span class="id" title="var">a</span> 1 <span class="id" title="var">p</span> = <span class="id" title="var">a</span> <span class="id" title="var">mod</span> <span class="id" title="var">p</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span> -[<span class="id" title="var">Z.mul</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z.mul_1_l</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">mod_inv_mul</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span> <span class="id" title="var">p</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">prime</span> <span class="id" title="var">p</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">a</span> <span class="id" title="var">mod</span> <span class="id" title="var">p</span> &lt;&gt; 0 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">b</span> <span class="id" title="var">mod</span> <span class="id" title="var">p</span> &lt;&gt; 0 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mod_inv</span> (<span class="id" title="var">a</span> * <span class="id" title="var">b</span>) <span class="id" title="var">p</span> = <span class="id" title="var">mod_inv</span> <span class="id" title="var">b</span> <span class="id" title="var">p</span> * <span class="id" title="var">mod_inv</span> <span class="id" title="var">a</span> <span class="id" title="var">p</span> <span class="id" title="var">mod</span> <span class="id" title="var">p</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">isprime</span> <span class="id" title="var">ap0</span> <span class="id" title="var">bp0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">pose</span> <span class="id" title="var">proof</span> (<span class="id" title="var">prime_ge_2</span> <span class="id" title="var">_</span> <span class="id" title="var">isprime</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">mod_inv_mod</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">mod_mul_both_l</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">a</span> * <span class="id" title="var">b</span>); <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">mul_mod_inv</span> <span class="id" title="tactic">by</span> <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">Z.mul_assoc</span>, (<span class="id" title="var">Z.mul_assoc</span> <span class="id" title="var">b</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">Z.mul_mod_idemp_r</span> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- (<span class="id" title="var">Z.mul_mod_idemp_l</span> (<span class="id" title="var">b</span> * <span class="id" title="var">_</span>)) <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z.mul_mod_idemp_r</span> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">mul_mod_inv</span> <span class="id" title="tactic">by</span> <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z.mul_1_l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">mul_mod_inv</span> <span class="id" title="tactic">by</span> <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">mod_pow_pos_succ_r</span> <span class="id" title="var">a</span> <span class="id" title="var">x</span> <span class="id" title="var">p</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">a</span> * <span class="id" title="var">mod_pow_pos</span> <span class="id" title="var">a</span> <span class="id" title="var">x</span> <span class="id" title="var">p</span> <span class="id" title="var">mod</span> <span class="id" title="var">p</span> = <span class="id" title="var">mod_pow_pos</span> <span class="id" title="var">a</span> (<span class="id" title="var">Pos.succ</span> <span class="id" title="var">x</span>) <span class="id" title="var">p</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">Z.eq_dec</span> <span class="id" title="var">p</span> 0) <span class="id" title="keyword">as</span> [-&gt;|?].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> !<span class="id" title="var">mod_pow_pos_0_r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Zmod_0_r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> !<span class="id" title="var">mod_pow_pos_spec</span>, !<span class="id" title="var">Z.pow_pos_fold</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z.mul_mod_idemp_r</span> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z.pow_pos_fold</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">Z.pow_succ_r</span> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">Pos.add_1_r</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">mod_pow_succ</span> <span class="id" title="var">a</span> <span class="id" title="var">x</span> <span class="id" title="var">p</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">prime</span> <span class="id" title="var">p</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">a</span> <span class="id" title="var">mod</span> <span class="id" title="var">p</span> &lt;&gt; 0 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mod_pow</span> <span class="id" title="var">a</span> (<span class="id" title="var">Z.succ</span> <span class="id" title="var">x</span>) <span class="id" title="var">p</span> = <span class="id" title="var">a</span> * <span class="id" title="var">mod_pow</span> <span class="id" title="var">a</span> <span class="id" title="var">x</span> <span class="id" title="var">p</span> <span class="id" title="var">mod</span> <span class="id" title="var">p</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">isprime</span> <span class="id" title="var">ap0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">pose</span> <span class="id" title="var">proof</span> (<span class="id" title="var">prime_ge_2</span> <span class="id" title="var">_</span> <span class="id" title="var">isprime</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">x</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z.mod_1_l</span> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z.mul_1_r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">a</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">cbn</span> -[<span class="id" title="var">Pos.add</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">mod_pow_pos_succ_r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">replace</span> (<span class="id" title="var">p0</span> + 1)%<span class="id" title="var">positive</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">Pos.succ</span> <span class="id" title="var">p0</span>) <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">Pos.eq_dec</span> <span class="id" title="var">p0</span> 1) <span class="id" title="keyword">as</span> [-&gt;|?].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">cbn</span> -[<span class="id" title="var">Z.mul</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z.mul_1_l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">mod_inv_mod_idemp</span> <span class="id" title="tactic">by</span> <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">mul_mod_inv</span> <span class="id" title="tactic">by</span> <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z.mod_1_l</span> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z.pos_sub_lt</span> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">mod_inv_mod</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">mod_mul_both_l</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">mod_inv</span> <span class="id" title="var">a</span> <span class="id" title="var">p</span>); <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z.mul_assoc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- (<span class="id" title="var">Z.mul_mod_idemp_l</span> (<span class="id" title="var">mod_inv</span> <span class="id" title="var">a</span> <span class="id" title="var">p</span> * <span class="id" title="var">a</span>)) <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> (<span class="id" title="var">Z.mul_comm</span> <span class="id" title="var">_</span> <span class="id" title="var">a</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">mul_mod_inv</span> <span class="id" title="tactic">by</span> <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">mod_inv_mul</span> <span class="id" title="tactic">by</span> <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z.mul_comm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">mod_inv_mod_idemp</span> <span class="id" title="tactic">by</span> <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">mod_pow_pos_succ_r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">replace</span> (<span class="id" title="var">Pos.succ</span> (<span class="id" title="var">p0</span> - 1)) <span class="id" title="keyword">with</span> <span class="id" title="var">p0</span> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z.mul_1_l</span>, <span class="id" title="var">mod_inv_mod</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">mod_pow_pred</span> <span class="id" title="var">a</span> <span class="id" title="var">x</span> <span class="id" title="var">p</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">prime</span> <span class="id" title="var">p</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">a</span> <span class="id" title="var">mod</span> <span class="id" title="var">p</span> &lt;&gt; 0 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mod_pow</span> <span class="id" title="var">a</span> (<span class="id" title="var">Z.pred</span> <span class="id" title="var">x</span>) <span class="id" title="var">p</span> = <span class="id" title="var">mod_inv</span> <span class="id" title="var">a</span> <span class="id" title="var">p</span> * <span class="id" title="var">mod_pow</span> <span class="id" title="var">a</span> <span class="id" title="var">x</span> <span class="id" title="var">p</span> <span class="id" title="var">mod</span> <span class="id" title="var">p</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">isprime</span> <span class="id" title="var">ap0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">pose</span> <span class="id" title="var">proof</span> (<span class="id" title="var">prime_ge_2</span> <span class="id" title="var">_</span> <span class="id" title="var">isprime</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">mod_pow_mod</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">mod_mul_both_l</span> <span class="id" title="keyword">with</span> <span class="id" title="var">a</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">mod_pow_succ</span> <span class="id" title="tactic">by</span> <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">replace</span> (<span class="id" title="var">Z.succ</span> (<span class="id" title="var">Z.pred</span> <span class="id" title="var">x</span>)) <span class="id" title="keyword">with</span> <span class="id" title="var">x</span> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z.mul_assoc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">Z.mul_mod_idemp_l</span> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">mul_mod_inv</span> <span class="id" title="tactic">by</span> <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z.mul_1_l</span>, <span class="id" title="var">mod_pow_mod</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">mod_pow_exp_plus</span> <span class="id" title="var">a</span> <span class="id" title="var">x</span> <span class="id" title="var">x'</span> <span class="id" title="var">p</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">prime</span> <span class="id" title="var">p</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">a</span> <span class="id" title="var">mod</span> <span class="id" title="var">p</span> &lt;&gt; 0 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mod_pow</span> <span class="id" title="var">a</span> (<span class="id" title="var">x</span> + <span class="id" title="var">x'</span>) <span class="id" title="var">p</span> = <span class="id" title="var">mod_pow</span> <span class="id" title="var">a</span> <span class="id" title="var">x</span> <span class="id" title="var">p</span> * <span class="id" title="var">mod_pow</span> <span class="id" title="var">a</span> <span class="id" title="var">x'</span> <span class="id" title="var">p</span> <span class="id" title="var">mod</span> <span class="id" title="var">p</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">isprime</span> <span class="id" title="var">ap0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">pose</span> <span class="id" title="var">proof</span> (<span class="id" title="var">prime_ge_2</span> <span class="id" title="var">_</span> <span class="id" title="var">isprime</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">revert</span> <span class="id" title="var">x'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">x</span> <span class="id" title="keyword">using</span> <span class="id" title="var">Z.peano_ind</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">x'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z.mod_1_l</span> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z.mul_1_l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">mod_pow_mod</span> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">replace</span> (<span class="id" title="var">Z.succ</span> <span class="id" title="var">x</span> + <span class="id" title="var">x'</span>) <span class="id" title="keyword">with</span> (<span class="id" title="var">Z.succ</span> (<span class="id" title="var">x</span> + <span class="id" title="var">x'</span>)) <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">mod_pow_succ</span> <span class="id" title="tactic">by</span> <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">IHx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z.mul_mod_idemp_r</span> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z.mul_assoc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">Z.mul_mod_idemp_l</span> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">mod_pow_succ</span> <span class="id" title="tactic">by</span> <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">replace</span> (<span class="id" title="var">Z.pred</span> <span class="id" title="var">x</span> + <span class="id" title="var">x'</span>) <span class="id" title="keyword">with</span> (<span class="id" title="var">x</span> + <span class="id" title="var">Z.pred</span> <span class="id" title="var">x'</span>) <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">IHx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> !<span class="id" title="var">mod_pow_pred</span> <span class="id" title="tactic">by</span> <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z.mul_mod_idemp_l</span>, <span class="id" title="var">Z.mul_mod_idemp_r</span> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">f_equal2</span>; <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">mod_inv_involutive</span> <span class="id" title="var">a</span> <span class="id" title="var">p</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">prime</span> <span class="id" title="var">p</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">a</span> <span class="id" title="var">mod</span> <span class="id" title="var">p</span> &lt;&gt; 0 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mod_inv</span> (<span class="id" title="var">mod_inv</span> <span class="id" title="var">a</span> <span class="id" title="var">p</span>) <span class="id" title="var">p</span> = <span class="id" title="var">a</span> <span class="id" title="var">mod</span> <span class="id" title="var">p</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">isprime</span> <span class="id" title="var">ap0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">mod_inv_mod</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">mod_mul_both_l</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">mod_inv</span> <span class="id" title="var">a</span> <span class="id" title="var">p</span>); <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">mul_mod_inv</span> <span class="id" title="tactic">by</span> <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z.mul_comm</span>, <span class="id" title="var">mul_mod_inv</span> <span class="id" title="tactic">by</span> <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">mod_pow_pos_distr_exp</span> <span class="id" title="var">a</span> <span class="id" title="var">a'</span> <span class="id" title="var">x</span> <span class="id" title="var">p</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">p</span> &lt;&gt; 0 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mod_pow_pos</span> (<span class="id" title="var">a</span> * <span class="id" title="var">a'</span>) <span class="id" title="var">x</span> <span class="id" title="var">p</span> =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">mod_pow_pos</span> <span class="id" title="var">a</span> <span class="id" title="var">x</span> <span class="id" title="var">p</span> * <span class="id" title="var">mod_pow_pos</span> <span class="id" title="var">a'</span> <span class="id" title="var">x</span> <span class="id" title="var">p</span>) <span class="id" title="var">mod</span> <span class="id" title="var">p</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">p0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> !<span class="id" title="var">mod_pow_pos_spec</span>, !<span class="id" title="var">Z.pow_pos_fold</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z.pow_mul_l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z.mul_mod</span> <span class="id" title="tactic">by</span> <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">mod_inv_mod_pow_pos_comm</span> <span class="id" title="var">a</span> <span class="id" title="var">x</span> <span class="id" title="var">p</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">prime</span> <span class="id" title="var">p</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">a</span> <span class="id" title="var">mod</span> <span class="id" title="var">p</span> &lt;&gt; 0 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mod_inv</span> (<span class="id" title="var">mod_pow_pos</span> <span class="id" title="var">a</span> <span class="id" title="var">x</span> <span class="id" title="var">p</span>) <span class="id" title="var">p</span> = <span class="id" title="var">mod_pow_pos</span> (<span class="id" title="var">mod_inv</span> <span class="id" title="var">a</span> <span class="id" title="var">p</span>) <span class="id" title="var">x</span> <span class="id" title="var">p</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">isprime</span> <span class="id" title="var">ap0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">pose</span> <span class="id" title="var">proof</span> (<span class="id" title="var">prime_ge_2</span> <span class="id" title="var">_</span> <span class="id" title="var">isprime</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">Z.eqb_spec</span> <span class="id" title="var">p</span> 2) <span class="id" title="keyword">as</span> [-&gt;|?].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">mod_pow_pos_mod_idemp</span>, &lt;- (<span class="id" title="var">mod_inv_mod_idemp</span> <span class="id" title="var">a</span>) <span class="id" title="tactic">by</span> <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">pose</span> <span class="id" title="var">proof</span> (<span class="id" title="var">Z.mod_pos_bound</span> <span class="id" title="var">a</span> 2 <span class="id" title="keyword">ltac</span>:(<span class="id" title="var">lia</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">replace</span> (<span class="id" title="var">a</span> <span class="id" title="var">mod</span> 2) <span class="id" title="keyword">with</span> 1 <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> !<span class="id" title="var">mod_pow_pos_1_l</span>, <span class="id" title="var">mod_inv_1_l</span> <span class="id" title="tactic">by</span> <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">mod_inv_mod</span>, &lt;- (<span class="id" title="var">mod_pow_pos_mod</span> (<span class="id" title="var">mod_inv</span> <span class="id" title="var">a</span> <span class="id" title="var">p</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">mod_mul_both_l</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">mod_pow_pos</span> <span class="id" title="var">a</span> <span class="id" title="var">x</span> <span class="id" title="var">p</span>); <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">mul_mod_inv</span> <span class="id" title="tactic">by</span> <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">mod_pow_pos_distr_exp</span> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">mod_pow_pos_mod_idemp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">mul_mod_inv</span> <span class="id" title="tactic">by</span> <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">mod_pow_pos_1_l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z.mod_1_l</span> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">mod_pow_exp_mul</span> <span class="id" title="var">a</span> <span class="id" title="var">x</span> <span class="id" title="var">x'</span> <span class="id" title="var">p</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">prime</span> <span class="id" title="var">p</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">a</span> <span class="id" title="var">mod</span> <span class="id" title="var">p</span> &lt;&gt; 0 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mod_pow</span> <span class="id" title="var">a</span> (<span class="id" title="var">x</span> * <span class="id" title="var">x'</span>) <span class="id" title="var">p</span> = <span class="id" title="var">mod_pow</span> (<span class="id" title="var">mod_pow</span> <span class="id" title="var">a</span> <span class="id" title="var">x</span> <span class="id" title="var">p</span>) <span class="id" title="var">x'</span> <span class="id" title="var">p</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">isprime</span> <span class="id" title="var">ap0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">pose</span> <span class="id" title="var">proof</span> (<span class="id" title="var">prime_ge_2</span> <span class="id" title="var">_</span> <span class="id" title="var">isprime</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">x</span>, <span class="id" title="var">x'</span>; <span class="id" title="var">cbn</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> (<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z.mod_1_l</span> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">mod_pow_pos_1_l</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">mod_inv_1_l</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">mod_pow_pos_exp_mul</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">mod_pow_pos_exp_mul</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> !<span class="id" title="var">mod_inv_mod_pow_pos_comm</span> <span class="id" title="tactic">by</span> <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">mod_pow_pos_exp_mul</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> <span class="id" title="var">mod_inv_mod_pow_pos_comm</span> <span class="id" title="tactic">by</span> <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">mod_inv_involutive</span> <span class="id" title="tactic">by</span> <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">mod_pow_pos_mod_idemp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">mod_pow_pos_exp_mul</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">mod_pow_exp_opp</span> <span class="id" title="var">a</span> <span class="id" title="var">x</span> <span class="id" title="var">p</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">prime</span> <span class="id" title="var">p</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">a</span> <span class="id" title="var">mod</span> <span class="id" title="var">p</span> &lt;&gt; 0 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mod_pow</span> <span class="id" title="var">a</span> (-<span class="id" title="var">x</span>) <span class="id" title="var">p</span> = <span class="id" title="var">mod_inv</span> (<span class="id" title="var">mod_pow</span> <span class="id" title="var">a</span> <span class="id" title="var">x</span> <span class="id" title="var">p</span>) <span class="id" title="var">p</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">isprime</span> <span class="id" title="var">ap0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">pose</span> <span class="id" title="var">proof</span> (<span class="id" title="var">prime_ge_2</span> <span class="id" title="var">_</span> <span class="id" title="var">isprime</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">x</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">mod_inv_mod_idemp</span> <span class="id" title="tactic">by</span> <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">mod_inv_1_l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">mod_inv_involutive</span> <span class="id" title="tactic">by</span> <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">mod_pow_pos_mod</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">mod_pow_exp_mod</span> <span class="id" title="var">a</span> <span class="id" title="var">x</span> <span class="id" title="var">p</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">prime</span> <span class="id" title="var">p</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">a</span> <span class="id" title="var">mod</span> <span class="id" title="var">p</span> &lt;&gt; 0 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mod_pow</span> <span class="id" title="var">a</span> (<span class="id" title="var">x</span> <span class="id" title="var">mod</span> (<span class="id" title="var">p</span> - 1)) <span class="id" title="var">p</span> = <span class="id" title="var">mod_pow</span> <span class="id" title="var">a</span> <span class="id" title="var">x</span> <span class="id" title="var">p</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">isprime</span> <span class="id" title="var">ap</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">pose</span> <span class="id" title="var">proof</span> (<span class="id" title="var">prime_ge_2</span> <span class="id" title="var">_</span> <span class="id" title="var">isprime</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> (<span class="id" title="var">Z.div_mod</span> <span class="id" title="var">x</span> (<span class="id" title="var">p</span> - 1)) <span class="id" title="tactic">at</span> 2 <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">mod_pow_exp_plus</span> <span class="id" title="tactic">by</span> <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">mod_pow_exp_mul</span> <span class="id" title="tactic">by</span> <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">mod_pow_fermat</span> <span class="id" title="tactic">by</span> <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">mod_pow_1_l</span> <span class="id" title="tactic">by</span> <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> !<span class="id" title="var">Z.mod_1_l</span> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z.mul_1_l</span>, <span class="id" title="var">mod_pow_mod</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">boardroom_axioms</span> (<span class="id" title="var">p</span> : <span class="id" title="var">Z</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">prime</span> <span class="id" title="var">p</span> -&gt; <span class="id" title="var">BoardroomAxioms</span> <span class="id" title="var">Z</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">isprime</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">pose</span> <span class="id" title="var">proof</span> (<span class="id" title="var">prime_ge_2</span> <span class="id" title="var">_</span> <span class="id" title="var">isprime</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">refine</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">elmeq</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span> := <span class="id" title="var">a</span> <span class="id" title="var">mod</span> <span class="id" title="var">p</span> = <span class="id" title="var">b</span> <span class="id" title="var">mod</span> <span class="id" title="var">p</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">elmeqb</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span> := <span class="id" title="var">a</span> <span class="id" title="var">mod</span> <span class="id" title="var">p</span> =? <span class="id" title="var">b</span> <span class="id" title="var">mod</span> <span class="id" title="var">p</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">zero</span> := 0;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">one</span> := 1;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">add</span> <span class="id" title="var">a</span> <span class="id" title="var">a'</span> := (<span class="id" title="var">a</span> + <span class="id" title="var">a'</span>) <span class="id" title="var">mod</span> <span class="id" title="var">p</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mul</span> <span class="id" title="var">a</span> <span class="id" title="var">a'</span> := (<span class="id" title="var">a</span> * <span class="id" title="var">a'</span>) <span class="id" title="var">mod</span> <span class="id" title="var">p</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">opp</span> <span class="id" title="var">a</span> := <span class="id" title="var">p</span> - <span class="id" title="var">a</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">inv</span> <span class="id" title="var">a</span> := <span class="id" title="var">mod_inv</span> <span class="id" title="var">a</span> <span class="id" title="var">p</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">pow</span> <span class="id" title="var">a</span> <span class="id" title="var">e</span> := <span class="id" title="var">mod_pow</span> <span class="id" title="var">a</span> <span class="id" title="var">e</span> <span class="id" title="var">p</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">order</span> := <span class="id" title="var">p</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|}.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>; <span class="id" title="tactic">apply</span> <span class="id" title="var">Z.eqb_spec</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">constructor</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">intros</span> <span class="id" title="var">a</span> <span class="id" title="var">a'</span> <span class="id" title="var">a''</span> -&gt; -&gt;.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">a</span> <span class="id" title="var">a'</span> <span class="id" title="var">aeq</span> <span class="id" title="var">b</span> <span class="id" title="var">b'</span> <span class="id" title="var">beq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z.add_mod</span>, <span class="id" title="var">aeq</span>, <span class="id" title="var">beq</span>, &lt;- <span class="id" title="var">Z.add_mod</span> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">a</span> <span class="id" title="var">a'</span> <span class="id" title="var">aeq</span> <span class="id" title="var">b</span> <span class="id" title="var">b'</span> <span class="id" title="var">beq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z.mul_mod</span>, <span class="id" title="var">aeq</span>, <span class="id" title="var">beq</span>, &lt;- <span class="id" title="var">Z.mul_mod</span> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">a</span> <span class="id" title="var">a'</span> <span class="id" title="var">aeq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Zminus_mod</span>, <span class="id" title="var">aeq</span>, &lt;- <span class="id" title="var">Zminus_mod</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">a</span> <span class="id" title="var">a'</span> <span class="id" title="var">aeq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">mod_inv_mod_idemp</span>, <span class="id" title="var">aeq</span>, <span class="id" title="var">mod_inv_mod_idemp</span> <span class="id" title="tactic">by</span> <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">a</span> <span class="id" title="var">a'</span> <span class="id" title="var">aeq</span> <span class="id" title="var">e</span> ? &lt;-.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">mod_pow_mod_idemp</span>, <span class="id" title="var">aeq</span>, <span class="id" title="var">mod_pow_mod_idemp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">a</span> <span class="id" title="var">anp</span> <span class="id" title="var">e</span> <span class="id" title="var">e'</span> <span class="id" title="var">eeq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- (<span class="id" title="var">mod_pow_exp_mod</span> <span class="id" title="var">_</span> <span class="id" title="var">e</span>), &lt;- (<span class="id" title="var">mod_pow_exp_mod</span> <span class="id" title="var">_</span> <span class="id" title="var">e'</span>) <span class="id" title="tactic">by</span> <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">eeq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z.mod_1_l</span>, <span class="id" title="var">Z.mod_0_l</span> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z.add_comm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span> <span class="id" title="var">c</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> !<span class="id" title="var">Z.mod_mod</span> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z.add_mod_idemp_l</span>, <span class="id" title="var">Z.add_mod_idemp_r</span> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">f_equal2</span>; <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z.mul_comm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span> <span class="id" title="var">c</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> (<span class="id" title="tactic">try</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z.mul_mod_idemp_l</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z.mul_mod_idemp_r</span>); <span class="id" title="tactic">try</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z.mul_assoc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">a</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z.mod_mod</span> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">a</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z.mod_mod</span> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">a</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z.mod_mod</span> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z.mul_1_l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">a</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z.mod_mod</span> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">replace</span> (<span class="id" title="var">p</span> - <span class="id" title="var">a</span> + <span class="id" title="var">a</span>) <span class="id" title="keyword">with</span> <span class="id" title="var">p</span> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z.mod_same</span>, <span class="id" title="var">Z.mod_0_l</span>; <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">a</span> <span class="id" title="var">anp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z.mul_comm</span>, <span class="id" title="var">mul_mod_inv</span> <span class="id" title="tactic">by</span> <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span> <span class="id" title="var">c</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> (<span class="id" title="tactic">try</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z.mul_mod_idemp_l</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z.mul_mod_idemp_r</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z.add_mod_idemp_l</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z.add_mod_idemp_r</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z.mod_mod</span>); <span class="id" title="tactic">try</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">f_equal2</span>; <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">a</span> <span class="id" title="var">anp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z.mod_1_l</span> <span class="id" title="tactic">at</span> 1 <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">a</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">mod_pow_mod</span>, <span class="id" title="var">mod_pow_1_r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">a</span> <span class="id" title="var">ap0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> (<span class="id" title="var">mod_pow_exp_opp</span> <span class="id" title="var">_</span> 1) <span class="id" title="tactic">by</span> <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">mod_pow_1_r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">mod_inv_mod_idemp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">a</span> <span class="id" title="var">e</span> <span class="id" title="var">e'</span> <span class="id" title="var">ap0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">mod_pow_exp_plus</span> <span class="id" title="tactic">by</span> <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span> <span class="id" title="var">e</span> <span class="id" title="var">anz</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">mod_pow_exp_mul</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>
<span class="id" title="keyword">End</span> <span class="id" title="var">Zp</span>.<br/>

<br/>
<span class="id" title="keyword">Module</span> <span class="id" title="var">BigZp</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Local Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">bigZ</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">mod_pow_pos_aux</span> (<span class="id" title="var">a</span> : <span class="id" title="var">bigZ</span>) (<span class="id" title="var">x</span> : <span class="id" title="var">positive</span>) (<span class="id" title="var">m</span> : <span class="id" title="var">bigZ</span>) (<span class="id" title="var">r</span> : <span class="id" title="var">bigZ</span>) : <span class="id" title="var">bigZ</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">x</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">x</span>~0%<span class="id" title="var">positive</span> =&gt; <span class="id" title="var">mod_pow_pos_aux</span> (<span class="id" title="var">BigZ.square</span> <span class="id" title="var">a</span> <span class="id" title="var">mod</span> <span class="id" title="var">m</span>) <span class="id" title="var">x</span> <span class="id" title="var">m</span> <span class="id" title="var">r</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">x</span>~1%<span class="id" title="var">positive</span> =&gt; <span class="id" title="var">mod_pow_pos_aux</span> (<span class="id" title="var">BigZ.square</span> <span class="id" title="var">a</span> <span class="id" title="var">mod</span> <span class="id" title="var">m</span>) <span class="id" title="var">x</span> <span class="id" title="var">m</span> (<span class="id" title="var">r</span> * <span class="id" title="var">a</span> <span class="id" title="var">mod</span> <span class="id" title="var">m</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <span class="id" title="var">r</span> * <span class="id" title="var">a</span> <span class="id" title="var">mod</span> <span class="id" title="var">m</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">mod_pow_pos</span> (<span class="id" title="var">a</span> : <span class="id" title="var">bigZ</span>) (<span class="id" title="var">x</span> : <span class="id" title="var">positive</span>) (<span class="id" title="var">m</span> : <span class="id" title="var">bigZ</span>) : <span class="id" title="var">bigZ</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mod_pow_pos_aux</span> <span class="id" title="var">a</span> <span class="id" title="var">x</span> <span class="id" title="var">m</span> 1.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">egcd_aux</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">n</span> : <span class="id" title="var">nat</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">r0</span> <span class="id" title="var">a0</span> <span class="id" title="var">b0</span> <span class="id" title="var">r1</span> <span class="id" title="var">a1</span> <span class="id" title="var">b1</span> : <span class="id" title="var">bigZ</span>) {<span class="id" title="keyword">struct</span> <span class="id" title="var">n</span>} : <span class="id" title="var">bigZ</span> * <span class="id" title="var">bigZ</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">n</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| 0%<span class="id" title="var">nat</span> =&gt; (0, 0)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">S</span> <span class="id" title="var">n</span> =&gt; <span class="id" title="keyword">let</span> (<span class="id" title="var">q</span>, <span class="id" title="var">r</span>) := <span class="id" title="var">BigZ.div_eucl</span> <span class="id" title="var">r0</span> <span class="id" title="var">r1</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> <span class="id" title="var">r</span> =? 0 <span class="id" title="keyword">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">a1</span>, <span class="id" title="var">b1</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">egcd_aux</span> <span class="id" title="var">n</span> <span class="id" title="var">r1</span> <span class="id" title="var">a1</span> <span class="id" title="var">b1</span> <span class="id" title="var">r</span> (<span class="id" title="var">a0</span> - <span class="id" title="var">q</span>*<span class="id" title="var">a1</span>) (<span class="id" title="var">b0</span> - <span class="id" title="var">q</span>*<span class="id" title="var">b1</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">egcd</span> (<span class="id" title="var">m</span> <span class="id" title="var">n</span> : <span class="id" title="var">bigZ</span>) : <span class="id" title="var">bigZ</span> * <span class="id" title="var">bigZ</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> <span class="id" title="var">m</span> =? 0 <span class="id" title="keyword">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(0, <span class="id" title="var">BigZ.sgn</span> <span class="id" title="var">n</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> <span class="id" title="var">n</span> =? 0 <span class="id" title="keyword">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">BigZ.sgn</span> <span class="id" title="var">m</span>, 0)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">num_steps</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">S</span> (<span class="id" title="var">Z.to_nat</span> (<span class="id" title="var">BigZ.to_Z</span> (<span class="id" title="var">BigZ.log2</span> (<span class="id" title="var">BigZ.abs</span> <span class="id" title="var">m</span>) + <span class="id" title="var">BigZ.log2</span> (<span class="id" title="var">BigZ.abs</span> <span class="id" title="var">n</span>)))) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> <span class="id" title="var">BigZ.abs</span> <span class="id" title="var">m</span> &lt;? <span class="id" title="var">BigZ.abs</span> <span class="id" title="var">n</span> <span class="id" title="keyword">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> (<span class="id" title="var">x</span>, <span class="id" title="var">y</span>) := <span class="id" title="var">egcd_aux</span> <span class="id" title="var">num_steps</span> (<span class="id" title="var">BigZ.abs</span> <span class="id" title="var">n</span>) 1 0 (<span class="id" title="var">BigZ.abs</span> <span class="id" title="var">m</span>) 0 1 <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">BigZ.sgn</span> <span class="id" title="var">m</span> * <span class="id" title="var">y</span>, <span class="id" title="var">BigZ.sgn</span> <span class="id" title="var">n</span> * <span class="id" title="var">x</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> (<span class="id" title="var">x</span>, <span class="id" title="var">y</span>) := <span class="id" title="var">egcd_aux</span> <span class="id" title="var">num_steps</span> (<span class="id" title="var">BigZ.abs</span> <span class="id" title="var">m</span>) 1 0 (<span class="id" title="var">BigZ.abs</span> <span class="id" title="var">n</span>) 0 1 <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">BigZ.sgn</span> <span class="id" title="var">m</span> * <span class="id" title="var">x</span>, <span class="id" title="var">BigZ.sgn</span> <span class="id" title="var">n</span> * <span class="id" title="var">y</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">mod_inv</span> (<span class="id" title="var">a</span> : <span class="id" title="var">bigZ</span>) (<span class="id" title="var">p</span> : <span class="id" title="var">bigZ</span>) : <span class="id" title="var">bigZ</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">fst</span> (<span class="id" title="var">egcd</span> <span class="id" title="var">a</span> <span class="id" title="var">p</span>) <span class="id" title="var">mod</span> <span class="id" title="var">p</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">mod_pow</span> (<span class="id" title="var">a</span> : <span class="id" title="var">bigZ</span>) (<span class="id" title="var">x</span> : <span class="id" title="var">Z</span>) (<span class="id" title="var">p</span> : <span class="id" title="var">bigZ</span>) : <span class="id" title="var">bigZ</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">x</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Z0</span> =&gt; <span class="id" title="var">a</span> ^ 0 <span class="id" title="var">mod</span> <span class="id" title="var">p</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Zpos</span> <span class="id" title="var">x</span> =&gt; <span class="id" title="var">mod_pow_pos</span> <span class="id" title="var">a</span> <span class="id" title="var">x</span> <span class="id" title="var">p</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Zneg</span> <span class="id" title="var">x</span> =&gt; <span class="id" title="var">mod_inv</span> (<span class="id" title="var">mod_pow_pos</span> <span class="id" title="var">a</span> <span class="id" title="var">x</span> <span class="id" title="var">p</span>) <span class="id" title="var">p</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Hint Rewrite</span> <span class="id" title="var">BigZ.square_spec</span> <span class="id" title="var">BigZ.spec_pow_pos</span> : <span class="id" title="var">zsimpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Hint Rewrite</span> <span class="id" title="var">BigN.spec_of_pos</span> : <span class="id" title="var">nsimpl</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">spec_mod_pow_pos_aux</span> <span class="id" title="var">a</span> <span class="id" title="var">x</span> <span class="id" title="var">p</span> <span class="id" title="var">r</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="var">mod_pow_pos_aux</span> <span class="id" title="var">a</span> <span class="id" title="var">x</span> <span class="id" title="var">p</span> <span class="id" title="var">r</span>] = <span class="id" title="var">Zp.mod_pow_pos_aux</span> [<span class="id" title="var">a</span>] <span class="id" title="var">x</span> [<span class="id" title="var">p</span>] [<span class="id" title="var">r</span>].<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">revert</span> <span class="id" title="var">a</span> <span class="id" title="var">p</span> <span class="id" title="var">r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">x</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">a</span> <span class="id" title="var">p</span> <span class="id" title="var">r</span>; <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> <span class="id" title="var">IHx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">autorewrite</span> <span class="id" title="keyword">with</span> <span class="id" title="var">zsimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> <span class="id" title="var">IHx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">autorewrite</span> <span class="id" title="keyword">with</span> <span class="id" title="var">zsimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">now</span> <span class="id" title="tactic">autorewrite</span> <span class="id" title="keyword">with</span> <span class="id" title="var">zsimpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Hint Rewrite</span> <span class="id" title="var">spec_mod_pow_pos_aux</span> : <span class="id" title="var">zsimpl</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">spec_mod_pow_pos</span> <span class="id" title="var">a</span> <span class="id" title="var">x</span> <span class="id" title="var">p</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="var">mod_pow_pos</span> <span class="id" title="var">a</span> <span class="id" title="var">x</span> <span class="id" title="var">p</span>] = <span class="id" title="var">Zp.mod_pow_pos</span> [<span class="id" title="var">a</span>] <span class="id" title="var">x</span> [<span class="id" title="var">p</span>].<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">spec_mod_pow_pos_aux</span>. <span class="id" title="keyword">Qed</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Hint Rewrite</span> <span class="id" title="var">spec_mod_pow_pos</span> : <span class="id" title="var">zsimpl</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">spec_egcd_aux</span> <span class="id" title="var">n</span> <span class="id" title="var">r0</span> <span class="id" title="var">a0</span> <span class="id" title="var">b0</span> <span class="id" title="var">r1</span> <span class="id" title="var">a1</span> <span class="id" title="var">b1</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> (<span class="id" title="var">x</span>, <span class="id" title="var">y</span>) := <span class="id" title="var">egcd_aux</span> <span class="id" title="var">n</span> <span class="id" title="var">r0</span> <span class="id" title="var">a0</span> <span class="id" title="var">b0</span> <span class="id" title="var">r1</span> <span class="id" title="var">a1</span> <span class="id" title="var">b1</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;([<span class="id" title="var">x</span>], [<span class="id" title="var">y</span>]) = <span class="id" title="var">Egcd.egcd_aux</span> <span class="id" title="var">n</span> [<span class="id" title="var">r0</span>] [<span class="id" title="var">a0</span>] [<span class="id" title="var">b0</span>] [<span class="id" title="var">r1</span>] [<span class="id" title="var">a1</span>] [<span class="id" title="var">b1</span>].<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">revert</span> <span class="id" title="var">r0</span> <span class="id" title="var">a0</span> <span class="id" title="var">b0</span> <span class="id" title="var">r1</span> <span class="id" title="var">a1</span> <span class="id" title="var">b1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">n</span> <span class="id" title="keyword">as</span> [|<span class="id" title="var">n</span> <span class="id" title="var">IH</span>]; [<span class="id" title="var">easy</span>|]; <span class="id" title="tactic">intros</span> <span class="id" title="var">r0</span> <span class="id" title="var">a0</span> <span class="id" title="var">b0</span> <span class="id" title="var">r1</span> <span class="id" title="var">a1</span> <span class="id" title="var">b1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">pose</span> <span class="id" title="var">proof</span> (<span class="id" title="var">BigZ.spec_div_eucl</span> <span class="id" title="var">r0</span> <span class="id" title="var">r1</span>) <span class="id" title="keyword">as</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">BigZ.div_eucl</span> <span class="id" title="var">r0</span> <span class="id" title="var">r1</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">q</span> <span class="id" title="var">r</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">Z.div_eucl</span> [<span class="id" title="var">r0</span>] [<span class="id" title="var">r1</span>]) <span class="id" title="keyword">as</span> [<span class="id" title="var">q'</span> <span class="id" title="var">r'</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">BigZ.spec_eqb</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> ([<span class="id" title="var">r</span>] =? 0)%<span class="id" title="var">Z</span>; [<span class="id" title="var">easy</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- !<span class="id" title="var">BigZ.spec_mul</span>, &lt;- !<span class="id" title="var">BigZ.spec_sub</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IH</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Hint Rewrite</span> <span class="id" title="var">BigZ.spec_abs</span> : <span class="id" title="var">zsimpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">spec_egcd</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> (<span class="id" title="var">x</span>, <span class="id" title="var">y</span>) := <span class="id" title="var">egcd</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;([<span class="id" title="var">x</span>], [<span class="id" title="var">y</span>]) = <span class="id" title="var">Egcd.egcd</span> [<span class="id" title="var">a</span>] [<span class="id" title="var">b</span>].<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">egcd</span>, <span class="id" title="var">Egcd.egcd</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">autorewrite</span> <span class="id" title="keyword">with</span> <span class="id" title="var">zsimpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">change</span> [0] <span class="id" title="keyword">with</span> 0%<span class="id" title="var">Z</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">_</span> =? <span class="id" title="var">_</span>)%<span class="id" title="var">Z</span>; [<span class="id" title="var">now</span> <span class="id" title="tactic">autorewrite</span> <span class="id" title="keyword">with</span> <span class="id" title="var">zsimpl</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">_</span> =? <span class="id" title="var">_</span>)%<span class="id" title="var">Z</span>; [<span class="id" title="var">now</span> <span class="id" title="tactic">autorewrite</span> <span class="id" title="keyword">with</span> <span class="id" title="var">zsimpl</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">_</span> &lt;? <span class="id" title="var">_</span>)%<span class="id" title="var">Z</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">all</span>: <span class="id" title="tactic">rewrite</span> &lt;- !<span class="id" title="var">BigZ.spec_abs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">all</span>: <span class="id" title="tactic">change</span> 1%<span class="id" title="var">Z</span> <span class="id" title="keyword">with</span> [1].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">all</span>: <span class="id" title="tactic">change</span> 0%<span class="id" title="var">Z</span> <span class="id" title="keyword">with</span> [0].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">all</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [|- <span class="id" title="keyword">context</span>[<span class="id" title="var">egcd_aux</span> ?<span class="id" title="var">n</span> ?<span class="id" title="var">r0</span> ?<span class="id" title="var">a0</span> ?<span class="id" title="var">b0</span> ?<span class="id" title="var">r1</span> ?<span class="id" title="var">a1</span> ?<span class="id" title="var">b1</span>]] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">pose</span> <span class="id" title="var">proof</span> (<span class="id" title="var">spec_egcd_aux</span> <span class="id" title="var">n</span> <span class="id" title="var">r0</span> <span class="id" title="var">a0</span> <span class="id" title="var">b0</span> <span class="id" title="var">r1</span> <span class="id" title="var">a1</span> <span class="id" title="var">b1</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">egcd_aux</span> <span class="id" title="var">n</span> <span class="id" title="var">r0</span> <span class="id" title="var">a0</span> <span class="id" title="var">b0</span> <span class="id" title="var">r1</span> <span class="id" title="var">a1</span> <span class="id" title="var">b1</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">Egcd.egcd_aux</span> <span class="id" title="var">n</span> [<span class="id" title="var">r0</span>] [<span class="id" title="var">a0</span>] [<span class="id" title="var">b0</span>] [<span class="id" title="var">r1</span>] [<span class="id" title="var">a1</span>] [<span class="id" title="var">b1</span>])<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">all</span>: <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">all</span>: <span class="id" title="var">now</span> <span class="id" title="tactic">autorewrite</span> <span class="id" title="keyword">with</span> <span class="id" title="var">zsimpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">spec_mod_inv</span> <span class="id" title="var">a</span> <span class="id" title="var">p</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="var">mod_inv</span> <span class="id" title="var">a</span> <span class="id" title="var">p</span>] = <span class="id" title="var">Zp.mod_inv</span> [<span class="id" title="var">a</span>] [<span class="id" title="var">p</span>].<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">mod_inv</span>, <span class="id" title="var">Zp.mod_inv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">pose</span> <span class="id" title="var">proof</span> (<span class="id" title="var">spec_egcd</span> <span class="id" title="var">a</span> <span class="id" title="var">p</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">egcd</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>), (<span class="id" title="var">Egcd.egcd</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">autorewrite</span> <span class="id" title="keyword">with</span> <span class="id" title="var">zsimpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Hint Rewrite</span> <span class="id" title="var">spec_mod_inv</span> : <span class="id" title="var">zsimpl</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">spec_mod_pow</span> <span class="id" title="var">a</span> <span class="id" title="var">x</span> <span class="id" title="var">p</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="var">mod_pow</span> <span class="id" title="var">a</span> <span class="id" title="var">x</span> <span class="id" title="var">p</span>] = <span class="id" title="var">Zp.mod_pow</span> [<span class="id" title="var">a</span>] <span class="id" title="var">x</span> [<span class="id" title="var">p</span>].<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">mod_pow</span>, <span class="id" title="var">Zp.mod_pow</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">destruct</span> <span class="id" title="var">x</span>; <span class="id" title="tactic">autorewrite</span> <span class="id" title="keyword">with</span> <span class="id" title="var">zsimpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Hint Rewrite</span> <span class="id" title="var">spec_mod_pow</span> : <span class="id" title="var">zsimpl</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Hint Rewrite</span> <span class="id" title="var">BigZ.spec_modulo</span> : <span class="id" title="var">zsimpl</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Local Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">Z</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">boardroom_axioms</span> (<span class="id" title="var">p</span> : <span class="id" title="var">Z</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">prime</span> <span class="id" title="var">p</span> -&gt; <span class="id" title="var">BoardroomAxioms</span> <span class="id" title="var">Z</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">isprime</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">pose</span> <span class="id" title="var">proof</span> (<span class="id" title="var">prime_ge_2</span> <span class="id" title="var">_</span> <span class="id" title="var">isprime</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">refine</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{| <span class="id" title="var">elmeq</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span> := <span class="id" title="var">a</span> <span class="id" title="var">mod</span> <span class="id" title="var">p</span> = <span class="id" title="var">b</span> <span class="id" title="var">mod</span> <span class="id" title="var">p</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">elmeqb</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span> := <span class="id" title="var">a</span> <span class="id" title="var">mod</span> <span class="id" title="var">p</span> =? <span class="id" title="var">b</span> <span class="id" title="var">mod</span> <span class="id" title="var">p</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">zero</span> := 0;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">one</span> := 1;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">add</span> <span class="id" title="var">a</span> <span class="id" title="var">a'</span> := (<span class="id" title="var">a</span> + <span class="id" title="var">a'</span>) <span class="id" title="var">mod</span> <span class="id" title="var">p</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mul</span> <span class="id" title="var">a</span> <span class="id" title="var">a'</span> := (<span class="id" title="var">a</span> * <span class="id" title="var">a'</span>) <span class="id" title="var">mod</span> <span class="id" title="var">p</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">opp</span> <span class="id" title="var">a</span> := <span class="id" title="var">p</span> - <span class="id" title="var">a</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">inv</span> <span class="id" title="var">a</span> := [<span class="id" title="var">mod_inv</span> (<span class="id" title="var">BigZ.of_Z</span> <span class="id" title="var">a</span>) (<span class="id" title="var">BigZ.of_Z</span> <span class="id" title="var">p</span>)];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">pow</span> <span class="id" title="var">a</span> <span class="id" title="var">e</span> := [<span class="id" title="var">mod_pow</span> (<span class="id" title="var">BigZ.of_Z</span> <span class="id" title="var">a</span>) <span class="id" title="var">e</span> (<span class="id" title="var">BigZ.of_Z</span> <span class="id" title="var">p</span>)];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">order</span> := <span class="id" title="var">p</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|}.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>; <span class="id" title="tactic">apply</span> <span class="id" title="var">Z.eqb_spec</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">constructor</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">intros</span> <span class="id" title="var">a</span> <span class="id" title="var">a'</span> <span class="id" title="var">a''</span> -&gt; -&gt;.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">a</span> <span class="id" title="var">a'</span> <span class="id" title="var">aeq</span> <span class="id" title="var">b</span> <span class="id" title="var">b'</span> <span class="id" title="var">beq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">autorewrite</span> <span class="id" title="keyword">with</span> <span class="id" title="var">zsimpl</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z.add_mod</span>, <span class="id" title="var">aeq</span>, <span class="id" title="var">beq</span>, &lt;- <span class="id" title="var">Z.add_mod</span> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">a</span> <span class="id" title="var">a'</span> <span class="id" title="var">aeq</span> <span class="id" title="var">b</span> <span class="id" title="var">b'</span> <span class="id" title="var">beq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">autorewrite</span> <span class="id" title="keyword">with</span> <span class="id" title="var">zsimpl</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z.mul_mod</span>, <span class="id" title="var">aeq</span>, <span class="id" title="var">beq</span>, &lt;- <span class="id" title="var">Z.mul_mod</span> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">a</span> <span class="id" title="var">a'</span> <span class="id" title="var">aeq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">autorewrite</span> <span class="id" title="keyword">with</span> <span class="id" title="var">zsimpl</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Zminus_mod</span>, <span class="id" title="var">aeq</span>, &lt;- <span class="id" title="var">Zminus_mod</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">a</span> <span class="id" title="var">a'</span> <span class="id" title="var">aeq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">autorewrite</span> <span class="id" title="keyword">with</span> <span class="id" title="var">zsimpl</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">Zp.mod_inv_mod_idemp</span>, <span class="id" title="var">aeq</span>, <span class="id" title="var">Zp.mod_inv_mod_idemp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">a</span> <span class="id" title="var">a'</span> <span class="id" title="var">aeq</span> <span class="id" title="var">e</span> ? &lt;-.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">autorewrite</span> <span class="id" title="keyword">with</span> <span class="id" title="var">zsimpl</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">Zp.mod_pow_mod_idemp</span>, <span class="id" title="var">aeq</span>, <span class="id" title="var">Zp.mod_pow_mod_idemp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">a</span> <span class="id" title="var">anp</span> <span class="id" title="var">e</span> <span class="id" title="var">e'</span> <span class="id" title="var">eeq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">autorewrite</span> <span class="id" title="keyword">with</span> <span class="id" title="var">zsimpl</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- (<span class="id" title="var">Zp.mod_pow_exp_mod</span> <span class="id" title="var">_</span> <span class="id" title="var">e</span>), &lt;- (<span class="id" title="var">Zp.mod_pow_exp_mod</span> <span class="id" title="var">_</span> <span class="id" title="var">e'</span>) <span class="id" title="tactic">by</span> <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">eeq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">autorewrite</span> <span class="id" title="keyword">with</span> <span class="id" title="var">zsimpl</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z.mod_1_l</span>, <span class="id" title="var">Z.mod_0_l</span> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">autorewrite</span> <span class="id" title="keyword">with</span> <span class="id" title="var">zsimpl</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z.add_comm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span> <span class="id" title="var">c</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">autorewrite</span> <span class="id" title="keyword">with</span> <span class="id" title="var">zsimpl</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> !<span class="id" title="var">Z.mod_mod</span> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z.add_mod_idemp_l</span>, <span class="id" title="var">Z.add_mod_idemp_r</span> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">f_equal2</span>; <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">autorewrite</span> <span class="id" title="keyword">with</span> <span class="id" title="var">zsimpl</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z.mul_comm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span> <span class="id" title="var">c</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">autorewrite</span> <span class="id" title="keyword">with</span> <span class="id" title="var">zsimpl</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> (<span class="id" title="tactic">try</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z.mul_mod_idemp_l</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z.mul_mod_idemp_r</span>); <span class="id" title="tactic">try</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z.mul_assoc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">a</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">autorewrite</span> <span class="id" title="keyword">with</span> <span class="id" title="var">zsimpl</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z.mod_mod</span> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">a</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">autorewrite</span> <span class="id" title="keyword">with</span> <span class="id" title="var">zsimpl</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z.mod_mod</span> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">a</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">autorewrite</span> <span class="id" title="keyword">with</span> <span class="id" title="var">zsimpl</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z.mod_mod</span> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z.mul_1_l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">a</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">autorewrite</span> <span class="id" title="keyword">with</span> <span class="id" title="var">zsimpl</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z.mod_mod</span> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">replace</span> (<span class="id" title="var">p</span> - <span class="id" title="var">a</span> + <span class="id" title="var">a</span>)%<span class="id" title="var">Z</span> <span class="id" title="keyword">with</span> <span class="id" title="var">p</span> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z.mod_same</span>, <span class="id" title="var">Z.mod_0_l</span>; <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">a</span> <span class="id" title="var">anp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">autorewrite</span> <span class="id" title="keyword">with</span> <span class="id" title="var">zsimpl</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z.mul_comm</span>, <span class="id" title="var">Zp.mul_mod_inv</span> <span class="id" title="tactic">by</span> <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span> <span class="id" title="var">c</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">autorewrite</span> <span class="id" title="keyword">with</span> <span class="id" title="var">zsimpl</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> (<span class="id" title="tactic">try</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z.mul_mod_idemp_l</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z.mul_mod_idemp_r</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z.add_mod_idemp_l</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z.add_mod_idemp_r</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z.mod_mod</span>); <span class="id" title="tactic">try</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">f_equal2</span>; <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">a</span> <span class="id" title="var">anp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">autorewrite</span> <span class="id" title="keyword">with</span> <span class="id" title="var">zsimpl</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z.mod_1_l</span> <span class="id" title="tactic">at</span> 1 <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">a</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">autorewrite</span> <span class="id" title="keyword">with</span> <span class="id" title="var">zsimpl</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Zp.mod_pow_mod</span>, <span class="id" title="var">Zp.mod_pow_1_r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">a</span> <span class="id" title="var">ap0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">autorewrite</span> <span class="id" title="keyword">with</span> <span class="id" title="var">zsimpl</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> (<span class="id" title="var">Zp.mod_pow_exp_opp</span> <span class="id" title="var">_</span> 1) <span class="id" title="tactic">by</span> <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Zp.mod_pow_1_r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Zp.mod_inv_mod_idemp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">a</span> <span class="id" title="var">e</span> <span class="id" title="var">e'</span> <span class="id" title="var">ap0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">autorewrite</span> <span class="id" title="keyword">with</span> <span class="id" title="var">zsimpl</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Zp.mod_pow_exp_plus</span> <span class="id" title="tactic">by</span> <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span> <span class="id" title="var">e</span> <span class="id" title="var">ap0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">autorewrite</span> <span class="id" title="keyword">with</span> <span class="id" title="var">zsimpl</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Zp.mod_pow_exp_mul</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">a</span> <span class="id" title="var">e</span> <span class="id" title="var">ap0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">autorewrite</span> <span class="id" title="keyword">with</span> <span class="id" title="var">zsimpl</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">a</span> <span class="id" title="var">ap0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">autorewrite</span> <span class="id" title="keyword">with</span> <span class="id" title="var">zsimpl</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
<span class="id" title="keyword">End</span> <span class="id" title="var">BigZp</span>.<br/>

<br/>
<span class="id" title="keyword">Module</span> <span class="id" title="keyword">Type</span> <span class="id" title="var">BoardroomAxiomsZParams</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Parameter</span> <span class="id" title="var">p</span> : <span class="id" title="var">Z</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Parameter</span> <span class="id" title="var">isprime</span> : <span class="id" title="var">prime</span> <span class="id" title="var">p</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Parameter</span> <span class="id" title="var">prime_ge_2</span> : <span class="id" title="var">p</span> &gt;= 2.<br/>
<span class="id" title="keyword">End</span> <span class="id" title="var">BoardroomAxiomsZParams</span>.<br/>

<br/>
<span class="id" title="keyword">Module</span> <span class="id" title="var">BoardroomAxiomsZ</span> (<span class="id" title="var">Params</span> : <span class="id" title="var">BoardroomAxiomsZParams</span>).<br/>
<span class="id" title="keyword">Import</span> <span class="id" title="var">Params</span>.<br/>
<span class="id" title="keyword">Local Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">Z_scope</span>.<br/>
<span class="id" title="keyword">Instance</span> <span class="id" title="var">boardroom_axioms_Z</span> : <span class="id" title="var">BoardroomAxioms</span> <span class="id" title="var">Z</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
<span class="comment">(*&nbsp;pose&nbsp;proof&nbsp;(prime_ge_2).&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;pose&nbsp;proof&nbsp;(isprime).&nbsp;*)</span><br/>
<span class="id" title="tactic">refine</span><br/>
&nbsp;&nbsp;{| <span class="id" title="var">elmeq</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span> := <span class="id" title="var">a</span> <span class="id" title="var">mod</span> <span class="id" title="var">p</span> = <span class="id" title="var">b</span> <span class="id" title="var">mod</span> <span class="id" title="var">p</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">elmeqb</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span> := <span class="id" title="var">a</span> <span class="id" title="var">mod</span> <span class="id" title="var">p</span> =? <span class="id" title="var">b</span> <span class="id" title="var">mod</span> <span class="id" title="var">p</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">zero</span> := 0;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">one</span> := 1;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">add</span> <span class="id" title="var">a</span> <span class="id" title="var">a'</span> := (<span class="id" title="var">a</span> + <span class="id" title="var">a'</span>) <span class="id" title="var">mod</span> <span class="id" title="var">p</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mul</span> <span class="id" title="var">a</span> <span class="id" title="var">a'</span> := (<span class="id" title="var">a</span> * <span class="id" title="var">a'</span>) <span class="id" title="var">mod</span> <span class="id" title="var">p</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">opp</span> <span class="id" title="var">a</span> := <span class="id" title="var">p</span> - <span class="id" title="var">a</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">inv</span> <span class="id" title="var">a</span> := <span class="id" title="var">Zp.mod_inv</span> <span class="id" title="var">a</span> <span class="id" title="var">p</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">pow</span> <span class="id" title="var">a</span> <span class="id" title="var">e</span> := <span class="id" title="var">Zp.mod_pow</span> <span class="id" title="var">a</span> <span class="id" title="var">e</span> <span class="id" title="var">p</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">order</span> := <span class="id" title="var">p</span>;<br/>
&nbsp;&nbsp;|};<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;assert&nbsp;(p&nbsp;&gt;=&nbsp;2);&nbsp;apply&nbsp;prime_ge_2.&nbsp;;<br/>
&nbsp;&nbsp;(assert&nbsp;(prime&nbsp;p);&nbsp;apply&nbsp;isprime).&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">pose</span> <span class="id" title="var">proof</span> (<span class="id" title="var">prime_ge_2</span>);<br/>
&nbsp;&nbsp;<span class="id" title="tactic">pose</span> <span class="id" title="var">proof</span> (<span class="id" title="var">isprime</span>).<br/>

<br/>
- <span class="id" title="tactic">intros</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>; <span class="id" title="tactic">apply</span> <span class="id" title="var">Z.eqb_spec</span>.<br/>
- <span class="id" title="var">lia</span>.<br/>
- <span class="id" title="tactic">constructor</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">intros</span> <span class="id" title="var">a</span> <span class="id" title="var">a'</span> <span class="id" title="var">a''</span> -&gt; -&gt;.<br/>
- <span class="id" title="tactic">intros</span> <span class="id" title="var">a</span> <span class="id" title="var">a'</span> <span class="id" title="var">aeq</span> <span class="id" title="var">b</span> <span class="id" title="var">b'</span> <span class="id" title="var">beq</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">autorewrite</span> <span class="id" title="keyword">with</span> <span class="id" title="var">zsimpl</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z.add_mod</span>, <span class="id" title="var">aeq</span>, <span class="id" title="var">beq</span>, &lt;- <span class="id" title="var">Z.add_mod</span> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
- <span class="id" title="tactic">intros</span> <span class="id" title="var">a</span> <span class="id" title="var">a'</span> <span class="id" title="var">aeq</span> <span class="id" title="var">b</span> <span class="id" title="var">b'</span> <span class="id" title="var">beq</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">autorewrite</span> <span class="id" title="keyword">with</span> <span class="id" title="var">zsimpl</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z.mul_mod</span>, <span class="id" title="var">aeq</span>, <span class="id" title="var">beq</span>, &lt;- <span class="id" title="var">Z.mul_mod</span> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
- <span class="id" title="tactic">intros</span> <span class="id" title="var">a</span> <span class="id" title="var">a'</span> <span class="id" title="var">aeq</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">autorewrite</span> <span class="id" title="keyword">with</span> <span class="id" title="var">zsimpl</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Zminus_mod</span>, <span class="id" title="var">aeq</span>, &lt;- <span class="id" title="var">Zminus_mod</span>.<br/>
- <span class="id" title="tactic">intros</span> <span class="id" title="var">a</span> <span class="id" title="var">a'</span> <span class="id" title="var">aeq</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">autorewrite</span> <span class="id" title="keyword">with</span> <span class="id" title="var">zsimpl</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">Zp.mod_inv_mod_idemp</span>, <span class="id" title="var">aeq</span>, <span class="id" title="var">Zp.mod_inv_mod_idemp</span>.<br/>
- <span class="id" title="tactic">intros</span> <span class="id" title="var">a</span> <span class="id" title="var">a'</span> <span class="id" title="var">aeq</span> <span class="id" title="var">e</span> ? &lt;-.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">autorewrite</span> <span class="id" title="keyword">with</span> <span class="id" title="var">zsimpl</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">Zp.mod_pow_mod_idemp</span>, <span class="id" title="var">aeq</span>, <span class="id" title="var">Zp.mod_pow_mod_idemp</span>.<br/>
- <span class="id" title="tactic">intros</span> <span class="id" title="var">a</span> <span class="id" title="var">anp</span> <span class="id" title="var">e</span> <span class="id" title="var">e'</span> <span class="id" title="var">eeq</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">autorewrite</span> <span class="id" title="keyword">with</span> <span class="id" title="var">zsimpl</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- (<span class="id" title="var">Zp.mod_pow_exp_mod</span> <span class="id" title="var">_</span> <span class="id" title="var">e</span>), &lt;- (<span class="id" title="var">Zp.mod_pow_exp_mod</span> <span class="id" title="var">_</span> <span class="id" title="var">e'</span>) <span class="id" title="tactic">by</span> <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">eeq</span>.<br/>
- <span class="id" title="tactic">autorewrite</span> <span class="id" title="keyword">with</span> <span class="id" title="var">zsimpl</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z.mod_1_l</span>, <span class="id" title="var">Z.mod_0_l</span> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
- <span class="id" title="tactic">intros</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">autorewrite</span> <span class="id" title="keyword">with</span> <span class="id" title="var">zsimpl</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z.add_comm</span>.<br/>
- <span class="id" title="tactic">intros</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span> <span class="id" title="var">c</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">autorewrite</span> <span class="id" title="keyword">with</span> <span class="id" title="var">zsimpl</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> !<span class="id" title="var">Z.mod_mod</span> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z.add_mod_idemp_l</span>, <span class="id" title="var">Z.add_mod_idemp_r</span> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">f_equal2</span>; <span class="id" title="var">lia</span>.<br/>
- <span class="id" title="tactic">intros</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">autorewrite</span> <span class="id" title="keyword">with</span> <span class="id" title="var">zsimpl</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z.mul_comm</span>.<br/>
- <span class="id" title="tactic">intros</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span> <span class="id" title="var">c</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">autorewrite</span> <span class="id" title="keyword">with</span> <span class="id" title="var">zsimpl</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> (<span class="id" title="tactic">try</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z.mul_mod_idemp_l</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z.mul_mod_idemp_r</span>); <span class="id" title="tactic">try</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z.mul_assoc</span>.<br/>
- <span class="id" title="tactic">intros</span> <span class="id" title="var">a</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">autorewrite</span> <span class="id" title="keyword">with</span> <span class="id" title="var">zsimpl</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z.mod_mod</span> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
- <span class="id" title="tactic">intros</span> <span class="id" title="var">a</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">autorewrite</span> <span class="id" title="keyword">with</span> <span class="id" title="var">zsimpl</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z.mod_mod</span> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
- <span class="id" title="tactic">intros</span> <span class="id" title="var">a</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">autorewrite</span> <span class="id" title="keyword">with</span> <span class="id" title="var">zsimpl</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z.mod_mod</span> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z.mul_1_l</span>.<br/>
- <span class="id" title="tactic">intros</span> <span class="id" title="var">a</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">autorewrite</span> <span class="id" title="keyword">with</span> <span class="id" title="var">zsimpl</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z.mod_mod</span> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">replace</span> (<span class="id" title="var">p</span> - <span class="id" title="var">a</span> + <span class="id" title="var">a</span>)%<span class="id" title="var">Z</span> <span class="id" title="keyword">with</span> <span class="id" title="var">p</span> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z.mod_same</span>, <span class="id" title="var">Z.mod_0_l</span>; <span class="id" title="var">lia</span>.<br/>
- <span class="id" title="tactic">intros</span> <span class="id" title="var">a</span> <span class="id" title="var">anp</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">autorewrite</span> <span class="id" title="keyword">with</span> <span class="id" title="var">zsimpl</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z.mul_comm</span>, <span class="id" title="var">Zp.mul_mod_inv</span> <span class="id" title="tactic">by</span> <span class="id" title="tactic">auto</span>.<br/>
- <span class="id" title="tactic">intros</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span> <span class="id" title="var">c</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">autorewrite</span> <span class="id" title="keyword">with</span> <span class="id" title="var">zsimpl</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> (<span class="id" title="tactic">try</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z.mul_mod_idemp_l</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z.mul_mod_idemp_r</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z.add_mod_idemp_l</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z.add_mod_idemp_r</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z.mod_mod</span>); <span class="id" title="tactic">try</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">f_equal2</span>; <span class="id" title="var">lia</span>.<br/>
- <span class="id" title="tactic">intros</span> <span class="id" title="var">a</span> <span class="id" title="var">anp</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">autorewrite</span> <span class="id" title="keyword">with</span> <span class="id" title="var">zsimpl</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;<span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Z.mod_1_l</span> <span class="id" title="tactic">at</span> 1 <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
- <span class="id" title="tactic">intros</span> <span class="id" title="var">a</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">autorewrite</span> <span class="id" title="keyword">with</span> <span class="id" title="var">zsimpl</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Zp.mod_pow_mod</span>, <span class="id" title="var">Zp.mod_pow_1_r</span>.<br/>
- <span class="id" title="tactic">intros</span> <span class="id" title="var">a</span> <span class="id" title="var">ap0</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">autorewrite</span> <span class="id" title="keyword">with</span> <span class="id" title="var">zsimpl</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> (<span class="id" title="var">Zp.mod_pow_exp_opp</span> <span class="id" title="var">_</span> 1) <span class="id" title="tactic">by</span> <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Zp.mod_pow_1_r</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Zp.mod_inv_mod_idemp</span>.<br/>
- <span class="id" title="tactic">intros</span> <span class="id" title="var">a</span> <span class="id" title="var">e</span> <span class="id" title="var">e'</span> <span class="id" title="var">ap0</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">autorewrite</span> <span class="id" title="keyword">with</span> <span class="id" title="var">zsimpl</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Zp.mod_pow_exp_plus</span> <span class="id" title="tactic">by</span> <span class="id" title="tactic">auto</span>.<br/>
- <span class="id" title="tactic">intros</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span> <span class="id" title="var">e</span> <span class="id" title="var">ap0</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">autorewrite</span> <span class="id" title="keyword">with</span> <span class="id" title="var">zsimpl</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Zp.mod_pow_exp_mul</span>.<br/>
- <span class="id" title="tactic">intros</span> <span class="id" title="var">a</span> <span class="id" title="var">e</span> <span class="id" title="var">ap0</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">autorewrite</span> <span class="id" title="keyword">with</span> <span class="id" title="var">zsimpl</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">auto</span>.<br/>
- <span class="id" title="tactic">intros</span> <span class="id" title="var">a</span> <span class="id" title="var">ap0</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">autorewrite</span> <span class="id" title="keyword">with</span> <span class="id" title="var">zsimpl</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">auto</span>.<br/>
<span class="id" title="keyword">Defined</span>.<br/>

<br/>
<span class="id" title="keyword">End</span> <span class="id" title="var">BoardroomAxiomsZ</span>.<br/>

<br/>
</div>
</div>
<div id="footer">
  Generated by <a href="https://coq.inria.fr/">coqdoc</a> and improved with <a href="https://github.com/tebbi/coqdocjs">CoqdocJS</a> and <a href="https://github.com/jgallen23/toc">TOC</a>
</div>
</div>
<script>
  const elements = document.getElementsByClassName("libtitle");
  while(elements.length > 0){
        elements[0].parentNode.removeChild(elements[0]);
  }
  if (window.location.pathname.endsWith("/toc.html")) {
      const jstocDiv = document.getElementById("js-toc");
      jstocDiv.classList.remove("toc");
      jstocDiv.classList.add("jstoc-hidden");
      const jstocHeaderDiv = document.getElementById("js-toc-header");
      jstocHeaderDiv.classList.add("jstoc-hidden");
  }
  console.log(window.location.pathname);
</script>
<script type="text/javascript" src="toc.js"></script>
</body>

</html>
