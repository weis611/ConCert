<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<link href="coqdoc.css" rel="stylesheet" type="text/css" />
<link href="coqdocjs.css" rel="stylesheet" type="text/css"/>
<link href="toc.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="config.js"></script>
<script type="text/javascript" src="coqdocjs.js"></script>
</head>

<body onload="document.getElementById('content').focus()">
  <div id="header">
    <span class="left">
      <span class="modulename"> <script> document.write(document.title) </script> </span>
    </span>

    <span class="button" id="toggle-proofs"></span>

    <span class="right">
      <a href="toc.html">Table of contents</a>
      <a href="https://github.com/AU-COBRA/ConCert" target="_balnk">Project Page</a>
    </span>
</div>
  <div id="content" tabindex="-1" onblur="document.getElementById('content').focus()">
    <div id="js-toc-header" class="toc-header">Contents:</div>
    <div id="js-toc" class="toc" data-toc="h1,h2,h3,h4" data-toc-container="doc">
    </div>
    <div id="main">
<h1 class="libtitle">Library ConCert.Examples.fa2.FA2TokenTests</h1>

<div class="code">
<span class="id" title="keyword">From</span> <span class="id" title="var">ConCert.Execution</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Blockchain</span>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">ConCert.Execution</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Containers</span>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">ConCert.Execution</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Serializable</span>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">ConCert.Execution</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">ResultMonad</span>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">ConCert.Execution.Test</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">QCTest</span>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">ConCert.Examples.FA2</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">FA2Token</span>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">ConCert.Examples.FA2</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">FA2Interface</span>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">ConCert.Examples.FA2</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">TestContracts</span>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">ConCert.Utils</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Extras</span>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">Coq</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">ZArith</span>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">Coq</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">List</span>.<br/>
<span class="id" title="keyword">Import</span> <span class="id" title="var">ListNotations</span>.<br/>

<br/>
</div>

<div class="doc">
example policies 
</div>
<div class="code">

<br/>
<span class="comment">(*&nbsp;the&nbsp;policy&nbsp;which&nbsp;allows&nbsp;only&nbsp;token&nbsp;owners&nbsp;to&nbsp;transfer&nbsp;their&nbsp;own&nbsp;tokens.&nbsp;*)</span><br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">policy_self_only</span> : <span class="id" title="var">permissions_descriptor</span> := {|<br/>
&nbsp;&nbsp;<span class="id" title="var">descr_self</span> := <span class="id" title="var">self_transfer_permitted</span>;<br/>
&nbsp;&nbsp;<span class="id" title="var">descr_operator</span> := <span class="id" title="var">operator_transfer_denied</span>;<br/>
&nbsp;&nbsp;<span class="id" title="var">descr_sender</span> := <span class="id" title="var">owner_no_op</span>;<br/>
&nbsp;&nbsp;<span class="id" title="var">descr_receiver</span> := <span class="id" title="var">owner_no_op</span>;<br/>
&nbsp;&nbsp;<span class="id" title="var">descr_custom</span> := <span class="id" title="var">None</span>;<br/>
|}.<br/>

<br/>
<span class="comment">(*&nbsp;the&nbsp;policy&nbsp;which&nbsp;allows&nbsp;only&nbsp;operators&nbsp;to&nbsp;transfer&nbsp;tokens.&nbsp;*)</span><br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">policy_operators_only</span> : <span class="id" title="var">permissions_descriptor</span> := {|<br/>
&nbsp;&nbsp;<span class="id" title="var">descr_self</span> := <span class="id" title="var">self_transfer_denied</span>;<br/>
&nbsp;&nbsp;<span class="id" title="var">descr_operator</span> := <span class="id" title="var">operator_transfer_permitted</span>;<br/>
&nbsp;&nbsp;<span class="id" title="var">descr_sender</span> := <span class="id" title="var">owner_no_op</span>;<br/>
&nbsp;&nbsp;<span class="id" title="var">descr_receiver</span> := <span class="id" title="var">owner_no_op</span>;<br/>
&nbsp;&nbsp;<span class="id" title="var">descr_custom</span> := <span class="id" title="var">None</span>;<br/>
|}.<br/>

<br/>
<span class="comment">(*&nbsp;non-transferable&nbsp;token&nbsp;(neither&nbsp;token&nbsp;owner,&nbsp;nor&nbsp;operators&nbsp;can&nbsp;transfer&nbsp;tokens.&nbsp;*)</span><br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">policy_no_transfers</span> : <span class="id" title="var">permissions_descriptor</span> := {|<br/>
&nbsp;&nbsp;<span class="id" title="var">descr_self</span> := <span class="id" title="var">self_transfer_denied</span>;<br/>
&nbsp;&nbsp;<span class="id" title="var">descr_operator</span> := <span class="id" title="var">operator_transfer_denied</span>;<br/>
&nbsp;&nbsp;<span class="id" title="var">descr_sender</span> := <span class="id" title="var">owner_no_op</span>;<br/>
&nbsp;&nbsp;<span class="id" title="var">descr_receiver</span> := <span class="id" title="var">owner_no_op</span>;<br/>
&nbsp;&nbsp;<span class="id" title="var">descr_custom</span> := <span class="id" title="var">None</span>;<br/>
|}.<br/>

<br/>
<span class="comment">(*&nbsp;the&nbsp;policy&nbsp;which&nbsp;allows&nbsp;both&nbsp;owners&nbsp;and&nbsp;operators&nbsp;to&nbsp;transfer&nbsp;tokens.&nbsp;*)</span><br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">policy_all</span> : <span class="id" title="var">permissions_descriptor</span> := {|<br/>
&nbsp;&nbsp;<span class="id" title="var">descr_self</span> := <span class="id" title="var">self_transfer_permitted</span>;<br/>
&nbsp;&nbsp;<span class="id" title="var">descr_operator</span> := <span class="id" title="var">operator_transfer_permitted</span>;<br/>
&nbsp;&nbsp;<span class="id" title="var">descr_sender</span> := <span class="id" title="var">owner_no_op</span>;<br/>
&nbsp;&nbsp;<span class="id" title="var">descr_receiver</span> := <span class="id" title="var">owner_no_op</span>;<br/>
&nbsp;&nbsp;<span class="id" title="var">descr_custom</span> := <span class="id" title="var">None</span>;<br/>
|}.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">token_metadata_0</span> : <span class="id" title="var">token_metadata</span> := {|<br/>
&nbsp;&nbsp;<span class="id" title="var">metadata_token_id</span> := 0%<span class="id" title="var">N</span>;<br/>
&nbsp;&nbsp;<span class="id" title="var">metadata_decimals</span> := 8%<span class="id" title="var">N</span>;<br/>
|}.<br/>

<br/>
<span class="comment">(*&nbsp;Contract&nbsp;setups&nbsp;and&nbsp;deployments&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">token_setup</span> (<span class="id" title="var">hook_addr</span> : <span class="id" title="var">option</span> <span class="id" title="var">Address</span>): <span class="id" title="var">FA2Token.Setup</span> := {|<br/>
&nbsp;&nbsp;<span class="id" title="var">setup_total_supply</span> := [];<br/>
&nbsp;&nbsp;<span class="id" title="var">setup_tokens</span> := <span class="id" title="var">FMap.add</span> 0%<span class="id" title="var">N</span> <span class="id" title="var">token_metadata_0</span> <span class="id" title="var">FMap.empty</span>;<br/>
&nbsp;&nbsp;<span class="id" title="var">initial_permission_policy</span> := <span class="id" title="var">policy_all</span>;<br/>
&nbsp;&nbsp;<span class="id" title="var">transfer_hook_addr_</span> := <span class="id" title="var">hook_addr</span>;<br/>
|}.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">token_contract_base_addr</span> : <span class="id" title="var">Address</span> := <span class="id" title="var">addr_of_Z</span> 128%<span class="id" title="var">Z</span>.<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">fa2hook_setup</span> : <span class="id" title="var">HookSetup</span> := {|<br/>
&nbsp;&nbsp;<span class="id" title="var">hook_fa2_caddr_</span> := <span class="id" title="var">token_contract_base_addr</span>;<br/>
&nbsp;&nbsp;<span class="id" title="var">hook_policy_</span> := <span class="id" title="var">policy_self_only</span>;<br/>
|}.<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">deploy_fa2hook</span> := <span class="id" title="var">create_deployment</span> 0 <span class="id" title="var">hook_contract</span> <span class="id" title="var">fa2hook_setup</span>.<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">fa2hook_contract_addr</span> : <span class="id" title="var">Address</span> := <span class="id" title="var">addr_of_Z</span> 130%<span class="id" title="var">Z</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">deploy_fa2token_with_transfer_hook</span> : @<span class="id" title="var">ActionBody</span> <span class="id" title="var">LocalChainBase</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="var">create_deployment</span> 0 <span class="id" title="var">FA2Token.contract</span> (<span class="id" title="var">token_setup</span> (<span class="id" title="var">Some</span> <span class="id" title="var">fa2hook_contract_addr</span>)).<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">deploy_fa2token_without_transfer_hook</span> : @<span class="id" title="var">ActionBody</span> <span class="id" title="var">LocalChainBase</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="var">create_deployment</span> 0 <span class="id" title="var">FA2Token.contract</span> (<span class="id" title="var">token_setup</span> <span class="id" title="var">None</span>).<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">token_client_setup</span> := <span class="id" title="var">build_clientsetup</span> <span class="id" title="var">token_contract_base_addr</span>.<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">deploy_fa2token_client</span> : @<span class="id" title="var">ActionBody</span> <span class="id" title="var">LocalChainBase</span> := <span class="id" title="var">create_deployment</span> 0 <span class="id" title="var">client_contract</span> <span class="id" title="var">token_client_setup</span>.<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">client_contract_addr</span> : <span class="id" title="var">Address</span> := <span class="id" title="var">addr_of_Z</span> 129%<span class="id" title="var">Z</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">chain_with_token_deployed_with_hook</span> : <span class="id" title="var">ChainBuilder</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="var">unpack_result</span> (<span class="id" title="var">TraceGens.add_block</span> <span class="id" title="var">empty_chain</span><br/>
&nbsp;&nbsp;[<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">build_act</span> <span class="id" title="var">creator</span> <span class="id" title="var">creator</span> (<span class="id" title="var">act_transfer</span> <span class="id" title="var">person_1</span> 10);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">build_act</span> <span class="id" title="var">creator</span> <span class="id" title="var">creator</span> (<span class="id" title="var">act_transfer</span> <span class="id" title="var">person_2</span> 10);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">build_act</span> <span class="id" title="var">creator</span> <span class="id" title="var">creator</span> (<span class="id" title="var">act_transfer</span> <span class="id" title="var">person_3</span> 10);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">build_act</span> <span class="id" title="var">creator</span> <span class="id" title="var">creator</span> <span class="id" title="var">deploy_fa2token_with_transfer_hook</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">build_act</span> <span class="id" title="var">creator</span> <span class="id" title="var">creator</span> <span class="id" title="var">deploy_fa2token_client</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">build_act</span> <span class="id" title="var">creator</span> <span class="id" title="var">creator</span> <span class="id" title="var">deploy_fa2hook</span><br/>
&nbsp;&nbsp;]).<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">chain_with_token_deployed_without_hook</span> : <span class="id" title="var">ChainBuilder</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="var">unpack_result</span> (<span class="id" title="var">TraceGens.add_block</span> <span class="id" title="var">empty_chain</span><br/>
&nbsp;&nbsp;[<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">build_act</span> <span class="id" title="var">creator</span> <span class="id" title="var">creator</span> (<span class="id" title="var">act_transfer</span> <span class="id" title="var">person_1</span> 10);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">build_act</span> <span class="id" title="var">creator</span> <span class="id" title="var">creator</span> (<span class="id" title="var">act_transfer</span> <span class="id" title="var">person_2</span> 10);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">build_act</span> <span class="id" title="var">creator</span> <span class="id" title="var">creator</span> (<span class="id" title="var">act_transfer</span> <span class="id" title="var">person_3</span> 10);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">build_act</span> <span class="id" title="var">creator</span> <span class="id" title="var">creator</span> <span class="id" title="var">deploy_fa2token_without_transfer_hook</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">build_act</span> <span class="id" title="var">creator</span> <span class="id" title="var">creator</span> <span class="id" title="var">deploy_fa2token_client</span><br/>
&nbsp;&nbsp;]).<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">chain_without_transfer_hook'</span> : <span class="id" title="var">result</span> <span class="id" title="var">ChainBuilder</span> <span class="id" title="var">AddBlockError</span> :=<br/>
&nbsp;&nbsp;(<span class="id" title="var">TraceGens.add_block</span> <span class="id" title="var">chain_with_token_deployed_without_hook</span><br/>
&nbsp;&nbsp;[<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">build_act</span> <span class="id" title="var">person_1</span> <span class="id" title="var">person_1</span> (<span class="id" title="var">act_call</span> <span class="id" title="var">token_contract_base_addr</span> 10%<span class="id" title="var">Z</span> (<span class="id" title="var">serialize</span> (<span class="id" title="var">msg_create_tokens</span> 0%<span class="id" title="var">N</span>))) ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">build_act</span> <span class="id" title="var">person_2</span> <span class="id" title="var">person_2</span> (<span class="id" title="var">act_call</span> <span class="id" title="var">token_contract_base_addr</span> 10%<span class="id" title="var">Z</span> (<span class="id" title="var">serialize</span> (<span class="id" title="var">msg_create_tokens</span> 0%<span class="id" title="var">N</span>)))<br/>
&nbsp;&nbsp;]).<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">chain_with_transfer_hook'</span> : <span class="id" title="var">result</span> <span class="id" title="var">ChainBuilder</span> <span class="id" title="var">AddBlockError</span> :=<br/>
&nbsp;&nbsp;(<span class="id" title="var">TraceGens.add_block</span> <span class="id" title="var">chain_with_token_deployed_with_hook</span><br/>
&nbsp;&nbsp;[<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">build_act</span> <span class="id" title="var">person_1</span> <span class="id" title="var">person_1</span> (<span class="id" title="var">act_call</span> <span class="id" title="var">token_contract_base_addr</span> 10%<span class="id" title="var">Z</span> (<span class="id" title="var">serialize</span> (<span class="id" title="var">msg_create_tokens</span> 0%<span class="id" title="var">N</span>))) ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">build_act</span> <span class="id" title="var">person_2</span> <span class="id" title="var">person_2</span> (<span class="id" title="var">act_call</span> <span class="id" title="var">token_contract_base_addr</span> 10%<span class="id" title="var">Z</span> (<span class="id" title="var">serialize</span> (<span class="id" title="var">msg_create_tokens</span> 0%<span class="id" title="var">N</span>)))<br/>
&nbsp;&nbsp;]).<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">chain_without_transfer_hook</span> := <span class="id" title="var">unpack_result</span> <span class="id" title="var">chain_without_transfer_hook'</span>.<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">chain_with_transfer_hook</span> := <span class="id" title="var">unpack_result</span> <span class="id" title="var">chain_with_transfer_hook'</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">client_other_msg</span> := @<span class="id" title="var">other_msg</span> <span class="id" title="var">_</span> <span class="id" title="var">FA2ClientMsg</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">call_client_is_op_act</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">params</span> := <span class="id" title="var">Build_is_operator_param</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">Build_operator_param</span> <span class="id" title="var">zero_address</span> <span class="id" title="var">zero_address</span> <span class="id" title="var">all_tokens</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">Build_callback</span> <span class="id" title="var">is_operator_response</span> <span class="id" title="var">None</span> <span class="id" title="var">client_contract_addr</span>) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">msg</span> := <span class="id" title="var">client_other_msg</span> (<span class="id" title="var">Call_fa2_is_operator</span> <span class="id" title="var">params</span>) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="var">act_call</span> <span class="id" title="var">client_contract_addr</span> 0%<span class="id" title="var">Z</span> (<span class="id" title="var">serialize</span> <span class="id" title="var">msg</span>).<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">token_state</span> (<span class="id" title="var">cs</span> : <span class="id" title="var">Environment</span>) := <span class="id" title="var">get_contract_state</span> <span class="id" title="var">FA2Token.State</span> <span class="id" title="var">cs</span> <span class="id" title="var">token_contract_base_addr</span>.<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">client_state</span> (<span class="id" title="var">cs</span> : <span class="id" title="var">Environment</span>) := <span class="id" title="var">get_contract_state</span> <span class="id" title="var">ClientState</span> <span class="id" title="var">cs</span> <span class="id" title="var">client_contract_addr</span>.<br/>

<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">ConCert.Examples.FA2</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">FA2Gens</span>.<br/>

<br/>
<span class="id" title="keyword">Module</span> <span class="id" title="var">TestInfo</span> &lt;: <span class="id" title="var">FA2TestsInfo</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Import</span> <span class="id" title="var">Monads</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Import</span> <span class="id" title="var">MonadNotation</span>. <span class="id" title="keyword">Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">monad_scope</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">fa2_contract_addr</span> := <span class="id" title="var">token_contract_base_addr</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">fa2_client_addr</span> := <span class="id" title="var">client_contract_addr</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">fa2_hook_addr</span> := <span class="id" title="var">fa2hook_contract_addr</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">accounts</span> := <span class="id" title="var">test_chain_addrs_5</span>.<br/>
<span class="id" title="keyword">End</span> <span class="id" title="var">TestInfo</span>.<br/>
<span class="id" title="keyword">Module</span> <span class="id" title="var">MG</span> := <span class="id" title="var">FA2Gens.FA2Gens</span> <span class="id" title="var">TestInfo</span>. <span class="id" title="keyword">Import</span> <span class="id" title="var">MG</span>.<br/>

<br/>
<span class="id" title="keyword">Module</span> <span class="id" title="var">NotationInfo</span> &lt;: <span class="id" title="var">TestNotationParameters</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">gAction</span> := <span class="id" title="var">gFA2TokenAction</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">init_cb</span> := <span class="id" title="var">chain_with_transfer_hook</span>.<br/>
<span class="id" title="keyword">End</span> <span class="id" title="var">NotationInfo</span>.<br/>
<span class="id" title="keyword">Module</span> <span class="id" title="var">TN</span> := <span class="id" title="var">TestNotations</span> <span class="id" title="var">NotationInfo</span>. <span class="id" title="keyword">Import</span> <span class="id" title="var">TN</span>.<br/>
<span class="id" title="keyword">Extract</span> <span class="id" title="var">Constant</span> <span class="id" title="var">max_acts_per_block</span> =&gt; "1".<br/>
<span class="comment">(*&nbsp;Sample&nbsp;gChain.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Local Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">Z_scope</span>.<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">transfer_state_update_correct</span> <span class="id" title="var">prev_state</span> <span class="id" title="var">next_state</span> <span class="id" title="var">transfers</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">balance_diffs_map</span> : <span class="id" title="var">FMap</span> (<span class="id" title="var">Address</span> * <span class="id" title="var">token_id</span>) <span class="id" title="var">Z</span> := <span class="id" title="var">fold_left</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">current_diff_map</span> <span class="id" title="var">trx</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;subtract&nbsp;amount&nbsp;from&nbsp;sender&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">m1</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">amount</span> := <span class="id" title="var">Z.of_N</span> (<span class="id" title="var">trx</span>.(<span class="id" title="var">amount</span>)) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">from_key</span> := (<span class="id" title="var">trx</span>.(<span class="id" title="var">from_</span>), <span class="id" title="var">trx</span>.(<span class="id" title="var">transfer_token_id</span>)) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">FMap.find</span> <span class="id" title="var">from_key</span> <span class="id" title="var">current_diff_map</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Some</span> <span class="id" title="var">current_diff</span> =&gt; <span class="id" title="var">FMap.add</span> <span class="id" title="var">from_key</span> (<span class="id" title="var">current_diff</span> - <span class="id" title="var">amount</span>) <span class="id" title="var">current_diff_map</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">None</span> =&gt; <span class="id" title="var">FMap.add</span> <span class="id" title="var">from_key</span> (-<span class="id" title="var">amount</span>) <span class="id" title="var">current_diff_map</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;add&nbsp;amount&nbsp;to&nbsp;receiver&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">m2</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">amount</span> := <span class="id" title="var">Z.of_N</span> (<span class="id" title="var">trx</span>.(<span class="id" title="var">amount</span>)) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">to_key</span> := (<span class="id" title="var">trx</span>.(<span class="id" title="var">to_</span>), <span class="id" title="var">trx</span>.(<span class="id" title="var">transfer_token_id</span>)) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">FMap.find</span> <span class="id" title="var">to_key</span> <span class="id" title="var">m1</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Some</span> <span class="id" title="var">current_diff</span> =&gt; <span class="id" title="var">FMap.add</span> <span class="id" title="var">to_key</span> (<span class="id" title="var">current_diff</span> + <span class="id" title="var">amount</span>) <span class="id" title="var">m1</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">None</span> =&gt; <span class="id" title="var">FMap.add</span> <span class="id" title="var">to_key</span> <span class="id" title="var">amount</span> <span class="id" title="var">m1</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">m2</span><br/>
&nbsp;&nbsp;) <span class="id" title="var">transfers</span> <span class="id" title="var">FMap.empty</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">balance_update_correct</span> <span class="id" title="var">p</span> <span class="id" title="var">balance_diff</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">addr</span> := <span class="id" title="var">fst</span> <span class="id" title="var">p</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">tokenid</span> := <span class="id" title="var">snd</span> <span class="id" title="var">p</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">balance_before</span> := <span class="id" title="var">Z.of_N</span> (<span class="id" title="var">address_balance</span> <span class="id" title="var">tokenid</span> <span class="id" title="var">addr</span> <span class="id" title="var">prev_state</span>) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">balance_after</span> := <span class="id" title="var">Z.of_N</span> (<span class="id" title="var">address_balance</span> <span class="id" title="var">tokenid</span> <span class="id" title="var">addr</span> <span class="id" title="var">next_state</span>) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;check&nbsp;that&nbsp;balance_diff&nbsp;is&nbsp;equal&nbsp;to&nbsp;the&nbsp;difference&nbsp;in&nbsp;recorded&nbsp;balance&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">whenFail</span> (<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"Failed predicate with owner: " ++ <span class="id" title="var">show</span> <span class="id" title="var">addr</span> ++ <span class="id" title="var">nl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"Expected new balance: " ++ <span class="id" title="var">show</span> <span class="id" title="var">balance_after</span> ++ <span class="id" title="var">nl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"But got: " ++ <span class="id" title="var">show</span> <span class="id" title="var">balance_before</span> ++ " + " ++ <span class="id" title="var">show</span> <span class="id" title="var">balance_diff</span> ++ " = " ++ <span class="id" title="var">show</span> (<span class="id" title="var">balance_before</span> + <span class="id" title="var">balance_diff</span>)  <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;((<span class="id" title="var">balance_before</span> + <span class="id" title="var">balance_diff</span>) =? <span class="id" title="var">balance_after</span>) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="var">forEachMapEntry</span> <span class="id" title="var">balance_diffs_map</span> <span class="id" title="var">balance_update_correct</span>.<br/>
<span class="id" title="keyword">Local Close</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">Z_scope</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">msg_is_transfer</span> (<span class="id" title="var">cstate</span> : <span class="id" title="var">FA2Token.State</span>) (<span class="id" title="var">msg</span> : <span class="id" title="var">FA2Token.Msg</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">msg</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">msg_transfer</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">true</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <span class="id" title="var">false</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">post_transfer_correct</span> (<span class="id" title="var">chain</span> : <span class="id" title="var">Chain</span>) (<span class="id" title="var">cctx</span> : <span class="id" title="var">ContractCallContext</span>) <span class="id" title="var">old_state</span> <span class="id" title="var">msg</span> (<span class="id" title="var">result_opt</span> : <span class="id" title="var">option</span> (<span class="id" title="var">FA2Token.State</span> * <span class="id" title="var">list</span> <span class="id" title="var">ActionBody</span>)) :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">result_opt</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">Some</span> (<span class="id" title="var">new_state</span>, <span class="id" title="var">_</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">transfers</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">msg</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">msg_transfer</span> <span class="id" title="var">transfers</span> =&gt; <span class="id" title="var">transfers</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; []<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">checker</span> (<span class="id" title="var">transfer_state_update_correct</span> <span class="id" title="var">old_state</span> <span class="id" title="var">new_state</span> <span class="id" title="var">transfers</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">None</span> =&gt; <span class="id" title="var">checker</span> <span class="id" title="var">false</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="comment">(*&nbsp;QuickChick&nbsp;(<br/>
&nbsp;&nbsp;{{&nbsp;msg_is_transfer&nbsp;}}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;token_contract_base_addr<br/>
&nbsp;&nbsp;{{&nbsp;post_transfer_correct&nbsp;}}<br/>
&nbsp;&nbsp;chain_without_transfer_hook).&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;14&nbsp;seconds,&nbsp;max&nbsp;size&nbsp;7,&nbsp;1&nbsp;act&nbsp;per&nbsp;block&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;+++&nbsp;Passed&nbsp;10000&nbsp;tests&nbsp;(0&nbsp;discards)&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">get_transfer_from_act</span> (<span class="id" title="var">act</span> : <span class="id" title="var">Action</span>) : <span class="id" title="var">option</span> (<span class="id" title="var">list</span> <span class="id" title="var">transfer</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">act</span>.(<span class="id" title="var">act_body</span>) <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">act_call</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">msg</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">deserialize</span> <span class="id" title="var">FA2Token.Msg</span> <span class="id" title="var">_</span> <span class="id" title="var">msg</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Some</span> (<span class="id" title="var">msg_transfer</span> <span class="id" title="var">transfers</span>) =&gt; <span class="id" title="var">Some</span> <span class="id" title="var">transfers</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <span class="id" title="var">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <span class="id" title="var">None</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="comment">(*&nbsp;get&nbsp;the&nbsp;queued&nbsp;transfer&nbsp;actions&nbsp;in&nbsp;the&nbsp;old&nbsp;state,&nbsp;and&nbsp;check&nbsp;that&nbsp;the&nbsp;succeeding&nbsp;state<br/>
&nbsp;&nbsp;&nbsp;has&nbsp;updated&nbsp;the&nbsp;balances&nbsp;correctly.<br/>
&nbsp;&nbsp;&nbsp;Assumes&nbsp;that&nbsp;there&nbsp;is&nbsp;at&nbsp;most&nbsp;one&nbsp;transfer&nbsp;action&nbsp;per&nbsp;block&nbsp;*)</span><br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">transfer_balances_correct</span> (<span class="id" title="var">old_cs</span> <span class="id" title="var">new_cs</span> : <span class="id" title="var">ChainState</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">get_transfer_transfers</span> (<span class="id" title="var">msgs</span> : <span class="id" title="var">list</span> <span class="id" title="var">Action</span>) := <span class="id" title="var">fold_left</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">acc</span> <span class="id" title="var">act</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> <span class="id" title="var">isSome</span> <span class="id" title="var">acc</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">then</span> <span class="id" title="var">acc</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span> <span class="id" title="keyword">match</span> <span class="id" title="var">get_transfer_from_act</span> <span class="id" title="var">act</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Some</span> <span class="id" title="var">trxs</span> =&gt; <span class="id" title="var">Some</span> <span class="id" title="var">trxs</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <span class="id" title="var">acc</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;) <span class="id" title="var">msgs</span> <span class="id" title="var">None</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">get_transfer_transfers</span> <span class="id" title="var">old_cs</span>.(<span class="id" title="var">chain_state_queue</span>) <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">Some</span> <span class="id" title="var">transfers</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;check&nbsp;that&nbsp;new_cs&nbsp;is&nbsp;updated&nbsp;correctly&nbsp;from&nbsp;old_cs&nbsp;according&nbsp;to&nbsp;the&nbsp;transfers&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">prev_state</span> := <span class="id" title="var">token_state</span> <span class="id" title="var">old_cs</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">next_state</span> := <span class="id" title="var">token_state</span> <span class="id" title="var">new_cs</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> (<span class="id" title="var">prev_state</span>, <span class="id" title="var">next_state</span>) <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| (<span class="id" title="var">Some</span> <span class="id" title="var">prev_state</span>, <span class="id" title="var">Some</span> <span class="id" title="var">next_state</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">whenFail</span> (<span class="id" title="var">show</span> <span class="id" title="var">prev_state</span> ++ <span class="id" title="var">nl</span> ++ <span class="id" title="var">show</span> <span class="id" title="var">next_state</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">checker</span> (<span class="id" title="var">transfer_state_update_correct</span> <span class="id" title="var">prev_state</span> <span class="id" title="var">next_state</span> <span class="id" title="var">transfers</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <span class="id" title="var">checker</span> <span class="id" title="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">None</span> =&gt; <span class="id" title="var">checker</span> <span class="id" title="var">true</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="comment">(*&nbsp;QuickChick&nbsp;(forAllChainStatePairs&nbsp;transfer_balances_correct).&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;+++&nbsp;Passed&nbsp;10000&nbsp;tests&nbsp;(0&nbsp;discards)&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">get_transfers</span> (<span class="id" title="var">acts</span> : <span class="id" title="var">list</span> <span class="id" title="var">Action</span>) : <span class="id" title="var">list</span> (<span class="id" title="var">Address</span> * <span class="id" title="var">list</span> <span class="id" title="var">FA2Interface.transfer</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="var">fold_left</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">trxs</span> <span class="id" title="var">act</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">act</span>.(<span class="id" title="var">act_body</span>) <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">act_call</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">msg</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">deserialize</span> <span class="id" title="var">FA2Token.Msg</span> <span class="id" title="var">_</span> <span class="id" title="var">msg</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Some</span> (<span class="id" title="var">msg_transfer</span> <span class="id" title="var">transfers</span>) =&gt; (<span class="id" title="var">act</span>.(<span class="id" title="var">act_from</span>), <span class="id" title="var">transfers</span>) :: <span class="id" title="var">trxs</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <span class="id" title="var">trxs</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <span class="id" title="var">trxs</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>) <span class="id" title="var">acts</span> [].<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">transfer_satisfies_policy</span> <span class="id" title="var">sender</span> <span class="id" title="var">trx</span> <span class="id" title="var">state</span> : <span class="id" title="var">Checker</span> :=<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;check&nbsp;if&nbsp;sender&nbsp;is&nbsp;an&nbsp;operator,&nbsp;and&nbsp;permission&nbsp;to&nbsp;transfer&nbsp;the&nbsp;specified&nbsp;token_id&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">policy</span> := <span class="id" title="var">state</span>.(<span class="id" title="var">permission_policy</span>) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">is_valid_operator_transfer</span> : <span class="id" title="var">Checker</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">FMap.find</span> <span class="id" title="var">trx</span>.(<span class="id" title="var">from_</span>) <span class="id" title="var">state</span>.(<span class="id" title="var">operators</span>) <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Some</span> <span class="id" title="var">ops_map</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">FMap.find</span> <span class="id" title="var">sender</span> <span class="id" title="var">ops_map</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Some</span> <span class="id" title="var">all_tokens</span> =&gt; <span class="id" title="var">checker</span> <span class="id" title="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Some</span> (<span class="id" title="var">some_tokens</span> <span class="id" title="var">token_ids</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">whenFail</span> "operator didn't have sufficient token_id permissions"<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">checker</span> (<span class="id" title="var">existsb</span> (<span class="id" title="var">N.eqb</span> <span class="id" title="var">trx</span>.(<span class="id" title="var">transfer_token_id</span>)) <span class="id" title="var">token_ids</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">None</span> =&gt; <span class="id" title="var">checker</span> <span class="id" title="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">None</span> =&gt; <span class="id" title="var">checker</span> <span class="id" title="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="var">whenFail</span><br/>
&nbsp;&nbsp;("failed with sender: " ++ <span class="id" title="var">show</span> <span class="id" title="var">sender</span> ++ <span class="id" title="var">nl</span>)<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> (<span class="id" title="var">policy</span>.(<span class="id" title="var">descr_self</span>), <span class="id" title="var">policy</span>.(<span class="id" title="var">descr_operator</span>)) <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;no&nbsp;transfers&nbsp;allowed&nbsp;*)</span><br/>
&nbsp;&nbsp;| (<span class="id" title="var">self_transfer_denied</span>, <span class="id" title="var">operator_transfer_denied</span>) =&gt; <span class="id" title="var">checker</span> <span class="id" title="var">false</span><br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;only&nbsp;self&nbsp;transfer&nbsp;allowed&nbsp;-&nbsp;check&nbsp;sender&nbsp;is&nbsp;equal&nbsp;to&nbsp;'from'&nbsp;*)</span><br/>
&nbsp;&nbsp;| (<span class="id" title="var">self_transfer_permitted</span>, <span class="id" title="var">operator_transfer_denied</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">whenFail</span> "operator transfer was denied, but sender != from"<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Note:&nbsp;this&nbsp;case&nbsp;seems&nbsp;to&nbsp;not&nbsp;be&nbsp;hit&nbsp;during&nbsp;testing&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">address_eqb</span> <span class="id" title="var">sender</span> <span class="id" title="var">trx</span>.(<span class="id" title="var">from_</span>))<br/>
&nbsp;&nbsp;| (<span class="id" title="var">self_transfer_denied</span>, <span class="id" title="var">operator_transfer_permitted</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> <span class="id" title="var">address_eqb</span> <span class="id" title="var">sender</span> <span class="id" title="var">trx</span>.(<span class="id" title="var">from_</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">then</span> <span class="id" title="var">whenFail</span> "self transfer was denied but got transfer with sender = from" <span class="id" title="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Note:&nbsp;this&nbsp;case&nbsp;seems&nbsp;to&nbsp;not&nbsp;be&nbsp;hit&nbsp;during&nbsp;testing&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">is_valid_operator_transfer</span><br/>
&nbsp;&nbsp;| (<span class="id" title="var">self_transfer_permitted</span>, <span class="id" title="var">operator_transfer_permitted</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> <span class="id" title="var">address_eqb</span> <span class="id" title="var">sender</span> <span class="id" title="var">trx</span>.(<span class="id" title="var">from_</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">then</span> <span class="id" title="var">checker</span> <span class="id" title="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Note:&nbsp;this&nbsp;case&nbsp;seems&nbsp;to&nbsp;not&nbsp;be&nbsp;hit&nbsp;during&nbsp;testing&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">is_valid_operator_transfer</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">transfer_satisfies_policy_P</span> (<span class="id" title="var">old_cs</span> <span class="id" title="var">new_cs</span> : <span class="id" title="var">ChainState</span>) : <span class="id" title="var">Checker</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">acts</span> := <span class="id" title="var">old_cs</span>.(<span class="id" title="var">chain_state_queue</span>) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">transfers</span> := <span class="id" title="var">get_transfers</span> <span class="id" title="var">acts</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">token_state</span> <span class="id" title="var">new_cs</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">Some</span> <span class="id" title="var">state</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">conjoin_map</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">sender_trxs_pair</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">conjoin_map</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">trx</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">transfer_satisfies_policy</span> (<span class="id" title="var">fst</span> <span class="id" title="var">sender_trxs_pair</span>) <span class="id" title="var">trx</span> <span class="id" title="var">state</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) (<span class="id" title="var">snd</span> <span class="id" title="var">sender_trxs_pair</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="id" title="var">transfers</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">None</span> =&gt; <span class="id" title="var">checker</span> <span class="id" title="var">false</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="comment">(*&nbsp;QuickChick&nbsp;(forAllChainStatePairs&nbsp;transfer_satisfies_policy_P).&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;coqtop-stdout:+++&nbsp;Passed&nbsp;10000&nbsp;tests&nbsp;(0&nbsp;discards)&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">single_update_op_correct</span> (<span class="id" title="var">new_state</span> : <span class="id" title="var">FA2Token.State</span>) (<span class="id" title="var">op</span> : <span class="id" title="var">update_operator</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> (<span class="id" title="var">param</span>, <span class="id" title="var">is_remove</span>) := <span class="id" title="keyword">match</span> <span class="id" title="var">op</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">add_operator</span> <span class="id" title="var">param</span> =&gt; (<span class="id" title="var">param</span>, <span class="id" title="var">false</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">remove_operator</span> <span class="id" title="var">param</span> =&gt; (<span class="id" title="var">param</span>, <span class="id" title="var">true</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">FMap.find</span> <span class="id" title="var">param</span>.(<span class="id" title="var">op_param_owner</span>) <span class="id" title="var">new_state</span>.(<span class="id" title="var">operators</span>) <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">Some</span> <span class="id" title="var">owners_map</span> =&gt; <span class="id" title="keyword">if</span> <span class="id" title="var">is_remove</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">then</span> <span class="id" title="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span> <span class="id" title="var">isSome</span> (<span class="id" title="var">FMap.find</span> <span class="id" title="var">param</span>.(<span class="id" title="var">op_param_operator</span>) <span class="id" title="var">owners_map</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">None</span> =&gt; <span class="id" title="var">is_remove</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="comment">(*&nbsp;This&nbsp;property&nbsp;asserts&nbsp;that&nbsp;if&nbsp;an&nbsp;update_operator&nbsp;action&nbsp;contains&nbsp;multiple&nbsp;updates&nbsp;for&nbsp;the&nbsp;same&nbsp;operator,<br/>
&nbsp;&nbsp;&nbsp;the&nbsp;LAST&nbsp;operation&nbsp;in&nbsp;the&nbsp;list&nbsp;must&nbsp;take&nbsp;effect&nbsp;*)</span><br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">last_update_operator_occurrence_takes_effect</span> (<span class="id" title="var">update_ops</span> : <span class="id" title="var">list</span> <span class="id" title="var">update_operator</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">new_state</span> : <span class="id" title="var">FA2Token.State</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">last_ops</span> : <span class="id" title="var">FMap</span> (<span class="id" title="var">Address</span> * <span class="id" title="var">Address</span>) <span class="id" title="var">update_operator</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">fold_left</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">acc</span> <span class="id" title="var">update_op</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">param</span> := <span class="id" title="keyword">match</span> <span class="id" title="var">update_op</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">add_operator</span> <span class="id" title="var">param</span> =&gt; <span class="id" title="var">param</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">remove_operator</span> <span class="id" title="var">param</span> =&gt; <span class="id" title="var">param</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">FMap.add</span> (<span class="id" title="var">param</span>.(<span class="id" title="var">op_param_owner</span>), <span class="id" title="var">param</span>.(<span class="id" title="var">op_param_operator</span>)) <span class="id" title="var">update_op</span> <span class="id" title="var">acc</span><br/>
&nbsp;&nbsp;) <span class="id" title="var">update_ops</span> <span class="id" title="var">FMap.empty</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="var">whenFail</span> (<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">show</span> <span class="id" title="var">last_ops</span> ++ <span class="id" title="var">nl</span> ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">show</span> <span class="id" title="var">new_state</span><br/>
&nbsp;&nbsp;)<br/>
&nbsp;&nbsp;(<span class="id" title="var">forallb</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">p</span> =&gt; <span class="id" title="var">single_update_op_correct</span> <span class="id" title="var">new_state</span> (<span class="id" title="var">snd</span> <span class="id" title="var">p</span>)) (<span class="id" title="var">FMap.elements</span> <span class="id" title="var">last_ops</span>)).<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">msg_is_update_operator</span> (<span class="id" title="var">cstate</span> : <span class="id" title="var">FA2Token.State</span>) (<span class="id" title="var">msg</span> : <span class="id" title="var">FA2Token.Msg</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">msg</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">msg_update_operators</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">true</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <span class="id" title="var">false</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">post_last_update_operator_occurrence_takes_effect</span> (<span class="id" title="var">chain</span> : <span class="id" title="var">Chain</span>) (<span class="id" title="var">cctx</span> : <span class="id" title="var">ContractCallContext</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">old_state</span> : <span class="id" title="var">FA2Token.State</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">msg</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">result_opt</span> : <span class="id" title="var">option</span> (<span class="id" title="var">FA2Token.State</span> * <span class="id" title="var">list</span> <span class="id" title="var">ActionBody</span>)) :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">result_opt</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">Some</span> (<span class="id" title="var">new_state</span>, <span class="id" title="var">_</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">update_ops</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">msg</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">msg_update_operators</span> <span class="id" title="var">ops</span> =&gt; <span class="id" title="var">ops</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; []<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">last_update_operator_occurrence_takes_effect</span> <span class="id" title="var">update_ops</span> <span class="id" title="var">new_state</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">None</span> =&gt; <span class="id" title="var">checker</span> <span class="id" title="var">false</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="comment">(*&nbsp;QuickChick&nbsp;(<br/>
&nbsp;&nbsp;{{msg_is_update_operator}}<br/>
&nbsp;&nbsp;token_contract_base_addr<br/>
&nbsp;&nbsp;{{post_last_update_operator_occurrence_takes_effect}}<br/>
&nbsp;&nbsp;chain_without_transfer_hook<br/>
).&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;40&nbsp;secs,&nbsp;max&nbsp;length&nbsp;7:&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;coqtop-stdout:+++&nbsp;Passed&nbsp;10000&nbsp;tests&nbsp;(0&nbsp;discards)&nbsp;*)</span><br/>
</div>
</div>
<div id="footer">
  Generated by <a href="https://coq.inria.fr/">coqdoc</a> and improved with <a href="https://github.com/tebbi/coqdocjs">CoqdocJS</a> and <a href="https://github.com/jgallen23/toc">TOC</a>
</div>
</div>
<script>
  const elements = document.getElementsByClassName("libtitle");
  while(elements.length > 0){
        elements[0].parentNode.removeChild(elements[0]);
  }
  if (window.location.pathname.endsWith("/toc.html")) {
      const jstocDiv = document.getElementById("js-toc");
      jstocDiv.classList.remove("toc");
      jstocDiv.classList.add("jstoc-hidden");
      const jstocHeaderDiv = document.getElementById("js-toc-header");
      jstocHeaderDiv.classList.add("jstoc-hidden");
  }
  console.log(window.location.pathname);
</script>
<script type="text/javascript" src="toc.js"></script>
</body>

</html>
